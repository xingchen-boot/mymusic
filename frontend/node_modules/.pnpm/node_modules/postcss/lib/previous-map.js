'use***REMOVED***strict'

let***REMOVED***{***REMOVED***existsSync,***REMOVED***readFileSync***REMOVED***}***REMOVED***=***REMOVED***require('fs')
let***REMOVED***{***REMOVED***dirname,***REMOVED***join***REMOVED***}***REMOVED***=***REMOVED***require('path')
let***REMOVED***{***REMOVED***SourceMapConsumer,***REMOVED***SourceMapGenerator***REMOVED***}***REMOVED***=***REMOVED***require('source-map-js')

function***REMOVED***fromBase64(str)***REMOVED***{
***REMOVED******REMOVED***if***REMOVED***(Buffer)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***Buffer.from(str,***REMOVED***'base64').toString()
***REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***/****REMOVED***c8***REMOVED***ignore***REMOVED***next***REMOVED***2***REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***window.atob(str)
***REMOVED******REMOVED***}
}

class***REMOVED***PreviousMap***REMOVED***{
***REMOVED******REMOVED***constructor(css,***REMOVED***opts)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(opts.map***REMOVED***===***REMOVED***false)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***this.loadAnnotation(css)
***REMOVED******REMOVED******REMOVED******REMOVED***this.inline***REMOVED***=***REMOVED***this.startWith(this.annotation,***REMOVED***'data:')

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***prev***REMOVED***=***REMOVED***opts.map***REMOVED***?***REMOVED***opts.map.prev***REMOVED***:***REMOVED***undefined
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***text***REMOVED***=***REMOVED***this.loadMap(opts.from,***REMOVED***prev)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!this.mapFile***REMOVED***&&***REMOVED***opts.from)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.mapFile***REMOVED***=***REMOVED***opts.from
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.mapFile)***REMOVED***this.root***REMOVED***=***REMOVED***dirname(this.mapFile)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(text)***REMOVED***this.text***REMOVED***=***REMOVED***text
***REMOVED******REMOVED***}

***REMOVED******REMOVED***consumer()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!this.consumerCache)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.consumerCache***REMOVED***=***REMOVED***new***REMOVED***SourceMapConsumer(this.text)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.consumerCache
***REMOVED******REMOVED***}

***REMOVED******REMOVED***decodeInline(text)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***baseCharsetUri***REMOVED***=***REMOVED***/^data:application\/json;charset=utf-?8;base64,/
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***baseUri***REMOVED***=***REMOVED***/^data:application\/json;base64,/
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***charsetUri***REMOVED***=***REMOVED***/^data:application\/json;charset=utf-?8,/
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***uri***REMOVED***=***REMOVED***/^data:application\/json,/

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***uriMatch***REMOVED***=***REMOVED***text.match(charsetUri)***REMOVED***||***REMOVED***text.match(uri)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(uriMatch)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***decodeURIComponent(text.substr(uriMatch[0].length))
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***baseUriMatch***REMOVED***=***REMOVED***text.match(baseCharsetUri)***REMOVED***||***REMOVED***text.match(baseUri)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(baseUriMatch)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***fromBase64(text.substr(baseUriMatch[0].length))
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***encoding***REMOVED***=***REMOVED***text.match(/data:application\/json;([^,]+),/)[1]
***REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error('Unsupported***REMOVED***source***REMOVED***map***REMOVED***encoding***REMOVED***'***REMOVED***+***REMOVED***encoding)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***getAnnotationURL(sourceMapString)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***sourceMapString.replace(/^\/\*\s*#***REMOVED***sourceMappingURL=/,***REMOVED***'').trim()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***isMap(map)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***map***REMOVED***!==***REMOVED***'object')***REMOVED***return***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***(
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***typeof***REMOVED***map.mappings***REMOVED***===***REMOVED***'string'***REMOVED***||
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***typeof***REMOVED***map._mappings***REMOVED***===***REMOVED***'string'***REMOVED***||
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***Array.isArray(map.sections)
***REMOVED******REMOVED******REMOVED******REMOVED***)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***loadAnnotation(css)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***comments***REMOVED***=***REMOVED***css.match(/\/\*\s*#***REMOVED***sourceMappingURL=/g)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!comments)***REMOVED***return

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***sourceMappingURLs***REMOVED***from***REMOVED***comments,***REMOVED***strings,***REMOVED***etc.
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***start***REMOVED***=***REMOVED***css.lastIndexOf(comments.pop())
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***end***REMOVED***=***REMOVED***css.indexOf('*/',***REMOVED***start)

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(start***REMOVED***>***REMOVED***-1***REMOVED***&&***REMOVED***end***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***Locate***REMOVED***the***REMOVED***last***REMOVED***sourceMappingURL***REMOVED***to***REMOVED***avoid***REMOVED***pickin
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.annotation***REMOVED***=***REMOVED***this.getAnnotationURL(css.substring(start,***REMOVED***end))
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***loadFile(path)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***this.root***REMOVED***=***REMOVED***dirname(path)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(existsSync(path))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.mapFile***REMOVED***=***REMOVED***path
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***readFileSync(path,***REMOVED***'utf-8').toString().trim()
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***loadMap(file,***REMOVED***prev)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(prev***REMOVED***===***REMOVED***false)***REMOVED***return***REMOVED***false

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(prev)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***prev***REMOVED***===***REMOVED***'string')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***prev
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(typeof***REMOVED***prev***REMOVED***===***REMOVED***'function')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***prevPath***REMOVED***=***REMOVED***prev(file)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(prevPath)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***map***REMOVED***=***REMOVED***this.loadFile(prevPath)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!map)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'Unable***REMOVED***to***REMOVED***load***REMOVED***previous***REMOVED***source***REMOVED***map:***REMOVED***'***REMOVED***+***REMOVED***prevPath.toString()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***map
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(prev***REMOVED***instanceof***REMOVED***SourceMapConsumer)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***SourceMapGenerator.fromSourceMap(prev).toString()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(prev***REMOVED***instanceof***REMOVED***SourceMapGenerator)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***prev.toString()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.isMap(prev))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***JSON.stringify(prev)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'Unsupported***REMOVED***previous***REMOVED***source***REMOVED***map***REMOVED***format:***REMOVED***'***REMOVED***+***REMOVED***prev.toString()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.inline)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.decodeInline(this.annotation)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.annotation)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***map***REMOVED***=***REMOVED***this.annotation
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(file)***REMOVED***map***REMOVED***=***REMOVED***join(dirname(file),***REMOVED***map)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.loadFile(map)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***startWith(string,***REMOVED***start)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!string)***REMOVED***return***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***string.substr(0,***REMOVED***start.length)***REMOVED***===***REMOVED***start
***REMOVED******REMOVED***}

***REMOVED******REMOVED***withContent()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***!!(
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.consumer().sourcesContent***REMOVED***&&
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.consumer().sourcesContent.length***REMOVED***>***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED***)
***REMOVED******REMOVED***}
}

module.exports***REMOVED***=***REMOVED***PreviousMap
PreviousMap.default***REMOVED***=***REMOVED***PreviousMap
