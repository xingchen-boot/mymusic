'use***REMOVED***strict'

let***REMOVED***{***REMOVED***dirname,***REMOVED***relative,***REMOVED***resolve,***REMOVED***sep***REMOVED***}***REMOVED***=***REMOVED***require('path')
let***REMOVED***{***REMOVED***SourceMapConsumer,***REMOVED***SourceMapGenerator***REMOVED***}***REMOVED***=***REMOVED***require('source-map-js')
let***REMOVED***{***REMOVED***pathToFileURL***REMOVED***}***REMOVED***=***REMOVED***require('url')

let***REMOVED***Input***REMOVED***=***REMOVED***require('./input')

let***REMOVED***sourceMapAvailable***REMOVED***=***REMOVED***Boolean(SourceMapConsumer***REMOVED***&&***REMOVED***SourceMapGenerator)
let***REMOVED***pathAvailable***REMOVED***=***REMOVED***Boolean(dirname***REMOVED***&&***REMOVED***resolve***REMOVED***&&***REMOVED***relative***REMOVED***&&***REMOVED***sep)

class***REMOVED***MapGenerator***REMOVED***{
***REMOVED******REMOVED***constructor(stringify,***REMOVED***root,***REMOVED***opts,***REMOVED***cssString)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***this.stringify***REMOVED***=***REMOVED***stringify
***REMOVED******REMOVED******REMOVED******REMOVED***this.mapOpts***REMOVED***=***REMOVED***opts.map***REMOVED***||***REMOVED***{}
***REMOVED******REMOVED******REMOVED******REMOVED***this.root***REMOVED***=***REMOVED***root
***REMOVED******REMOVED******REMOVED******REMOVED***this.opts***REMOVED***=***REMOVED***opts
***REMOVED******REMOVED******REMOVED******REMOVED***this.css***REMOVED***=***REMOVED***cssString
***REMOVED******REMOVED******REMOVED******REMOVED***this.originalCSS***REMOVED***=***REMOVED***cssString
***REMOVED******REMOVED******REMOVED******REMOVED***this.usesFileUrls***REMOVED***=***REMOVED***!this.mapOpts.from***REMOVED***&&***REMOVED***this.mapOpts.absolute

***REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedFileURLs***REMOVED***=***REMOVED***new***REMOVED***Map()
***REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedPaths***REMOVED***=***REMOVED***new***REMOVED***Map()
***REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedURLs***REMOVED***=***REMOVED***new***REMOVED***Map()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***addAnnotation()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***content

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.isInline())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***content***REMOVED***=
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'data:application/json;base64,'***REMOVED***+***REMOVED***this.toBase64(this.map.toString())
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.annotation***REMOVED***===***REMOVED***'string')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***content***REMOVED***=***REMOVED***this.mapOpts.annotation
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.annotation***REMOVED***===***REMOVED***'function')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***content***REMOVED***=***REMOVED***this.mapOpts.annotation(this.opts.to,***REMOVED***this.root)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***content***REMOVED***=***REMOVED***this.outputFile()***REMOVED***+***REMOVED***'.map'
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***eol***REMOVED***=***REMOVED***'\n'
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.css.includes('\r\n'))***REMOVED***eol***REMOVED***=***REMOVED***'\r\n'

***REMOVED******REMOVED******REMOVED******REMOVED***this.css***REMOVED***+=***REMOVED***eol***REMOVED***+***REMOVED***'/*#***REMOVED***sourceMappingURL='***REMOVED***+***REMOVED***content***REMOVED***+***REMOVED***'***REMOVED****/'
***REMOVED******REMOVED***}

***REMOVED******REMOVED***applyPrevMaps()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(let***REMOVED***prev***REMOVED***of***REMOVED***this.previous())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***from***REMOVED***=***REMOVED***this.toUrl(this.path(prev.file))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***root***REMOVED***=***REMOVED***prev.root***REMOVED***||***REMOVED***dirname(prev.file)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***map

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.mapOpts.sourcesContent***REMOVED***===***REMOVED***false)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***map***REMOVED***=***REMOVED***new***REMOVED***SourceMapConsumer(prev.text)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(map.sourcesContent)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***map.sourcesContent***REMOVED***=***REMOVED***null
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***map***REMOVED***=***REMOVED***prev.consumer()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.applySourceMap(map,***REMOVED***from,***REMOVED***this.toUrl(this.path(root)))
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***clearAnnotation()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.mapOpts.annotation***REMOVED***===***REMOVED***false)***REMOVED***return

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.root)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***node
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(let***REMOVED***i***REMOVED***=***REMOVED***this.root.nodes.length***REMOVED***-***REMOVED***1;***REMOVED***i***REMOVED***>=***REMOVED***0;***REMOVED***i--)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***node***REMOVED***=***REMOVED***this.root.nodes[i]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.type***REMOVED***!==***REMOVED***'comment')***REMOVED***continue
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.text.startsWith('#***REMOVED***sourceMappingURL='))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.root.removeChild(i)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.css)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.css***REMOVED***=***REMOVED***this.css.replace(/\n*\/\*#[\S\s]*?\*\/$/gm,***REMOVED***'')
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***generate()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***this.clearAnnotation()
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(pathAvailable***REMOVED***&&***REMOVED***sourceMapAvailable***REMOVED***&&***REMOVED***this.isMap())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.generateMap()
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***result***REMOVED***=***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.stringify(this.root,***REMOVED***i***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***result***REMOVED***+=***REMOVED***i
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***[result]
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***generateMap()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.root)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.generateString()
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.previous().length***REMOVED***===***REMOVED***1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***prev***REMOVED***=***REMOVED***this.previous()[0].consumer()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***prev.file***REMOVED***=***REMOVED***this.outputFile()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map***REMOVED***=***REMOVED***SourceMapGenerator.fromSourceMap(prev,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ignoreInvalidMapping:***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map***REMOVED***=***REMOVED***new***REMOVED***SourceMapGenerator({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file:***REMOVED***this.outputFile(),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ignoreInvalidMapping:***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.addMapping({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***generated:***REMOVED***{***REMOVED***column:***REMOVED***0,***REMOVED***line:***REMOVED***1***REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***original:***REMOVED***{***REMOVED***column:***REMOVED***0,***REMOVED***line:***REMOVED***1***REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***source:***REMOVED***this.opts.from
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***?***REMOVED***this.toUrl(this.path(this.opts.from))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***:***REMOVED***'<no***REMOVED***source>'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.isSourcesContent())***REMOVED***this.setSourcesContent()
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.root***REMOVED***&&***REMOVED***this.previous().length***REMOVED***>***REMOVED***0)***REMOVED***this.applyPrevMaps()
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.isAnnotation())***REMOVED***this.addAnnotation()

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.isInline())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***[this.css]
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***[this.css,***REMOVED***this.map]
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***generateString()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***this.css***REMOVED***=***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED***this.map***REMOVED***=***REMOVED***new***REMOVED***SourceMapGenerator({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file:***REMOVED***this.outputFile(),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ignoreInvalidMapping:***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***})

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***line***REMOVED***=***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***column***REMOVED***=***REMOVED***1

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***noSource***REMOVED***=***REMOVED***'<no***REMOVED***source>'
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***mapping***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***generated:***REMOVED***{***REMOVED***column:***REMOVED***0,***REMOVED***line:***REMOVED***0***REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***original:***REMOVED***{***REMOVED***column:***REMOVED***0,***REMOVED***line:***REMOVED***0***REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***source:***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***last,***REMOVED***lines
***REMOVED******REMOVED******REMOVED******REMOVED***this.stringify(this.root,***REMOVED***(str,***REMOVED***node,***REMOVED***type)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.css***REMOVED***+=***REMOVED***str

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node***REMOVED***&&***REMOVED***type***REMOVED***!==***REMOVED***'end')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.line***REMOVED***=***REMOVED***line
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.column***REMOVED***=***REMOVED***column***REMOVED***-***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.source***REMOVED***&&***REMOVED***node.source.start)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.source***REMOVED***=***REMOVED***this.sourcePath(node)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.line***REMOVED***=***REMOVED***node.source.start.line
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.column***REMOVED***=***REMOVED***node.source.start.column***REMOVED***-***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.addMapping(mapping)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.source***REMOVED***=***REMOVED***noSource
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.line***REMOVED***=***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.column***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.addMapping(mapping)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***lines***REMOVED***=***REMOVED***str.match(/\n/g)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(lines)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***line***REMOVED***+=***REMOVED***lines.length
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***last***REMOVED***=***REMOVED***str.lastIndexOf('\n')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***column***REMOVED***=***REMOVED***str.length***REMOVED***-***REMOVED***last
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***column***REMOVED***+=***REMOVED***str.length
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node***REMOVED***&&***REMOVED***type***REMOVED***!==***REMOVED***'start')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***p***REMOVED***=***REMOVED***node.parent***REMOVED***||***REMOVED***{***REMOVED***raws:***REMOVED***{}***REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***childless***REMOVED***=
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***node.type***REMOVED***===***REMOVED***'decl'***REMOVED***||***REMOVED***(node.type***REMOVED***===***REMOVED***'atrule'***REMOVED***&&***REMOVED***!node.nodes)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!childless***REMOVED***||***REMOVED***node***REMOVED***!==***REMOVED***p.last***REMOVED***||***REMOVED***p.raws.semicolon)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.source***REMOVED***&&***REMOVED***node.source.end)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.source***REMOVED***=***REMOVED***this.sourcePath(node)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.line***REMOVED***=***REMOVED***node.source.end.line
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.column***REMOVED***=***REMOVED***node.source.end.column***REMOVED***-***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.line***REMOVED***=***REMOVED***line
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.column***REMOVED***=***REMOVED***column***REMOVED***-***REMOVED***2
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.addMapping(mapping)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.source***REMOVED***=***REMOVED***noSource
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.line***REMOVED***=***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.original.column***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.line***REMOVED***=***REMOVED***line
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mapping.generated.column***REMOVED***=***REMOVED***column***REMOVED***-***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.addMapping(mapping)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***}

***REMOVED******REMOVED***isAnnotation()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.isInline())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.annotation***REMOVED***!==***REMOVED***'undefined')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.mapOpts.annotation
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.previous().length)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.previous().some(i***REMOVED***=>***REMOVED***i.annotation)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***true
***REMOVED******REMOVED***}

***REMOVED******REMOVED***isInline()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.inline***REMOVED***!==***REMOVED***'undefined')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.mapOpts.inline
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***annotation***REMOVED***=***REMOVED***this.mapOpts.annotation
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***annotation***REMOVED***!==***REMOVED***'undefined'***REMOVED***&&***REMOVED***annotation***REMOVED***!==***REMOVED***true)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.previous().length)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.previous().some(i***REMOVED***=>***REMOVED***i.inline)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***true
***REMOVED******REMOVED***}

***REMOVED******REMOVED***isMap()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***this.opts.map***REMOVED***!==***REMOVED***'undefined')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***!!this.opts.map
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.previous().length***REMOVED***>***REMOVED***0
***REMOVED******REMOVED***}

***REMOVED******REMOVED***isSourcesContent()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.sourcesContent***REMOVED***!==***REMOVED***'undefined')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.mapOpts.sourcesContent
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.previous().length)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.previous().some(i***REMOVED***=>***REMOVED***i.withContent())
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***true
***REMOVED******REMOVED***}

***REMOVED******REMOVED***outputFile()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.opts.to)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.path(this.opts.to)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.opts.from)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.path(this.opts.from)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***'to.css'
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***path(file)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.mapOpts.absolute)***REMOVED***return***REMOVED***file
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(file.charCodeAt(0)***REMOVED***===***REMOVED***60***REMOVED***/****REMOVED***`<`***REMOVED****/)***REMOVED***return***REMOVED***file
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(/^\w+:\/\//.test(file))***REMOVED***return***REMOVED***file
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***cached***REMOVED***=***REMOVED***this.memoizedPaths.get(file)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(cached)***REMOVED***return***REMOVED***cached

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***from***REMOVED***=***REMOVED***this.opts.to***REMOVED***?***REMOVED***dirname(this.opts.to)***REMOVED***:***REMOVED***'.'

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***this.mapOpts.annotation***REMOVED***===***REMOVED***'string')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***from***REMOVED***=***REMOVED***dirname(resolve(from,***REMOVED***this.mapOpts.annotation))
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***path***REMOVED***=***REMOVED***relative(from,***REMOVED***file)
***REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedPaths.set(file,***REMOVED***path)

***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***path
***REMOVED******REMOVED***}

***REMOVED******REMOVED***previous()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!this.previousMaps)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.previousMaps***REMOVED***=***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.root)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.root.walk(node***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.source***REMOVED***&&***REMOVED***node.source.input.map)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***map***REMOVED***=***REMOVED***node.source.input.map
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!this.previousMaps.includes(map))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.previousMaps.push(map)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***input***REMOVED***=***REMOVED***new***REMOVED***Input(this.originalCSS,***REMOVED***this.opts)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(input.map)***REMOVED***this.previousMaps.push(input.map)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.previousMaps
***REMOVED******REMOVED***}

***REMOVED******REMOVED***setSourcesContent()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***already***REMOVED***=***REMOVED***{}
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.root)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.root.walk(node***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(node.source)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***from***REMOVED***=***REMOVED***node.source.input.from
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(from***REMOVED***&&***REMOVED***!already[from])***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***already[from]***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***fromUrl***REMOVED***=***REMOVED***this.usesFileUrls
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***?***REMOVED***this.toFileUrl(from)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***:***REMOVED***this.toUrl(this.path(from))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.setSourceContent(fromUrl,***REMOVED***node.source.input.css)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.css)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***from***REMOVED***=***REMOVED***this.opts.from
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***?***REMOVED***this.toUrl(this.path(this.opts.from))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***:***REMOVED***'<no***REMOVED***source>'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.map.setSourceContent(from,***REMOVED***this.css)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***sourcePath(node)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.mapOpts.from)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.toUrl(this.mapOpts.from)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(this.usesFileUrls)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.toFileUrl(node.source.input.from)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***this.toUrl(this.path(node.source.input.from))
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***toBase64(str)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(Buffer)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***Buffer.from(str).toString('base64')
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***window.btoa(unescape(encodeURIComponent(str)))
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***toFileUrl(path)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***cached***REMOVED***=***REMOVED***this.memoizedFileURLs.get(path)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(cached)***REMOVED***return***REMOVED***cached

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(pathToFileURL)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***fileURL***REMOVED***=***REMOVED***pathToFileURL(path).toString()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedFileURLs.set(path,***REMOVED***fileURL)

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***fileURL
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'`map.absolute`***REMOVED***option***REMOVED***is***REMOVED***not***REMOVED***available***REMOVED***in***REMOVED***this***REMOVED***PostCSS***REMOVED***build'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***toUrl(path)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***cached***REMOVED***=***REMOVED***this.memoizedURLs.get(path)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(cached)***REMOVED***return***REMOVED***cached

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(sep***REMOVED***===***REMOVED***'\\')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***path***REMOVED***=***REMOVED***path.replace(/\\/g,***REMOVED***'/')
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***url***REMOVED***=***REMOVED***encodeURI(path).replace(/[#?]/g,***REMOVED***encodeURIComponent)
***REMOVED******REMOVED******REMOVED******REMOVED***this.memoizedURLs.set(path,***REMOVED***url)

***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***url
***REMOVED******REMOVED***}
}

module.exports***REMOVED***=***REMOVED***MapGenerator
