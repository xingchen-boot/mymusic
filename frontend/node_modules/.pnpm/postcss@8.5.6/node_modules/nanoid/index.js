import***REMOVED***crypto***REMOVED***from***REMOVED***'crypto'
import***REMOVED***{***REMOVED***urlAlphabet***REMOVED***}***REMOVED***from***REMOVED***'./url-alphabet/index.js'
const***REMOVED***POOL_SIZE_MULTIPLIER***REMOVED***=***REMOVED***128
let***REMOVED***pool,***REMOVED***poolOffset
let***REMOVED***fillPool***REMOVED***=***REMOVED***bytes***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***if***REMOVED***(!pool***REMOVED***||***REMOVED***pool.length***REMOVED***<***REMOVED***bytes)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***pool***REMOVED***=***REMOVED***Buffer.allocUnsafe(bytes***REMOVED*******REMOVED***POOL_SIZE_MULTIPLIER)
***REMOVED******REMOVED******REMOVED******REMOVED***crypto.randomFillSync(pool)
***REMOVED******REMOVED******REMOVED******REMOVED***poolOffset***REMOVED***=***REMOVED***0
***REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(poolOffset***REMOVED***+***REMOVED***bytes***REMOVED***>***REMOVED***pool.length)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***crypto.randomFillSync(pool)
***REMOVED******REMOVED******REMOVED******REMOVED***poolOffset***REMOVED***=***REMOVED***0
***REMOVED******REMOVED***}
***REMOVED******REMOVED***poolOffset***REMOVED***+=***REMOVED***bytes
}
let***REMOVED***random***REMOVED***=***REMOVED***bytes***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***fillPool((bytes***REMOVED***|=***REMOVED***0))
***REMOVED******REMOVED***return***REMOVED***pool.subarray(poolOffset***REMOVED***-***REMOVED***bytes,***REMOVED***poolOffset)
}
let***REMOVED***customRandom***REMOVED***=***REMOVED***(alphabet,***REMOVED***defaultSize,***REMOVED***getRandom)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***let***REMOVED***mask***REMOVED***=***REMOVED***(2***REMOVED***<<***REMOVED***(31***REMOVED***-***REMOVED***Math.clz32((alphabet.length***REMOVED***-***REMOVED***1)***REMOVED***|***REMOVED***1)))***REMOVED***-***REMOVED***1
***REMOVED******REMOVED***let***REMOVED***step***REMOVED***=***REMOVED***Math.ceil((1.6***REMOVED*******REMOVED***mask***REMOVED*******REMOVED***defaultSize)***REMOVED***/***REMOVED***alphabet.length)
***REMOVED******REMOVED***return***REMOVED***(size***REMOVED***=***REMOVED***defaultSize)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***id***REMOVED***=***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED***while***REMOVED***(true)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***bytes***REMOVED***=***REMOVED***getRandom(step)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***i***REMOVED***=***REMOVED***step
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***while***REMOVED***(i--)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***id***REMOVED***+=***REMOVED***alphabet[bytes[i]***REMOVED***&***REMOVED***mask]***REMOVED***||***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(id.length***REMOVED***===***REMOVED***size)***REMOVED***return***REMOVED***id
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
}
let***REMOVED***customAlphabet***REMOVED***=***REMOVED***(alphabet,***REMOVED***size***REMOVED***=***REMOVED***21)***REMOVED***=>
***REMOVED******REMOVED***customRandom(alphabet,***REMOVED***size,***REMOVED***random)
let***REMOVED***nanoid***REMOVED***=***REMOVED***(size***REMOVED***=***REMOVED***21)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***fillPool((size***REMOVED***|=***REMOVED***0))
***REMOVED******REMOVED***let***REMOVED***id***REMOVED***=***REMOVED***''
***REMOVED******REMOVED***for***REMOVED***(let***REMOVED***i***REMOVED***=***REMOVED***poolOffset***REMOVED***-***REMOVED***size;***REMOVED***i***REMOVED***<***REMOVED***poolOffset;***REMOVED***i++)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***id***REMOVED***+=***REMOVED***urlAlphabet[pool[i]***REMOVED***&***REMOVED***63]
***REMOVED******REMOVED***}
***REMOVED******REMOVED***return***REMOVED***id
}
export***REMOVED***{***REMOVED***nanoid,***REMOVED***customAlphabet,***REMOVED***customRandom,***REMOVED***urlAlphabet,***REMOVED***random***REMOVED***}
