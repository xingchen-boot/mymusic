#***REMOVED***proxy-from-env

[![Build***REMOVED***Status](https://travis-ci.org/Rob--W/proxy-from-env.svg?branch=master)](https://travis-ci.org/Rob--W/proxy-from-env)
[![Coverage***REMOVED***Status](https://coveralls.io/repos/github/Rob--W/proxy-from-env/badge.svg?branch=master)](https://coveralls.io/github/Rob--W/proxy-from-env?branch=master)

`proxy-from-env`***REMOVED***is***REMOVED***a***REMOVED***Node.js***REMOVED***package***REMOVED***that***REMOVED***exports***REMOVED***a***REMOVED***function***REMOVED***(`getProxyForUrl`)
that***REMOVED***takes***REMOVED***an***REMOVED***input***REMOVED***URL***REMOVED***(a***REMOVED***string***REMOVED***or
[`url.parse`](https://nodejs.org/docs/latest/api/url.html#url_url_parsing)'s
return***REMOVED***value)***REMOVED***and***REMOVED***returns***REMOVED***the***REMOVED***desired***REMOVED***proxy***REMOVED***URL***REMOVED***(also***REMOVED***a***REMOVED***string)***REMOVED***based***REMOVED***on
standard***REMOVED***proxy***REMOVED***environment***REMOVED***variables.***REMOVED***If***REMOVED***no***REMOVED***proxy***REMOVED***is***REMOVED***set,***REMOVED***an***REMOVED***empty***REMOVED***string***REMOVED***is
returned.

It***REMOVED***is***REMOVED***your***REMOVED***responsibility***REMOVED***to***REMOVED***actually***REMOVED***proxy***REMOVED***the***REMOVED***request***REMOVED***using***REMOVED***the***REMOVED***given***REMOVED***URL.

Installation:

```sh
npm***REMOVED***install***REMOVED***proxy-from-env
```

##***REMOVED***Example
This***REMOVED***example***REMOVED***shows***REMOVED***how***REMOVED***the***REMOVED***data***REMOVED***for***REMOVED***a***REMOVED***URL***REMOVED***can***REMOVED***be***REMOVED***fetched***REMOVED***via***REMOVED***the
[`http`***REMOVED***module](https://nodejs.org/api/http.html),***REMOVED***in***REMOVED***a***REMOVED***proxy-aware***REMOVED***way.

```javascript
var***REMOVED***http***REMOVED***=***REMOVED***require('http');
var***REMOVED***parseUrl***REMOVED***=***REMOVED***require('url').parse;
var***REMOVED***getProxyForUrl***REMOVED***=***REMOVED***require('proxy-from-env').getProxyForUrl;

var***REMOVED***some_url***REMOVED***=***REMOVED***'http://example.com/something';

//***REMOVED***//***REMOVED***Example,***REMOVED***if***REMOVED***there***REMOVED***is***REMOVED***a***REMOVED***proxy***REMOVED***server***REMOVED***at***REMOVED***10.0.0.1:1234,***REMOVED***then***REMOVED***setting***REMOVED***the
//***REMOVED***//***REMOVED***http_proxy***REMOVED***environment***REMOVED***variable***REMOVED***causes***REMOVED***the***REMOVED***request***REMOVED***to***REMOVED***go***REMOVED***through***REMOVED***a***REMOVED***proxy.
//***REMOVED***process.env.http_proxy***REMOVED***=***REMOVED***'http://10.0.0.1:1234';
//***REMOVED***
//***REMOVED***//***REMOVED***But***REMOVED***if***REMOVED***the***REMOVED***host***REMOVED***to***REMOVED***be***REMOVED***proxied***REMOVED***is***REMOVED***listed***REMOVED***in***REMOVED***NO_PROXY,***REMOVED***then***REMOVED***the***REMOVED***request***REMOVED***is
//***REMOVED***//***REMOVED***not***REMOVED***proxied***REMOVED***(but***REMOVED***a***REMOVED***direct***REMOVED***request***REMOVED***is***REMOVED***made).
//***REMOVED***process.env.no_proxy***REMOVED***=***REMOVED***'example.com';

var***REMOVED***proxy_url***REMOVED***=***REMOVED***getProxyForUrl(some_url);***REMOVED******REMOVED***//***REMOVED***<--***REMOVED***Our***REMOVED***magic.
if***REMOVED***(proxy_url)***REMOVED***{
***REMOVED******REMOVED***//***REMOVED***Should***REMOVED***be***REMOVED***proxied***REMOVED***through***REMOVED***proxy_url.
***REMOVED******REMOVED***var***REMOVED***parsed_some_url***REMOVED***=***REMOVED***parseUrl(some_url);
***REMOVED******REMOVED***var***REMOVED***parsed_proxy_url***REMOVED***=***REMOVED***parseUrl(proxy_url);
***REMOVED******REMOVED***//***REMOVED***A***REMOVED***HTTP***REMOVED***proxy***REMOVED***is***REMOVED***quite***REMOVED***simple.***REMOVED***It***REMOVED***is***REMOVED***similar***REMOVED***to***REMOVED***a***REMOVED***normal***REMOVED***request,***REMOVED***except***REMOVED***the
***REMOVED******REMOVED***//***REMOVED***path***REMOVED***is***REMOVED***an***REMOVED***absolute***REMOVED***URL,***REMOVED***and***REMOVED***the***REMOVED***proxied***REMOVED***URL's***REMOVED***host***REMOVED***is***REMOVED***put***REMOVED***in***REMOVED***the***REMOVED***header
***REMOVED******REMOVED***//***REMOVED***instead***REMOVED***of***REMOVED***the***REMOVED***server's***REMOVED***actual***REMOVED***host.
***REMOVED******REMOVED***httpOptions***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***protocol:***REMOVED***parsed_proxy_url.protocol,
***REMOVED******REMOVED******REMOVED******REMOVED***hostname:***REMOVED***parsed_proxy_url.hostname,
***REMOVED******REMOVED******REMOVED******REMOVED***port:***REMOVED***parsed_proxy_url.port,
***REMOVED******REMOVED******REMOVED******REMOVED***path:***REMOVED***parsed_some_url.href,
***REMOVED******REMOVED******REMOVED******REMOVED***headers:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***Host:***REMOVED***parsed_some_url.host,***REMOVED******REMOVED***//***REMOVED***=***REMOVED***host***REMOVED***name***REMOVED***+***REMOVED***optional***REMOVED***port.
***REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED***};
}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED***//***REMOVED***Direct***REMOVED***request.
***REMOVED******REMOVED***httpOptions***REMOVED***=***REMOVED***some_url;
}
http.get(httpOptions,***REMOVED***function(res)***REMOVED***{
***REMOVED******REMOVED***var***REMOVED***responses***REMOVED***=***REMOVED***[];
***REMOVED******REMOVED***res.on('data',***REMOVED***function(chunk)***REMOVED***{***REMOVED***responses.push(chunk);***REMOVED***});
***REMOVED******REMOVED***res.on('end',***REMOVED***function()***REMOVED***{***REMOVED***console.log(responses.join(''));***REMOVED******REMOVED***});
});

```

##***REMOVED***Environment***REMOVED***variables
The***REMOVED***environment***REMOVED***variables***REMOVED***can***REMOVED***be***REMOVED***specified***REMOVED***in***REMOVED***lowercase***REMOVED***or***REMOVED***uppercase,***REMOVED***with***REMOVED***the
lowercase***REMOVED***name***REMOVED***having***REMOVED***precedence***REMOVED***over***REMOVED***the***REMOVED***uppercase***REMOVED***variant.***REMOVED***A***REMOVED***variable***REMOVED***that***REMOVED***is
not***REMOVED***set***REMOVED***has***REMOVED***the***REMOVED***same***REMOVED***meaning***REMOVED***as***REMOVED***a***REMOVED***variable***REMOVED***that***REMOVED***is***REMOVED***set***REMOVED***but***REMOVED***has***REMOVED***no***REMOVED***value.

###***REMOVED***NO\_PROXY

`NO_PROXY`***REMOVED***is***REMOVED***a***REMOVED***list***REMOVED***of***REMOVED***host***REMOVED***names***REMOVED***(optionally***REMOVED***with***REMOVED***a***REMOVED***port).***REMOVED***If***REMOVED***the***REMOVED***input***REMOVED***URL
matches***REMOVED***any***REMOVED***of***REMOVED***the***REMOVED***entries***REMOVED***in***REMOVED***`NO_PROXY`,***REMOVED***then***REMOVED***the***REMOVED***input***REMOVED***URL***REMOVED***should***REMOVED***be***REMOVED***fetched
by***REMOVED***a***REMOVED***direct***REMOVED***request***REMOVED***(i.e.***REMOVED***without***REMOVED***a***REMOVED***proxy).

Matching***REMOVED***follows***REMOVED***the***REMOVED***following***REMOVED***rules:

-***REMOVED***`NO_PROXY=*`***REMOVED***disables***REMOVED***all***REMOVED***proxies.
-***REMOVED***Space***REMOVED***and***REMOVED***commas***REMOVED***may***REMOVED***be***REMOVED***used***REMOVED***to***REMOVED***separate***REMOVED***the***REMOVED***entries***REMOVED***in***REMOVED***the***REMOVED***`NO_PROXY`***REMOVED***list.
-***REMOVED***If***REMOVED***`NO_PROXY`***REMOVED***does***REMOVED***not***REMOVED***contain***REMOVED***any***REMOVED***entries,***REMOVED***then***REMOVED***proxies***REMOVED***are***REMOVED***never***REMOVED***disabled.
-***REMOVED***If***REMOVED***a***REMOVED***port***REMOVED***is***REMOVED***added***REMOVED***after***REMOVED***the***REMOVED***host***REMOVED***name,***REMOVED***then***REMOVED***the***REMOVED***ports***REMOVED***must***REMOVED***match.***REMOVED***If***REMOVED***the***REMOVED***URL
***REMOVED******REMOVED***does***REMOVED***not***REMOVED***have***REMOVED***an***REMOVED***explicit***REMOVED***port***REMOVED***name,***REMOVED***the***REMOVED***protocol's***REMOVED***default***REMOVED***port***REMOVED***is***REMOVED***used.
-***REMOVED***Generally,***REMOVED***the***REMOVED***proxy***REMOVED***is***REMOVED***only***REMOVED***disabled***REMOVED***if***REMOVED***the***REMOVED***host***REMOVED***name***REMOVED***is***REMOVED***an***REMOVED***exact***REMOVED***match***REMOVED***for
***REMOVED******REMOVED***an***REMOVED***entry***REMOVED***in***REMOVED***the***REMOVED***`NO_PROXY`***REMOVED***list.***REMOVED***The***REMOVED***only***REMOVED***exceptions***REMOVED***are***REMOVED***entries***REMOVED***that***REMOVED***start
***REMOVED******REMOVED***with***REMOVED***a***REMOVED***dot***REMOVED***or***REMOVED***with***REMOVED***a***REMOVED***wildcard;***REMOVED***then***REMOVED***the***REMOVED***proxy***REMOVED***is***REMOVED***disabled***REMOVED***if***REMOVED***the***REMOVED***host***REMOVED***name
***REMOVED******REMOVED***ends***REMOVED***with***REMOVED***the***REMOVED***entry.

See***REMOVED***`test.js`***REMOVED***for***REMOVED***examples***REMOVED***of***REMOVED***what***REMOVED***should***REMOVED***match***REMOVED***and***REMOVED***what***REMOVED***does***REMOVED***not.

###***REMOVED***\*\_PROXY

The***REMOVED***environment***REMOVED***variable***REMOVED***used***REMOVED***for***REMOVED***the***REMOVED***proxy***REMOVED***depends***REMOVED***on***REMOVED***the***REMOVED***protocol***REMOVED***of***REMOVED***the***REMOVED***URL.
For***REMOVED***example,***REMOVED***`https://example.com`***REMOVED***uses***REMOVED***the***REMOVED***"https"***REMOVED***protocol,***REMOVED***and***REMOVED***therefore***REMOVED***the
proxy***REMOVED***to***REMOVED***be***REMOVED***used***REMOVED***is***REMOVED***`HTTPS_PROXY`***REMOVED***(_NOT_***REMOVED***`HTTP_PROXY`,***REMOVED***which***REMOVED***is***REMOVED***_only_***REMOVED***used***REMOVED***for
http:-URLs).

The***REMOVED***library***REMOVED***is***REMOVED***not***REMOVED***limited***REMOVED***to***REMOVED***http(s),***REMOVED***other***REMOVED***schemes***REMOVED***such***REMOVED***as
`FTP_PROXY`***REMOVED***(ftp:),
`WSS_PROXY`***REMOVED***(wss:),
`WS_PROXY`***REMOVED***(ws:)
are***REMOVED***also***REMOVED***supported.

If***REMOVED***present,***REMOVED***`ALL_PROXY`***REMOVED***is***REMOVED***used***REMOVED***as***REMOVED***fallback***REMOVED***if***REMOVED***there***REMOVED***is***REMOVED***no***REMOVED***other***REMOVED***match.


##***REMOVED***External***REMOVED***resources
The***REMOVED***exact***REMOVED***way***REMOVED***of***REMOVED***parsing***REMOVED***the***REMOVED***environment***REMOVED***variables***REMOVED***is***REMOVED***not***REMOVED***codified***REMOVED***in***REMOVED***any
standard.***REMOVED***This***REMOVED***library***REMOVED***is***REMOVED***designed***REMOVED***to***REMOVED***be***REMOVED***compatible***REMOVED***with***REMOVED***formats***REMOVED***as***REMOVED***expected***REMOVED***by
existing***REMOVED***software.
The***REMOVED***following***REMOVED***resources***REMOVED***were***REMOVED***used***REMOVED***to***REMOVED***determine***REMOVED***the***REMOVED***desired***REMOVED***behavior:

-***REMOVED***cURL:
***REMOVED******REMOVED***https://curl.haxx.se/docs/manpage.html#ENVIRONMENT***REMOVED******REMOVED***
***REMOVED******REMOVED***https://github.com/curl/curl/blob/4af40b3646d3b09f68e419f7ca866ff395d1f897/lib/url.c#L4446-L4514***REMOVED******REMOVED***
***REMOVED******REMOVED***https://github.com/curl/curl/blob/4af40b3646d3b09f68e419f7ca866ff395d1f897/lib/url.c#L4608-L4638***REMOVED******REMOVED***

-***REMOVED***wget:***REMOVED***
***REMOVED******REMOVED***https://www.gnu.org/software/wget/manual/wget.html#Proxies***REMOVED******REMOVED***
***REMOVED******REMOVED***http://git.savannah.gnu.org/cgit/wget.git/tree/src/init.c?id=636a5f9a1c508aa39e35a3a8e9e54520a284d93d#n383***REMOVED******REMOVED***
***REMOVED******REMOVED***http://git.savannah.gnu.org/cgit/wget.git/tree/src/retr.c?id=93c1517c4071c4288ba5a4b038e7634e4c6b5482#n1278***REMOVED******REMOVED***

-***REMOVED***W3:
***REMOVED******REMOVED***https://www.w3.org/Daemon/User/Proxies/ProxyClients.html***REMOVED******REMOVED***

-***REMOVED***Python's***REMOVED***urllib:
***REMOVED******REMOVED***https://github.com/python/cpython/blob/936135bb97fe04223aa30ca6e98eac8f3ed6b349/Lib/urllib/request.py#L755-L782***REMOVED******REMOVED***
***REMOVED******REMOVED***https://github.com/python/cpython/blob/936135bb97fe04223aa30ca6e98eac8f3ed6b349/Lib/urllib/request.py#L2444-L2479
