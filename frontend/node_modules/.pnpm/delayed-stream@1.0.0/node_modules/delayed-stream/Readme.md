#***REMOVED***delayed-stream

Buffers***REMOVED***events***REMOVED***from***REMOVED***a***REMOVED***stream***REMOVED***until***REMOVED***you***REMOVED***are***REMOVED***ready***REMOVED***to***REMOVED***handle***REMOVED***them.

##***REMOVED***Installation

```***REMOVED***bash
npm***REMOVED***install***REMOVED***delayed-stream
```

##***REMOVED***Usage

The***REMOVED***following***REMOVED***example***REMOVED***shows***REMOVED***how***REMOVED***to***REMOVED***write***REMOVED***a***REMOVED***http***REMOVED***echo***REMOVED***server***REMOVED***that***REMOVED***delays***REMOVED***its
response***REMOVED***by***REMOVED***1000***REMOVED***ms.

```***REMOVED***javascript
var***REMOVED***DelayedStream***REMOVED***=***REMOVED***require('delayed-stream');
var***REMOVED***http***REMOVED***=***REMOVED***require('http');

http.createServer(function(req,***REMOVED***res)***REMOVED***{
***REMOVED******REMOVED***var***REMOVED***delayed***REMOVED***=***REMOVED***DelayedStream.create(req);

***REMOVED******REMOVED***setTimeout(function()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***res.writeHead(200);
***REMOVED******REMOVED******REMOVED******REMOVED***delayed.pipe(res);
***REMOVED******REMOVED***},***REMOVED***1000);
});
```

If***REMOVED***you***REMOVED***are***REMOVED***not***REMOVED***using***REMOVED***`Stream#pipe`,***REMOVED***you***REMOVED***can***REMOVED***also***REMOVED***manually***REMOVED***release***REMOVED***the***REMOVED***buffered
events***REMOVED***by***REMOVED***calling***REMOVED***`delayedStream.resume()`:

```***REMOVED***javascript
var***REMOVED***delayed***REMOVED***=***REMOVED***DelayedStream.create(req);

setTimeout(function()***REMOVED***{
***REMOVED******REMOVED***//***REMOVED***Emit***REMOVED***all***REMOVED***buffered***REMOVED***events***REMOVED***and***REMOVED***resume***REMOVED***underlaying***REMOVED***source
***REMOVED******REMOVED***delayed.resume();
},***REMOVED***1000);
```

##***REMOVED***Implementation

In***REMOVED***order***REMOVED***to***REMOVED***use***REMOVED***this***REMOVED***meta***REMOVED***stream***REMOVED***properly,***REMOVED***here***REMOVED***are***REMOVED***a***REMOVED***few***REMOVED***things***REMOVED***you***REMOVED***should
know***REMOVED***about***REMOVED***the***REMOVED***implementation.

###***REMOVED***Event***REMOVED***Buffering***REMOVED***/***REMOVED***Proxying

All***REMOVED***events***REMOVED***of***REMOVED***the***REMOVED***`source`***REMOVED***stream***REMOVED***are***REMOVED***hijacked***REMOVED***by***REMOVED***overwriting***REMOVED***the***REMOVED***`source.emit`
method.***REMOVED***Until***REMOVED***node***REMOVED***implements***REMOVED***a***REMOVED***catch-all***REMOVED***event***REMOVED***listener,***REMOVED***this***REMOVED***is***REMOVED***the***REMOVED***only***REMOVED***way.

However,***REMOVED***delayed-stream***REMOVED***still***REMOVED***continues***REMOVED***to***REMOVED***emit***REMOVED***all***REMOVED***events***REMOVED***it***REMOVED***captures***REMOVED***on***REMOVED***the
`source`,***REMOVED***regardless***REMOVED***of***REMOVED***whether***REMOVED***you***REMOVED***have***REMOVED***released***REMOVED***the***REMOVED***delayed***REMOVED***stream***REMOVED***yet***REMOVED***or
not.

Upon***REMOVED***creation,***REMOVED***delayed-stream***REMOVED***captures***REMOVED***all***REMOVED***`source`***REMOVED***events***REMOVED***and***REMOVED***stores***REMOVED***them***REMOVED***in
an***REMOVED***internal***REMOVED***event***REMOVED***buffer.***REMOVED***Once***REMOVED***`delayedStream.release()`***REMOVED***is***REMOVED***called,***REMOVED***all
buffered***REMOVED***events***REMOVED***are***REMOVED***emitted***REMOVED***on***REMOVED***the***REMOVED***`delayedStream`,***REMOVED***and***REMOVED***the***REMOVED***event***REMOVED***buffer***REMOVED***is
cleared.***REMOVED***After***REMOVED***that,***REMOVED***delayed-stream***REMOVED***merely***REMOVED***acts***REMOVED***as***REMOVED***a***REMOVED***proxy***REMOVED***for***REMOVED***the***REMOVED***underlaying
source.

###***REMOVED***Error***REMOVED***handling

Error***REMOVED***events***REMOVED***on***REMOVED***`source`***REMOVED***are***REMOVED***buffered***REMOVED***/***REMOVED***proxied***REMOVED***just***REMOVED***like***REMOVED***any***REMOVED***other***REMOVED***events.
However,***REMOVED***`delayedStream.create`***REMOVED***attaches***REMOVED***a***REMOVED***no-op***REMOVED***`'error'`***REMOVED***listener***REMOVED***to***REMOVED***the
`source`.***REMOVED***This***REMOVED***way***REMOVED***you***REMOVED***only***REMOVED***have***REMOVED***to***REMOVED***handle***REMOVED***errors***REMOVED***on***REMOVED***the***REMOVED***`delayedStream`
object,***REMOVED***rather***REMOVED***than***REMOVED***in***REMOVED***two***REMOVED***places.

###***REMOVED***Buffer***REMOVED***limits

delayed-stream***REMOVED***provides***REMOVED***a***REMOVED***`maxDataSize`***REMOVED***property***REMOVED***that***REMOVED***can***REMOVED***be***REMOVED***used***REMOVED***to***REMOVED***limit
the***REMOVED***amount***REMOVED***of***REMOVED***data***REMOVED***being***REMOVED***buffered.***REMOVED***In***REMOVED***order***REMOVED***to***REMOVED***protect***REMOVED***you***REMOVED***from***REMOVED***bad***REMOVED***`source`
streams***REMOVED***that***REMOVED***don't***REMOVED***react***REMOVED***to***REMOVED***`source.pause()`,***REMOVED***this***REMOVED***feature***REMOVED***is***REMOVED***enabled***REMOVED***by
default.

##***REMOVED***API

###***REMOVED***DelayedStream.create(source,***REMOVED***[options])

Returns***REMOVED***a***REMOVED***new***REMOVED***`delayedStream`.***REMOVED***Available***REMOVED***options***REMOVED***are:

****REMOVED***`pauseStream`
****REMOVED***`maxDataSize`

The***REMOVED***description***REMOVED***for***REMOVED***those***REMOVED***properties***REMOVED***can***REMOVED***be***REMOVED***found***REMOVED***below.

###***REMOVED***delayedStream.source

The***REMOVED***`source`***REMOVED***stream***REMOVED***managed***REMOVED***by***REMOVED***this***REMOVED***object.***REMOVED***This***REMOVED***is***REMOVED***useful***REMOVED***if***REMOVED***you***REMOVED***are
passing***REMOVED***your***REMOVED***`delayedStream`***REMOVED***around,***REMOVED***and***REMOVED***you***REMOVED***still***REMOVED***want***REMOVED***to***REMOVED***access***REMOVED***properties
on***REMOVED***the***REMOVED***`source`***REMOVED***object.

###***REMOVED***delayedStream.pauseStream***REMOVED***=***REMOVED***true

Whether***REMOVED***to***REMOVED***pause***REMOVED***the***REMOVED***underlaying***REMOVED***`source`***REMOVED***when***REMOVED***calling
`DelayedStream.create()`.***REMOVED***Modifying***REMOVED***this***REMOVED***property***REMOVED***afterwards***REMOVED***has***REMOVED***no***REMOVED***effect.

###***REMOVED***delayedStream.maxDataSize***REMOVED***=***REMOVED***1024***REMOVED*******REMOVED***1024

The***REMOVED***amount***REMOVED***of***REMOVED***data***REMOVED***to***REMOVED***buffer***REMOVED***before***REMOVED***emitting***REMOVED***an***REMOVED***`error`.

If***REMOVED***the***REMOVED***underlaying***REMOVED***source***REMOVED***is***REMOVED***emitting***REMOVED***`Buffer`***REMOVED***objects,***REMOVED***the***REMOVED***`maxDataSize`
refers***REMOVED***to***REMOVED***bytes.

If***REMOVED***the***REMOVED***underlaying***REMOVED***source***REMOVED***is***REMOVED***emitting***REMOVED***JavaScript***REMOVED***strings,***REMOVED***the***REMOVED***size***REMOVED***refers***REMOVED***to
characters.

If***REMOVED***you***REMOVED***know***REMOVED***what***REMOVED***you***REMOVED***are***REMOVED***doing,***REMOVED***you***REMOVED***can***REMOVED***set***REMOVED***this***REMOVED***property***REMOVED***to***REMOVED***`Infinity`***REMOVED***to
disable***REMOVED***this***REMOVED***feature.***REMOVED***You***REMOVED***can***REMOVED***also***REMOVED***modify***REMOVED***this***REMOVED***property***REMOVED***during***REMOVED***runtime.

###***REMOVED***delayedStream.dataSize***REMOVED***=***REMOVED***0

The***REMOVED***amount***REMOVED***of***REMOVED***data***REMOVED***buffered***REMOVED***so***REMOVED***far.

###***REMOVED***delayedStream.readable

An***REMOVED***ECMA5***REMOVED***getter***REMOVED***that***REMOVED***returns***REMOVED***the***REMOVED***value***REMOVED***of***REMOVED***`source.readable`.

###***REMOVED***delayedStream.resume()

If***REMOVED***the***REMOVED***`delayedStream`***REMOVED***has***REMOVED***not***REMOVED***been***REMOVED***released***REMOVED***so***REMOVED***far,***REMOVED***`delayedStream.release()`
is***REMOVED***called.

In***REMOVED***either***REMOVED***case,***REMOVED***`source.resume()`***REMOVED***is***REMOVED***called.

###***REMOVED***delayedStream.pause()

Calls***REMOVED***`source.pause()`.

###***REMOVED***delayedStream.pipe(dest)

Calls***REMOVED***`delayedStream.resume()`***REMOVED***and***REMOVED***then***REMOVED***proxies***REMOVED***the***REMOVED***arguments***REMOVED***to***REMOVED***`source.pipe`.

###***REMOVED***delayedStream.release()

Emits***REMOVED***and***REMOVED***clears***REMOVED***all***REMOVED***events***REMOVED***that***REMOVED***have***REMOVED***been***REMOVED***buffered***REMOVED***up***REMOVED***so***REMOVED***far.***REMOVED***This***REMOVED***does***REMOVED***not
resume***REMOVED***the***REMOVED***underlaying***REMOVED***source,***REMOVED***use***REMOVED***`delayedStream.resume()`***REMOVED***instead.

##***REMOVED***License

delayed-stream***REMOVED***is***REMOVED***licensed***REMOVED***under***REMOVED***the***REMOVED***MIT***REMOVED***license.
