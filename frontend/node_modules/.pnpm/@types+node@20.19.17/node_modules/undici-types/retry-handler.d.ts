import***REMOVED***Dispatcher***REMOVED***from***REMOVED***"./dispatcher";

export***REMOVED***default***REMOVED***RetryHandler;

declare***REMOVED***class***REMOVED***RetryHandler***REMOVED***implements***REMOVED***Dispatcher.DispatchHandlers***REMOVED***{
***REMOVED******REMOVED***constructor(
***REMOVED******REMOVED******REMOVED******REMOVED***options:***REMOVED***Dispatcher.DispatchOptions***REMOVED***&***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***retryOptions?:***REMOVED***RetryHandler.RetryOptions;
***REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED***retryHandlers:***REMOVED***RetryHandler.RetryHandlers
***REMOVED******REMOVED***);
}

declare***REMOVED***namespace***REMOVED***RetryHandler***REMOVED***{
***REMOVED******REMOVED***export***REMOVED***type***REMOVED***RetryState***REMOVED***=***REMOVED***{***REMOVED***counter:***REMOVED***number;***REMOVED***};

***REMOVED******REMOVED***export***REMOVED***type***REMOVED***RetryContext***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***state:***REMOVED***RetryState;
***REMOVED******REMOVED******REMOVED******REMOVED***opts:***REMOVED***Dispatcher.DispatchOptions***REMOVED***&***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***retryOptions?:***REMOVED***RetryHandler.RetryOptions;
***REMOVED******REMOVED******REMOVED******REMOVED***};
***REMOVED******REMOVED***}

***REMOVED******REMOVED***export***REMOVED***type***REMOVED***OnRetryCallback***REMOVED***=***REMOVED***(result?:***REMOVED***Error***REMOVED***|***REMOVED***null)***REMOVED***=>***REMOVED***void;

***REMOVED******REMOVED***export***REMOVED***type***REMOVED***RetryCallback***REMOVED***=***REMOVED***(
***REMOVED******REMOVED******REMOVED******REMOVED***err:***REMOVED***Error,
***REMOVED******REMOVED******REMOVED******REMOVED***context:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***state:***REMOVED***RetryState;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***opts:***REMOVED***Dispatcher.DispatchOptions***REMOVED***&***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***retryOptions?:***REMOVED***RetryHandler.RetryOptions;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***};
***REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED***callback:***REMOVED***OnRetryCallback
***REMOVED******REMOVED***)***REMOVED***=>***REMOVED***number***REMOVED***|***REMOVED***null;

***REMOVED******REMOVED***export***REMOVED***interface***REMOVED***RetryOptions***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Callback***REMOVED***to***REMOVED***be***REMOVED***invoked***REMOVED***on***REMOVED***every***REMOVED***retry***REMOVED***iteration.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***It***REMOVED***receives***REMOVED***the***REMOVED***error,***REMOVED***current***REMOVED***state***REMOVED***of***REMOVED***the***REMOVED***retry***REMOVED***object***REMOVED***and***REMOVED***the***REMOVED***options***REMOVED***object
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***passed***REMOVED***when***REMOVED***instantiating***REMOVED***the***REMOVED***retry***REMOVED***handler.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{RetryCallback}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***retry?:***REMOVED***RetryCallback;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Maximum***REMOVED***number***REMOVED***of***REMOVED***retries***REMOVED***to***REMOVED***allow.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{number}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***5
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***maxRetries?:***REMOVED***number;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Max***REMOVED***number***REMOVED***of***REMOVED***milliseconds***REMOVED***allow***REMOVED***between***REMOVED***retries
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{number}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***30000
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***maxTimeout?:***REMOVED***number;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Initial***REMOVED***number***REMOVED***of***REMOVED***milliseconds***REMOVED***to***REMOVED***wait***REMOVED***before***REMOVED***retrying***REMOVED***for***REMOVED***the***REMOVED***first***REMOVED***time.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{number}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***500
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***minTimeout?:***REMOVED***number;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Factior***REMOVED***to***REMOVED***multiply***REMOVED***the***REMOVED***timeout***REMOVED***factor***REMOVED***between***REMOVED***retries.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{number}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***2
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***timeoutFactor?:***REMOVED***number;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***It***REMOVED***enables***REMOVED***to***REMOVED***automatically***REMOVED***infer***REMOVED***timeout***REMOVED***between***REMOVED***retries***REMOVED***based***REMOVED***on***REMOVED***the***REMOVED***`Retry-After`***REMOVED***header.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{boolean}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***retryAfter?:***REMOVED***boolean;
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***HTTP***REMOVED***methods***REMOVED***to***REMOVED***retry.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{Dispatcher.HttpMethod[]}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***['GET',***REMOVED***'HEAD',***REMOVED***'OPTIONS',***REMOVED***'PUT',***REMOVED***'DELETE',***REMOVED***'TRACE'],
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***methods?:***REMOVED***Dispatcher.HttpMethod[];
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***Error***REMOVED***codes***REMOVED***to***REMOVED***be***REMOVED***retried.***REMOVED***e.g.***REMOVED***`ECONNRESET`,***REMOVED***`ENOTFOUND`,***REMOVED***`ETIMEDOUT`,***REMOVED***`ECONNREFUSED`,***REMOVED***etc.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{string[]}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***['ECONNRESET','ECONNREFUSED','ENOTFOUND','ENETDOWN','ENETUNREACH','EHOSTDOWN','EHOSTUNREACH','EPIPE']
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***errorCodes?:***REMOVED***string[];
***REMOVED******REMOVED******REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***HTTP***REMOVED***status***REMOVED***codes***REMOVED***to***REMOVED***be***REMOVED***retried.
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@type***REMOVED***{number[]}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@memberof***REMOVED***RetryOptions
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*******REMOVED***@default***REMOVED***[500,***REMOVED***502,***REMOVED***503,***REMOVED***504,***REMOVED***429],
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED******REMOVED******REMOVED***statusCodes?:***REMOVED***number[];
***REMOVED******REMOVED***}

***REMOVED******REMOVED***export***REMOVED***interface***REMOVED***RetryHandlers***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***dispatch:***REMOVED***Dispatcher["dispatch"];
***REMOVED******REMOVED******REMOVED******REMOVED***handler:***REMOVED***Dispatcher.DispatchHandlers;
***REMOVED******REMOVED***}
}
