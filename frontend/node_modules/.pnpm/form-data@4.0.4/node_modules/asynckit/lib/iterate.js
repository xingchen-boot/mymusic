var***REMOVED***async***REMOVED***=***REMOVED***require('./async.js')
***REMOVED******REMOVED***,***REMOVED***abort***REMOVED***=***REMOVED***require('./abort.js')
***REMOVED******REMOVED***;

//***REMOVED***API
module.exports***REMOVED***=***REMOVED***iterate;

/**
***REMOVED*******REMOVED***Iterates***REMOVED***over***REMOVED***each***REMOVED***job***REMOVED***object
***REMOVED****
***REMOVED*******REMOVED***@param***REMOVED***{array|object}***REMOVED***list***REMOVED***-***REMOVED***array***REMOVED***or***REMOVED***object***REMOVED***(named***REMOVED***list)***REMOVED***to***REMOVED***iterate***REMOVED***over
***REMOVED*******REMOVED***@param***REMOVED***{function}***REMOVED***iterator***REMOVED***-***REMOVED***iterator***REMOVED***to***REMOVED***run
***REMOVED*******REMOVED***@param***REMOVED***{object}***REMOVED***state***REMOVED***-***REMOVED***current***REMOVED***job***REMOVED***status
***REMOVED*******REMOVED***@param***REMOVED***{function}***REMOVED***callback***REMOVED***-***REMOVED***invoked***REMOVED***when***REMOVED***all***REMOVED***elements***REMOVED***processed
***REMOVED****/
function***REMOVED***iterate(list,***REMOVED***iterator,***REMOVED***state,***REMOVED***callback)
{
***REMOVED******REMOVED***//***REMOVED***store***REMOVED***current***REMOVED***index
***REMOVED******REMOVED***var***REMOVED***key***REMOVED***=***REMOVED***state['keyedList']***REMOVED***?***REMOVED***state['keyedList'][state.index]***REMOVED***:***REMOVED***state.index;

***REMOVED******REMOVED***state.jobs[key]***REMOVED***=***REMOVED***runJob(iterator,***REMOVED***key,***REMOVED***list[key],***REMOVED***function(error,***REMOVED***output)
***REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***don't***REMOVED***repeat***REMOVED***yourself
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***skip***REMOVED***secondary***REMOVED***callbacks
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!(key***REMOVED***in***REMOVED***state.jobs))
***REMOVED******REMOVED******REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***clean***REMOVED***up***REMOVED***jobs
***REMOVED******REMOVED******REMOVED******REMOVED***delete***REMOVED***state.jobs[key];

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(error)
***REMOVED******REMOVED******REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***don't***REMOVED***process***REMOVED***rest***REMOVED***of***REMOVED***the***REMOVED***results
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***stop***REMOVED***still***REMOVED***active***REMOVED***jobs
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***and***REMOVED***reset***REMOVED***the***REMOVED***list
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***abort(state);
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***else
***REMOVED******REMOVED******REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***state.results[key]***REMOVED***=***REMOVED***output;
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***return***REMOVED***salvaged***REMOVED***results
***REMOVED******REMOVED******REMOVED******REMOVED***callback(error,***REMOVED***state.results);
***REMOVED******REMOVED***});
}

/**
***REMOVED*******REMOVED***Runs***REMOVED***iterator***REMOVED***over***REMOVED***provided***REMOVED***job***REMOVED***element
***REMOVED****
***REMOVED*******REMOVED***@param***REMOVED******REMOVED******REMOVED***{function}***REMOVED***iterator***REMOVED***-***REMOVED***iterator***REMOVED***to***REMOVED***invoke
***REMOVED*******REMOVED***@param***REMOVED******REMOVED******REMOVED***{string|number}***REMOVED***key***REMOVED***-***REMOVED***key/index***REMOVED***of***REMOVED***the***REMOVED***element***REMOVED***in***REMOVED***the***REMOVED***list***REMOVED***of***REMOVED***jobs
***REMOVED*******REMOVED***@param***REMOVED******REMOVED******REMOVED***{mixed}***REMOVED***item***REMOVED***-***REMOVED***job***REMOVED***description
***REMOVED*******REMOVED***@param***REMOVED******REMOVED******REMOVED***{function}***REMOVED***callback***REMOVED***-***REMOVED***invoked***REMOVED***after***REMOVED***iterator***REMOVED***is***REMOVED***done***REMOVED***with***REMOVED***the***REMOVED***job
***REMOVED*******REMOVED***@returns***REMOVED***{function|mixed}***REMOVED***-***REMOVED***job***REMOVED***abort***REMOVED***function***REMOVED***or***REMOVED***something***REMOVED***else
***REMOVED****/
function***REMOVED***runJob(iterator,***REMOVED***key,***REMOVED***item,***REMOVED***callback)
{
***REMOVED******REMOVED***var***REMOVED***aborter;

***REMOVED******REMOVED***//***REMOVED***allow***REMOVED***shortcut***REMOVED***if***REMOVED***iterator***REMOVED***expects***REMOVED***only***REMOVED***two***REMOVED***arguments
***REMOVED******REMOVED***if***REMOVED***(iterator.length***REMOVED***==***REMOVED***2)
***REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***aborter***REMOVED***=***REMOVED***iterator(item,***REMOVED***async(callback));
***REMOVED******REMOVED***}
***REMOVED******REMOVED***//***REMOVED***otherwise***REMOVED***go***REMOVED***with***REMOVED***full***REMOVED***three***REMOVED***arguments
***REMOVED******REMOVED***else
***REMOVED******REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***aborter***REMOVED***=***REMOVED***iterator(item,***REMOVED***key,***REMOVED***async(callback));
***REMOVED******REMOVED***}

***REMOVED******REMOVED***return***REMOVED***aborter;
}
