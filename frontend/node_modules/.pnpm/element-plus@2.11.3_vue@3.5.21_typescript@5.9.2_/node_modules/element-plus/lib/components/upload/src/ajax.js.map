{"version":3,"file":"ajax.js","sources":["../../../../../../packages/components/upload/src/ajax.ts"],"sourcesContent":["import***REMOVED***{***REMOVED***isNil***REMOVED***}***REMOVED***from***REMOVED***'lodash-unified'\nimport***REMOVED***{***REMOVED***isArray,***REMOVED***throwError***REMOVED***}***REMOVED***from***REMOVED***'@element-plus/utils'\n\nimport***REMOVED***type***REMOVED***{\n***REMOVED******REMOVED***UploadProgressEvent,\n***REMOVED******REMOVED***UploadRequestHandler,\n***REMOVED******REMOVED***UploadRequestOptions,\n}***REMOVED***from***REMOVED***'./upload'\n\nconst***REMOVED***SCOPE***REMOVED***=***REMOVED***'ElUpload'\n\nexport***REMOVED***class***REMOVED***UploadAjaxError***REMOVED***extends***REMOVED***Error***REMOVED***{\n***REMOVED******REMOVED***name***REMOVED***=***REMOVED***'UploadAjaxError'\n***REMOVED******REMOVED***status:***REMOVED***number\n***REMOVED******REMOVED***method:***REMOVED***string\n***REMOVED******REMOVED***url:***REMOVED***string\n\n***REMOVED******REMOVED***constructor(message:***REMOVED***string,***REMOVED***status:***REMOVED***number,***REMOVED***method:***REMOVED***string,***REMOVED***url:***REMOVED***string)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***super(message)\n***REMOVED******REMOVED******REMOVED******REMOVED***this.status***REMOVED***=***REMOVED***status\n***REMOVED******REMOVED******REMOVED******REMOVED***this.method***REMOVED***=***REMOVED***method\n***REMOVED******REMOVED******REMOVED******REMOVED***this.url***REMOVED***=***REMOVED***url\n***REMOVED******REMOVED***}\n}\n\nfunction***REMOVED***getError(\n***REMOVED******REMOVED***action:***REMOVED***string,\n***REMOVED******REMOVED***option:***REMOVED***UploadRequestOptions,\n***REMOVED******REMOVED***xhr:***REMOVED***XMLHttpRequest\n)***REMOVED***{\n***REMOVED******REMOVED***let***REMOVED***msg:***REMOVED***string\n***REMOVED******REMOVED***if***REMOVED***(xhr.response)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***msg***REMOVED***=***REMOVED***`${xhr.response.error***REMOVED***||***REMOVED***xhr.response}`\n***REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(xhr.responseText)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***msg***REMOVED***=***REMOVED***`${xhr.responseText}`\n***REMOVED******REMOVED***}***REMOVED***else***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***msg***REMOVED***=***REMOVED***`fail***REMOVED***to***REMOVED***${option.method}***REMOVED***${action}***REMOVED***${xhr.status}`\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***return***REMOVED***new***REMOVED***UploadAjaxError(msg,***REMOVED***xhr.status,***REMOVED***option.method,***REMOVED***action)\n}\n\nfunction***REMOVED***getBody(xhr:***REMOVED***XMLHttpRequest):***REMOVED***XMLHttpRequestResponseType***REMOVED***{\n***REMOVED******REMOVED***const***REMOVED***text***REMOVED***=***REMOVED***xhr.responseText***REMOVED***||***REMOVED***xhr.response\n***REMOVED******REMOVED***if***REMOVED***(!text)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***text\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***try***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***JSON.parse(text)\n***REMOVED******REMOVED***}***REMOVED***catch***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***text\n***REMOVED******REMOVED***}\n}\n\nexport***REMOVED***const***REMOVED***ajaxUpload:***REMOVED***UploadRequestHandler***REMOVED***=***REMOVED***(option)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***XMLHttpRequest***REMOVED***===***REMOVED***'undefined')\n***REMOVED******REMOVED******REMOVED******REMOVED***throwError(SCOPE,***REMOVED***'XMLHttpRequest***REMOVED***is***REMOVED***undefined')\n\n***REMOVED******REMOVED***const***REMOVED***xhr***REMOVED***=***REMOVED***new***REMOVED***XMLHttpRequest()\n***REMOVED******REMOVED***const***REMOVED***action***REMOVED***=***REMOVED***option.action\n\n***REMOVED******REMOVED***if***REMOVED***(xhr.upload)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***xhr.upload.addEventListener('progress',***REMOVED***(evt)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***progressEvt***REMOVED***=***REMOVED***evt***REMOVED***as***REMOVED***UploadProgressEvent\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***progressEvt.percent***REMOVED***=***REMOVED***evt.total***REMOVED***>***REMOVED***0***REMOVED***?***REMOVED***(evt.loaded***REMOVED***/***REMOVED***evt.total)***REMOVED*******REMOVED***100***REMOVED***:***REMOVED***0\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***option.onProgress(progressEvt)\n***REMOVED******REMOVED******REMOVED******REMOVED***})\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***formData***REMOVED***=***REMOVED***new***REMOVED***FormData()\n***REMOVED******REMOVED***if***REMOVED***(option.data)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(const***REMOVED***[key,***REMOVED***value]***REMOVED***of***REMOVED***Object.entries(option.data))***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isArray(value)***REMOVED***&&***REMOVED***value.length)***REMOVED***formData.append(key,***REMOVED***...value)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***else***REMOVED***formData.append(key,***REMOVED***value)\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***}\n***REMOVED******REMOVED***formData.append(option.filename,***REMOVED***option.file,***REMOVED***option.file.name)\n\n***REMOVED******REMOVED***xhr.addEventListener('error',***REMOVED***()***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***option.onError(getError(action,***REMOVED***option,***REMOVED***xhr))\n***REMOVED******REMOVED***})\n\n***REMOVED******REMOVED***xhr.addEventListener('load',***REMOVED***()***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(xhr.status***REMOVED***<***REMOVED***200***REMOVED***||***REMOVED***xhr.status***REMOVED***>=***REMOVED***300)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***option.onError(getError(action,***REMOVED***option,***REMOVED***xhr))\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***option.onSuccess(getBody(xhr))\n***REMOVED******REMOVED***})\n\n***REMOVED******REMOVED***xhr.open(option.method,***REMOVED***action,***REMOVED***true)\n\n***REMOVED******REMOVED***if***REMOVED***(option.withCredentials***REMOVED***&&***REMOVED***'withCredentials'***REMOVED***in***REMOVED***xhr)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***xhr.withCredentials***REMOVED***=***REMOVED***true\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***headers***REMOVED***=***REMOVED***option.headers***REMOVED***||***REMOVED***{}\n***REMOVED******REMOVED***if***REMOVED***(headers***REMOVED***instanceof***REMOVED***Headers)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***headers.forEach((value,***REMOVED***key)***REMOVED***=>***REMOVED***xhr.setRequestHeader(key,***REMOVED***value))\n***REMOVED******REMOVED***}***REMOVED***else***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(const***REMOVED***[key,***REMOVED***value]***REMOVED***of***REMOVED***Object.entries(headers))***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isNil(value))***REMOVED***continue\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***xhr.setRequestHeader(key,***REMOVED***String(value))\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***xhr.send(formData)\n***REMOVED******REMOVED***return***REMOVED***xhr\n}\n"],"names":["throwError","isArray","isNil"],"mappings":"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"}