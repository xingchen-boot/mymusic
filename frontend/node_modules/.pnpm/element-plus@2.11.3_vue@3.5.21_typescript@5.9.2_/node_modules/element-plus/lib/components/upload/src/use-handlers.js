'use***REMOVED***strict';

Object.defineProperty(exports,***REMOVED***'__esModule',***REMOVED***{***REMOVED***value:***REMOVED***true***REMOVED***});

var***REMOVED***vue***REMOVED***=***REMOVED***require('vue');
var***REMOVED***lodashUnified***REMOVED***=***REMOVED***require('lodash-unified');
var***REMOVED***core***REMOVED***=***REMOVED***require('@vueuse/core');
var***REMOVED***upload***REMOVED***=***REMOVED***require('./upload.js');
var***REMOVED***error***REMOVED***=***REMOVED***require('../../../utils/error.js');

const***REMOVED***SCOPE***REMOVED***=***REMOVED***"ElUpload";
const***REMOVED***revokeFileObjectURL***REMOVED***=***REMOVED***(file)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***var***REMOVED***_a;
***REMOVED******REMOVED***if***REMOVED***((_a***REMOVED***=***REMOVED***file.url)***REMOVED***==***REMOVED***null***REMOVED***?***REMOVED***void***REMOVED***0***REMOVED***:***REMOVED***_a.startsWith("blob:"))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***URL.revokeObjectURL(file.url);
***REMOVED******REMOVED***}
};
const***REMOVED***useHandlers***REMOVED***=***REMOVED***(props,***REMOVED***uploadRef)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***const***REMOVED***uploadFiles***REMOVED***=***REMOVED***core.useVModel(props,***REMOVED***"fileList",***REMOVED***void***REMOVED***0,***REMOVED***{***REMOVED***passive:***REMOVED***true***REMOVED***});
***REMOVED******REMOVED***const***REMOVED***getFile***REMOVED***=***REMOVED***(rawFile)***REMOVED***=>***REMOVED***uploadFiles.value.find((file)***REMOVED***=>***REMOVED***file.uid***REMOVED***===***REMOVED***rawFile.uid);
***REMOVED******REMOVED***function***REMOVED***abort(file)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***var***REMOVED***_a;
***REMOVED******REMOVED******REMOVED******REMOVED***(_a***REMOVED***=***REMOVED***uploadRef.value)***REMOVED***==***REMOVED***null***REMOVED***?***REMOVED***void***REMOVED***0***REMOVED***:***REMOVED***_a.abort(file);
***REMOVED******REMOVED***}
***REMOVED******REMOVED***function***REMOVED***clearFiles(states***REMOVED***=***REMOVED***["ready",***REMOVED***"uploading",***REMOVED***"success",***REMOVED***"fail"])***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles.value***REMOVED***=***REMOVED***uploadFiles.value.filter((row)***REMOVED***=>***REMOVED***!states.includes(row.status));
***REMOVED******REMOVED***}
***REMOVED******REMOVED***function***REMOVED***removeFile(file)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles.value***REMOVED***=***REMOVED***uploadFiles.value.filter((uploadFile)***REMOVED***=>***REMOVED***uploadFile.uid***REMOVED***!==***REMOVED***file.uid);
***REMOVED******REMOVED***}
***REMOVED******REMOVED***const***REMOVED***handleError***REMOVED***=***REMOVED***(err,***REMOVED***rawFile)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***file***REMOVED***=***REMOVED***getFile(rawFile);
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!file)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***console.error(err);
***REMOVED******REMOVED******REMOVED******REMOVED***file.status***REMOVED***=***REMOVED***"fail";
***REMOVED******REMOVED******REMOVED******REMOVED***removeFile(file);
***REMOVED******REMOVED******REMOVED******REMOVED***props.onError(err,***REMOVED***file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED***props.onChange(file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED***};
***REMOVED******REMOVED***const***REMOVED***handleProgress***REMOVED***=***REMOVED***(evt,***REMOVED***rawFile)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***file***REMOVED***=***REMOVED***getFile(rawFile);
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!file)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***props.onProgress(evt,***REMOVED***file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED***file.status***REMOVED***=***REMOVED***"uploading";
***REMOVED******REMOVED******REMOVED******REMOVED***file.percentage***REMOVED***=***REMOVED***Math.round(evt.percent);
***REMOVED******REMOVED***};
***REMOVED******REMOVED***const***REMOVED***handleSuccess***REMOVED***=***REMOVED***(response,***REMOVED***rawFile)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***file***REMOVED***=***REMOVED***getFile(rawFile);
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!file)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***file.status***REMOVED***=***REMOVED***"success";
***REMOVED******REMOVED******REMOVED******REMOVED***file.response***REMOVED***=***REMOVED***response;
***REMOVED******REMOVED******REMOVED******REMOVED***props.onSuccess(response,***REMOVED***file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED***props.onChange(file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED***};
***REMOVED******REMOVED***const***REMOVED***handleStart***REMOVED***=***REMOVED***(file)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(lodashUnified.isNil(file.uid))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file.uid***REMOVED***=***REMOVED***upload.genFileId();
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***uploadFile***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***name:***REMOVED***file.name,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***percentage:***REMOVED***0,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***status:***REMOVED***"ready",
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***size:***REMOVED***file.size,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***raw:***REMOVED***file,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***uid:***REMOVED***file.uid
***REMOVED******REMOVED******REMOVED******REMOVED***};
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(props.listType***REMOVED***===***REMOVED***"picture-card"***REMOVED***||***REMOVED***props.listType***REMOVED***===***REMOVED***"picture")***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***uploadFile.url***REMOVED***=***REMOVED***URL.createObjectURL(file);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(err)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***error.debugWarn(SCOPE,***REMOVED***err.message);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***props.onError(err,***REMOVED***uploadFile,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles.value***REMOVED***=***REMOVED***[...uploadFiles.value,***REMOVED***uploadFile];
***REMOVED******REMOVED******REMOVED******REMOVED***props.onChange(uploadFile,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED***};
***REMOVED******REMOVED***const***REMOVED***handleRemove***REMOVED***=***REMOVED***async***REMOVED***(file)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***uploadFile***REMOVED***=***REMOVED***file***REMOVED***instanceof***REMOVED***File***REMOVED***?***REMOVED***getFile(file)***REMOVED***:***REMOVED***file;
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!uploadFile)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***error.throwError(SCOPE,***REMOVED***"file***REMOVED***to***REMOVED***be***REMOVED***removed***REMOVED***not***REMOVED***found");
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***doRemove***REMOVED***=***REMOVED***(file2)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***abort(file2);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***removeFile(file2);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***props.onRemove(file2,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***revokeFileObjectURL(file2);
***REMOVED******REMOVED******REMOVED******REMOVED***};
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(props.beforeRemove)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***before***REMOVED***=***REMOVED***await***REMOVED***props.beforeRemove(uploadFile,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(before***REMOVED***!==***REMOVED***false)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***doRemove(uploadFile);
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***doRemove(uploadFile);
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***};
***REMOVED******REMOVED***function***REMOVED***submit()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles.value.filter(({***REMOVED***status***REMOVED***})***REMOVED***=>***REMOVED***status***REMOVED***===***REMOVED***"ready").forEach(({***REMOVED***raw***REMOVED***})***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***var***REMOVED***_a;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***raw***REMOVED***&&***REMOVED***((_a***REMOVED***=***REMOVED***uploadRef.value)***REMOVED***==***REMOVED***null***REMOVED***?***REMOVED***void***REMOVED***0***REMOVED***:***REMOVED***_a.upload(raw));
***REMOVED******REMOVED******REMOVED******REMOVED***});
***REMOVED******REMOVED***}
***REMOVED******REMOVED***vue.watch(()***REMOVED***=>***REMOVED***props.listType,***REMOVED***(val)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(val***REMOVED***!==***REMOVED***"picture-card"***REMOVED***&&***REMOVED***val***REMOVED***!==***REMOVED***"picture")***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles.value***REMOVED***=***REMOVED***uploadFiles.value.map((file)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***raw,***REMOVED***url***REMOVED***}***REMOVED***=***REMOVED***file;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!url***REMOVED***&&***REMOVED***raw)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file.url***REMOVED***=***REMOVED***URL.createObjectURL(raw);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(err)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***props.onError(err,***REMOVED***file,***REMOVED***uploadFiles.value);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***file;
***REMOVED******REMOVED******REMOVED******REMOVED***});
***REMOVED******REMOVED***});
***REMOVED******REMOVED***vue.watch(uploadFiles,***REMOVED***(files)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(const***REMOVED***file***REMOVED***of***REMOVED***files)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file.uid***REMOVED***||***REMOVED***(file.uid***REMOVED***=***REMOVED***upload.genFileId());
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***file.status***REMOVED***||***REMOVED***(file.status***REMOVED***=***REMOVED***"success");
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***},***REMOVED***{***REMOVED***immediate:***REMOVED***true,***REMOVED***deep:***REMOVED***true***REMOVED***});
***REMOVED******REMOVED***return***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***uploadFiles,
***REMOVED******REMOVED******REMOVED******REMOVED***abort,
***REMOVED******REMOVED******REMOVED******REMOVED***clearFiles,
***REMOVED******REMOVED******REMOVED******REMOVED***handleError,
***REMOVED******REMOVED******REMOVED******REMOVED***handleProgress,
***REMOVED******REMOVED******REMOVED******REMOVED***handleStart,
***REMOVED******REMOVED******REMOVED******REMOVED***handleSuccess,
***REMOVED******REMOVED******REMOVED******REMOVED***handleRemove,
***REMOVED******REMOVED******REMOVED******REMOVED***submit,
***REMOVED******REMOVED******REMOVED******REMOVED***revokeFileObjectURL
***REMOVED******REMOVED***};
};

exports.useHandlers***REMOVED***=***REMOVED***useHandlers;
//#***REMOVED***sourceMappingURL=use-handlers.js.map
