{"version":3,"file":"index.mjs","sources":["../../../../../packages/directives/trap-focus/index.ts"],"sourcesContent":["import***REMOVED***{***REMOVED***nextTick***REMOVED***}***REMOVED***from***REMOVED***'vue'\nimport***REMOVED***{***REMOVED***obtainAllFocusableElements***REMOVED***}***REMOVED***from***REMOVED***'@element-plus/utils'\nimport***REMOVED***{***REMOVED***EVENT_CODE***REMOVED***}***REMOVED***from***REMOVED***'@element-plus/constants'\n\nimport***REMOVED***type***REMOVED***{***REMOVED***ObjectDirective***REMOVED***}***REMOVED***from***REMOVED***'vue'\n\nexport***REMOVED***const***REMOVED***FOCUSABLE_CHILDREN***REMOVED***=***REMOVED***'_trap-focus-children'\nexport***REMOVED***const***REMOVED***TRAP_FOCUS_HANDLER***REMOVED***=***REMOVED***'_trap-focus-handler'\n\nexport***REMOVED***interface***REMOVED***TrapFocusElement***REMOVED***extends***REMOVED***HTMLElement***REMOVED***{\n***REMOVED******REMOVED***[FOCUSABLE_CHILDREN]:***REMOVED***HTMLElement[]\n***REMOVED******REMOVED***[TRAP_FOCUS_HANDLER]:***REMOVED***(e:***REMOVED***KeyboardEvent)***REMOVED***=>***REMOVED***void\n}\n\nconst***REMOVED***FOCUS_STACK:***REMOVED***TrapFocusElement[]***REMOVED***=***REMOVED***[]\n\nconst***REMOVED***FOCUS_HANDLER***REMOVED***=***REMOVED***(e:***REMOVED***KeyboardEvent)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED***//***REMOVED***Getting***REMOVED***the***REMOVED***top***REMOVED***layer.\n***REMOVED******REMOVED***if***REMOVED***(FOCUS_STACK.length***REMOVED***===***REMOVED***0)***REMOVED***return\n***REMOVED******REMOVED***const***REMOVED***focusableElement***REMOVED***=\n***REMOVED******REMOVED******REMOVED******REMOVED***FOCUS_STACK[FOCUS_STACK.length***REMOVED***-***REMOVED***1][FOCUSABLE_CHILDREN]\n***REMOVED******REMOVED***if***REMOVED***(focusableElement.length***REMOVED***>***REMOVED***0***REMOVED***&&***REMOVED***e.code***REMOVED***===***REMOVED***EVENT_CODE.tab)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(focusableElement.length***REMOVED***===***REMOVED***1)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***e.preventDefault()\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(document.activeElement***REMOVED***!==***REMOVED***focusableElement[0])***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***focusableElement[0].focus()\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***goingBackward***REMOVED***=***REMOVED***e.shiftKey\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***isFirst***REMOVED***=***REMOVED***e.target***REMOVED***===***REMOVED***focusableElement[0]\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***isLast***REMOVED***=***REMOVED***e.target***REMOVED***===***REMOVED***focusableElement[focusableElement.length***REMOVED***-***REMOVED***1]\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isFirst***REMOVED***&&***REMOVED***goingBackward)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***e.preventDefault()\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***focusableElement[focusableElement.length***REMOVED***-***REMOVED***1].focus()\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isLast***REMOVED***&&***REMOVED***!goingBackward)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***e.preventDefault()\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***focusableElement[0].focus()\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n\n***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***the***REMOVED***is***REMOVED***critical***REMOVED***since***REMOVED***jsdom***REMOVED***did***REMOVED***not***REMOVED***implement***REMOVED***user***REMOVED***actions,***REMOVED***you***REMOVED***can***REMOVED***only***REMOVED***mock***REMOVED***it\n***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***DELETE***REMOVED***ME:***REMOVED***when***REMOVED***testing***REMOVED***env***REMOVED***switches***REMOVED***to***REMOVED***puppeteer\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(process.env.NODE_ENV***REMOVED***===***REMOVED***'test')***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***index***REMOVED***=***REMOVED***focusableElement.indexOf(e.target***REMOVED***as***REMOVED***HTMLElement)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(index***REMOVED***!==***REMOVED***-1)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***focusableElement[goingBackward***REMOVED***?***REMOVED***index***REMOVED***-***REMOVED***1***REMOVED***:***REMOVED***index***REMOVED***+***REMOVED***1]?.focus()\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***}\n}\n\nconst***REMOVED***TrapFocus:***REMOVED***ObjectDirective***REMOVED***=***REMOVED***{\n***REMOVED******REMOVED***beforeMount(el:***REMOVED***TrapFocusElement)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***el[FOCUSABLE_CHILDREN]***REMOVED***=***REMOVED***obtainAllFocusableElements(el)\n***REMOVED******REMOVED******REMOVED******REMOVED***FOCUS_STACK.push(el)\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(FOCUS_STACK.length***REMOVED***<=***REMOVED***1)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***document.addEventListener('keydown',***REMOVED***FOCUS_HANDLER)\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***},\n***REMOVED******REMOVED***updated(el:***REMOVED***TrapFocusElement)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***nextTick(()***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***el[FOCUSABLE_CHILDREN]***REMOVED***=***REMOVED***obtainAllFocusableElements(el)\n***REMOVED******REMOVED******REMOVED******REMOVED***})\n***REMOVED******REMOVED***},\n***REMOVED******REMOVED***unmounted()***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***FOCUS_STACK.shift()\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(FOCUS_STACK.length***REMOVED***===***REMOVED***0)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***document.removeEventListener('keydown',***REMOVED***FOCUS_HANDLER)\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***},\n}\n\nexport***REMOVED***default***REMOVED***TrapFocus\n"],"names":[],"mappings":";;;;AAGY,MAAC,kBAAkB,GAAG,uBAAuB;AAC7C,MAAC,kBAAkB,GAAG,sBAAsB;AACxD,MAAM,WAAW,GAAG,EAAE,CAAC;AACvB,MAAM,aAAa,GAAG,CAAC,CAAC,KAAK;AAC7B,EAAE,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC;AAC9B,IAAI,OAAO;AACX,EAAE,MAAM,gBAAgB,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC;AACnF,EAAE,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,GAAG,EAAE;AAChE,IAAI,IAAI,gBAAgB,CAAC,MAAM,KAAK,CAAC,EAAE;AACvC,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC;AACzB,MAAM,IAAI,QAAQ,CAAC,aAAa,KAAK,gBAAgB,CAAC,CAAC,CAAC,EAAE;AAC1D,QAAQ,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;AACpC,OAAO;AACP,MAAM,OAAO;AACb,KAAK;AACL,IAAI,MAAM,aAAa,GAAG,CAAC,CAAC,QAAQ,CAAC;AACrC,IAAI,MAAM,OAAO,GAAG,CAAC,CAAC,MAAM,KAAK,gBAAgB,CAAC,CAAC,CAAC,CAAC;AACrD,IAAI,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM,KAAK,gBAAgB,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AAC9E,IAAI,IAAI,OAAO,IAAI,aAAa,EAAE;AAClC,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC;AACzB,MAAM,gBAAgB,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;AAC5D,KAAK;AACL,IAAI,IAAI,MAAM,IAAI,CAAC,aAAa,EAAE;AAClC,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC;AACzB,MAAM,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;AAClC,KAAK;AAOL,GAAG;AACH,CAAC,CAAC;AACG,MAAC,SAAS,GAAG;AAClB,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,EAAE,CAAC,kBAAkB,CAAC,GAAG,0BAA0B,CAAC,EAAE,CAAC,CAAC;AAC5D,IAAI,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACzB,IAAI,IAAI,WAAW,CAAC,MAAM,IAAI,CAAC,EAAE;AACjC,MAAM,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;AAC1D,KAAK;AACL,GAAG;AACH,EAAE,OAAO,CAAC,EAAE,EAAE;AACd,IAAI,QAAQ,CAAC,MAAM;AACnB,MAAM,EAAE,CAAC,kBAAkB,CAAC,GAAG,0BAA0B,CAAC,EAAE,CAAC,CAAC;AAC9D,KAAK,CAAC,CAAC;AACP,GAAG;AACH,EAAE,SAAS,GAAG;AACd,IAAI,WAAW,CAAC,KAAK,EAAE,CAAC;AACxB,IAAI,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE;AAClC,MAAM,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;AAC7D,KAAK;AACL,GAAG;AACH;;;;"}