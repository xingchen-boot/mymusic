{"version":3,"file":"current.mjs","sources":["../../../../../../../packages/components/table/src/store/current.ts"],"sourcesContent":["import***REMOVED***{***REMOVED***getCurrentInstance,***REMOVED***ref,***REMOVED***unref***REMOVED***}***REMOVED***from***REMOVED***'vue'\nimport***REMOVED***{***REMOVED***isNull***REMOVED***}***REMOVED***from***REMOVED***'lodash-unified'\nimport***REMOVED***{***REMOVED***getRowIdentity***REMOVED***}***REMOVED***from***REMOVED***'../util'\n\nimport***REMOVED***type***REMOVED***{***REMOVED***Ref***REMOVED***}***REMOVED***from***REMOVED***'vue'\nimport***REMOVED***type***REMOVED***{***REMOVED***DefaultRow,***REMOVED***Table***REMOVED***}***REMOVED***from***REMOVED***'../table/defaults'\nimport***REMOVED***type***REMOVED***{***REMOVED***WatcherPropsData***REMOVED***}***REMOVED***from***REMOVED***'.'\n\nfunction***REMOVED***useCurrent<T***REMOVED***extends***REMOVED***DefaultRow>(watcherData:***REMOVED***WatcherPropsData<T>)***REMOVED***{\n***REMOVED******REMOVED***const***REMOVED***instance***REMOVED***=***REMOVED***getCurrentInstance()***REMOVED***as***REMOVED***Table<T>\n***REMOVED******REMOVED***const***REMOVED***_currentRowKey:***REMOVED***Ref<string***REMOVED***|***REMOVED***null>***REMOVED***=***REMOVED***ref(null)\n***REMOVED******REMOVED***const***REMOVED***currentRow:***REMOVED***Ref<T***REMOVED***|***REMOVED***null>***REMOVED***=***REMOVED***ref(null)\n\n***REMOVED******REMOVED***const***REMOVED***setCurrentRowKey***REMOVED***=***REMOVED***(key:***REMOVED***string)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***instance.store.assertRowKey()\n***REMOVED******REMOVED******REMOVED******REMOVED***_currentRowKey.value***REMOVED***=***REMOVED***key\n***REMOVED******REMOVED******REMOVED******REMOVED***setCurrentRowByKey(key)\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***restoreCurrentRowKey***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***_currentRowKey.value***REMOVED***=***REMOVED***null\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***setCurrentRowByKey***REMOVED***=***REMOVED***(key:***REMOVED***string)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***data,***REMOVED***rowKey***REMOVED***}***REMOVED***=***REMOVED***watcherData\n***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***_currentRow:***REMOVED***T***REMOVED***|***REMOVED***null***REMOVED***=***REMOVED***null\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(rowKey.value)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***_currentRow***REMOVED***=\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***(unref(data)***REMOVED***||***REMOVED***[]).find(\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***(item)***REMOVED***=>***REMOVED***getRowIdentity(item,***REMOVED***rowKey.value)***REMOVED***===***REMOVED***key\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***)***REMOVED***??***REMOVED***null\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***currentRow.value***REMOVED***=***REMOVED***_currentRow***REMOVED***??***REMOVED***null\n***REMOVED******REMOVED******REMOVED******REMOVED***instance.emit('current-change',***REMOVED***currentRow.value,***REMOVED***null)\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***updateCurrentRow***REMOVED***=***REMOVED***(_currentRow:***REMOVED***T)***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***oldCurrentRow***REMOVED***=***REMOVED***currentRow.value\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(_currentRow***REMOVED***&&***REMOVED***_currentRow***REMOVED***!==***REMOVED***oldCurrentRow)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentRow.value***REMOVED***=***REMOVED***_currentRow\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***instance.emit('current-change',***REMOVED***currentRow.value,***REMOVED***oldCurrentRow)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!_currentRow***REMOVED***&&***REMOVED***oldCurrentRow)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentRow.value***REMOVED***=***REMOVED***null\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***instance.emit('current-change',***REMOVED***null,***REMOVED***oldCurrentRow)\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***const***REMOVED***updateCurrentRowData***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***rowKey***REMOVED***=***REMOVED***watcherData.rowKey.value\n***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***data***REMOVED***为***REMOVED***null***REMOVED***时，解构时的默认值会被忽略\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***data***REMOVED***=***REMOVED***watcherData.data.value***REMOVED***||***REMOVED***[]\n***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***oldCurrentRow***REMOVED***=***REMOVED***currentRow.value\n***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***当***REMOVED***currentRow***REMOVED***不在***REMOVED***data***REMOVED***中时尝试更新数据\n***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(oldCurrentRow***REMOVED***&&***REMOVED***!data.includes(oldCurrentRow))***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(rowKey)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentRowKey***REMOVED***=***REMOVED***getRowIdentity(oldCurrentRow,***REMOVED***rowKey)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***setCurrentRowByKey(currentRowKey)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentRow.value***REMOVED***=***REMOVED***null\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isNull(currentRow.value))***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***instance.emit('current-change',***REMOVED***null,***REMOVED***oldCurrentRow)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(_currentRowKey.value)***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***把初始时下设置的***REMOVED***rowKey***REMOVED***转化成***REMOVED***rowData\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***setCurrentRowByKey(_currentRowKey.value)\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***restoreCurrentRowKey()\n***REMOVED******REMOVED******REMOVED******REMOVED***}\n***REMOVED******REMOVED***}\n\n***REMOVED******REMOVED***return***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED***setCurrentRowKey,\n***REMOVED******REMOVED******REMOVED******REMOVED***restoreCurrentRowKey,\n***REMOVED******REMOVED******REMOVED******REMOVED***setCurrentRowByKey,\n***REMOVED******REMOVED******REMOVED******REMOVED***updateCurrentRow,\n***REMOVED******REMOVED******REMOVED******REMOVED***updateCurrentRowData,\n***REMOVED******REMOVED******REMOVED******REMOVED***states:***REMOVED***{\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***_currentRowKey,\n***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentRow,\n***REMOVED******REMOVED******REMOVED******REMOVED***},\n***REMOVED******REMOVED***}\n}\n\nexport***REMOVED***default***REMOVED***useCurrent\n"],"names":[],"mappings":"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"}