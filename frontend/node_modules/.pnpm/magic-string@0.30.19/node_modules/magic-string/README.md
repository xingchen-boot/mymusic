#***REMOVED***magic-string

<a***REMOVED***href="https://github.com/Rich-Harris/magic-string/actions/workflows/test.yml">
***REMOVED******REMOVED***<img***REMOVED***src="https://img.shields.io/github/actions/workflow/status/Rich-Harris/magic-string/test.yml"
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***alt="build***REMOVED***status">
</a>
<a***REMOVED***href="https://npmjs.org/package/magic-string">
***REMOVED******REMOVED***<img***REMOVED***src="https://img.shields.io/npm/v/magic-string.svg"
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***alt="npm***REMOVED***version">
</a>
<a***REMOVED***href="https://github.com/Rich-Harris/magic-string/blob/master/LICENSE.md">
***REMOVED******REMOVED***<img***REMOVED***src="https://img.shields.io/npm/l/magic-string.svg"
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***alt="license">
</a>

Suppose***REMOVED***you***REMOVED***have***REMOVED***some***REMOVED***source***REMOVED***code.***REMOVED***You***REMOVED***want***REMOVED***to***REMOVED***make***REMOVED***some***REMOVED***light***REMOVED***modifications***REMOVED***to***REMOVED***it***REMOVED***-***REMOVED***replacing***REMOVED***a***REMOVED***few***REMOVED***characters***REMOVED***here***REMOVED***and***REMOVED***there,***REMOVED***wrapping***REMOVED***it***REMOVED***with***REMOVED***a***REMOVED***header***REMOVED***and***REMOVED***footer,***REMOVED***etc***REMOVED***-***REMOVED***and***REMOVED***ideally***REMOVED***you'd***REMOVED***like***REMOVED***to***REMOVED***generate***REMOVED***a***REMOVED***[source***REMOVED***map](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/)***REMOVED***at***REMOVED***the***REMOVED***end***REMOVED***of***REMOVED***it.***REMOVED***You've***REMOVED***thought***REMOVED***about***REMOVED***using***REMOVED***something***REMOVED***like***REMOVED***[recast](https://github.com/benjamn/recast)***REMOVED***(which***REMOVED***allows***REMOVED***you***REMOVED***to***REMOVED***generate***REMOVED***an***REMOVED***AST***REMOVED***from***REMOVED***some***REMOVED***JavaScript,***REMOVED***manipulate***REMOVED***it,***REMOVED***and***REMOVED***reprint***REMOVED***it***REMOVED***with***REMOVED***a***REMOVED***sourcemap***REMOVED***without***REMOVED***losing***REMOVED***your***REMOVED***comments***REMOVED***and***REMOVED***formatting),***REMOVED***but***REMOVED***it***REMOVED***seems***REMOVED***like***REMOVED***overkill***REMOVED***for***REMOVED***your***REMOVED***needs***REMOVED***(or***REMOVED***maybe***REMOVED***the***REMOVED***source***REMOVED***code***REMOVED***isn't***REMOVED***JavaScript).

Your***REMOVED***requirements***REMOVED***are,***REMOVED***frankly,***REMOVED***rather***REMOVED***niche.***REMOVED***But***REMOVED***they're***REMOVED***requirements***REMOVED***that***REMOVED***I***REMOVED***also***REMOVED***have,***REMOVED***and***REMOVED***for***REMOVED***which***REMOVED***I***REMOVED***made***REMOVED***magic-string.***REMOVED***It's***REMOVED***a***REMOVED***small,***REMOVED***fast***REMOVED***utility***REMOVED***for***REMOVED***manipulating***REMOVED***strings***REMOVED***and***REMOVED***generating***REMOVED***sourcemaps.

##***REMOVED***Installation

magic-string***REMOVED***works***REMOVED***in***REMOVED***both***REMOVED***node.js***REMOVED***and***REMOVED***browser***REMOVED***environments.***REMOVED***For***REMOVED***node,***REMOVED***install***REMOVED***with***REMOVED***npm:

```bash
npm***REMOVED***i***REMOVED***magic-string
```

To***REMOVED***use***REMOVED***in***REMOVED***browser,***REMOVED***grab***REMOVED***the***REMOVED***[magic-string.umd.js](https://unpkg.com/magic-string/dist/magic-string.umd.js)***REMOVED***file***REMOVED***and***REMOVED***add***REMOVED***it***REMOVED***to***REMOVED***your***REMOVED***page:

```html
<script***REMOVED***src="magic-string.umd.js"></script>
```

(It***REMOVED***also***REMOVED***works***REMOVED***with***REMOVED***various***REMOVED***module***REMOVED***systems,***REMOVED***if***REMOVED***you***REMOVED***prefer***REMOVED***that***REMOVED***sort***REMOVED***of***REMOVED***thing***REMOVED***-***REMOVED***it***REMOVED***has***REMOVED***a***REMOVED***dependency***REMOVED***on***REMOVED***[vlq](https://github.com/Rich-Harris/vlq).)

##***REMOVED***Usage

These***REMOVED***examples***REMOVED***assume***REMOVED***you're***REMOVED***in***REMOVED***node.js,***REMOVED***or***REMOVED***something***REMOVED***similar:

```js
import***REMOVED***MagicString***REMOVED***from***REMOVED***'magic-string';
import***REMOVED***fs***REMOVED***from***REMOVED***'fs';

const***REMOVED***s***REMOVED***=***REMOVED***new***REMOVED***MagicString('problems***REMOVED***=***REMOVED***99');

s.update(0,***REMOVED***8,***REMOVED***'answer');
s.toString();***REMOVED***//***REMOVED***'answer***REMOVED***=***REMOVED***99'

s.update(11,***REMOVED***13,***REMOVED***'42');***REMOVED***//***REMOVED***character***REMOVED***indices***REMOVED***always***REMOVED***refer***REMOVED***to***REMOVED***the***REMOVED***original***REMOVED***string
s.toString();***REMOVED***//***REMOVED***'answer***REMOVED***=***REMOVED***42'

s.prepend('var***REMOVED***').append(';');***REMOVED***//***REMOVED***most***REMOVED***methods***REMOVED***are***REMOVED***chainable
s.toString();***REMOVED***//***REMOVED***'var***REMOVED***answer***REMOVED***=***REMOVED***42;'

const***REMOVED***map***REMOVED***=***REMOVED***s.generateMap({
	source:***REMOVED***'source.js',
	file:***REMOVED***'converted.js.map',
	includeContent:***REMOVED***true,
});***REMOVED***//***REMOVED***generates***REMOVED***a***REMOVED***v3***REMOVED***sourcemap

fs.writeFileSync('converted.js',***REMOVED***s.toString());
fs.writeFileSync('converted.js.map',***REMOVED***map.toString());
```

You***REMOVED***can***REMOVED***pass***REMOVED***an***REMOVED***options***REMOVED***argument:

```js
const***REMOVED***s***REMOVED***=***REMOVED***new***REMOVED***MagicString(someCode,***REMOVED***{
	//***REMOVED***these***REMOVED***options***REMOVED***will***REMOVED***be***REMOVED***used***REMOVED***if***REMOVED***you***REMOVED***later***REMOVED***call***REMOVED***`bundle.addSource(***REMOVED***s***REMOVED***)`***REMOVED***-***REMOVED***see***REMOVED***below
	filename:***REMOVED***'foo.js',
	indentExclusionRanges:***REMOVED***[
		/*...*/
	],
	//***REMOVED***mark***REMOVED***source***REMOVED***as***REMOVED***ignore***REMOVED***in***REMOVED***DevTools,***REMOVED***see***REMOVED***below***REMOVED***#Bundling
	ignoreList:***REMOVED***false,
	//***REMOVED***adjust***REMOVED***the***REMOVED***incoming***REMOVED***position***REMOVED***-***REMOVED***see***REMOVED***below
	offset:***REMOVED***0,
});
```

##***REMOVED***Properties

###***REMOVED***s.offset

Sets***REMOVED***the***REMOVED***offset***REMOVED***property***REMOVED***to***REMOVED***adjust***REMOVED***the***REMOVED***incoming***REMOVED***position***REMOVED***for***REMOVED***the***REMOVED***following***REMOVED***APIs:***REMOVED***`slice`,***REMOVED***`update`,***REMOVED***`overwrite`,***REMOVED***`appendLeft`,***REMOVED***`prependLeft`,***REMOVED***`appendRight`,***REMOVED***`prependRight`,***REMOVED***`move`,***REMOVED***`reset`,***REMOVED***and***REMOVED***`remove`.

Example***REMOVED***usage:

```ts
const***REMOVED***s***REMOVED***=***REMOVED***new***REMOVED***MagicString('hello***REMOVED***world',***REMOVED***{***REMOVED***offset:***REMOVED***0***REMOVED***});
s.offset***REMOVED***=***REMOVED***6;
s.slice()***REMOVED***===***REMOVED***'world';
```

##***REMOVED***Methods

###***REMOVED***s.addSourcemapLocation(***REMOVED***index***REMOVED***)

Adds***REMOVED***the***REMOVED***specified***REMOVED***character***REMOVED***index***REMOVED***(with***REMOVED***respect***REMOVED***to***REMOVED***the***REMOVED***original***REMOVED***string)***REMOVED***to***REMOVED***sourcemap***REMOVED***mappings,***REMOVED***if***REMOVED***`hires`***REMOVED***is***REMOVED***`false`***REMOVED***(see***REMOVED***below).

###***REMOVED***s.append(***REMOVED***content***REMOVED***)

Appends***REMOVED***the***REMOVED***specified***REMOVED***content***REMOVED***to***REMOVED***the***REMOVED***end***REMOVED***of***REMOVED***the***REMOVED***string.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.appendLeft(***REMOVED***index,***REMOVED***content***REMOVED***)

Appends***REMOVED***the***REMOVED***specified***REMOVED***`content`***REMOVED***at***REMOVED***the***REMOVED***`index`***REMOVED***in***REMOVED***the***REMOVED***original***REMOVED***string.***REMOVED***If***REMOVED***a***REMOVED***range***REMOVED***_ending_***REMOVED***with***REMOVED***`index`***REMOVED***is***REMOVED***subsequently***REMOVED***moved,***REMOVED***the***REMOVED***insert***REMOVED***will***REMOVED***be***REMOVED***moved***REMOVED***with***REMOVED***it.***REMOVED***Returns***REMOVED***`this`.***REMOVED***See***REMOVED***also***REMOVED***`s.prependLeft(...)`.

###***REMOVED***s.appendRight(***REMOVED***index,***REMOVED***content***REMOVED***)

Appends***REMOVED***the***REMOVED***specified***REMOVED***`content`***REMOVED***at***REMOVED***the***REMOVED***`index`***REMOVED***in***REMOVED***the***REMOVED***original***REMOVED***string.***REMOVED***If***REMOVED***a***REMOVED***range***REMOVED***_starting_***REMOVED***with***REMOVED***`index`***REMOVED***is***REMOVED***subsequently***REMOVED***moved,***REMOVED***the***REMOVED***insert***REMOVED***will***REMOVED***be***REMOVED***moved***REMOVED***with***REMOVED***it.***REMOVED***Returns***REMOVED***`this`.***REMOVED***See***REMOVED***also***REMOVED***`s.prependRight(...)`.

###***REMOVED***s.clone()

Does***REMOVED***what***REMOVED***you'd***REMOVED***expect.

###***REMOVED***s.generateDecodedMap(***REMOVED***options***REMOVED***)

Generates***REMOVED***a***REMOVED***sourcemap***REMOVED***object***REMOVED***with***REMOVED***raw***REMOVED***mappings***REMOVED***in***REMOVED***array***REMOVED***form,***REMOVED***rather***REMOVED***than***REMOVED***encoded***REMOVED***as***REMOVED***a***REMOVED***string.***REMOVED***See***REMOVED***`generateMap`***REMOVED***documentation***REMOVED***below***REMOVED***for***REMOVED***options***REMOVED***details.***REMOVED***Useful***REMOVED***if***REMOVED***you***REMOVED***need***REMOVED***to***REMOVED***manipulate***REMOVED***the***REMOVED***sourcemap***REMOVED***further,***REMOVED***but***REMOVED***most***REMOVED***of***REMOVED***the***REMOVED***time***REMOVED***you***REMOVED***will***REMOVED***use***REMOVED***`generateMap`***REMOVED***instead.

###***REMOVED***s.generateMap(***REMOVED***options***REMOVED***)

Generates***REMOVED***a***REMOVED***[version***REMOVED***3***REMOVED***sourcemap](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit).***REMOVED***All***REMOVED***options***REMOVED***are,***REMOVED***well,***REMOVED***optional:

-***REMOVED***`file`***REMOVED***-***REMOVED***the***REMOVED***filename***REMOVED***where***REMOVED***you***REMOVED***plan***REMOVED***to***REMOVED***write***REMOVED***the***REMOVED***sourcemap
-***REMOVED***`source`***REMOVED***-***REMOVED***the***REMOVED***filename***REMOVED***of***REMOVED***the***REMOVED***file***REMOVED***containing***REMOVED***the***REMOVED***original***REMOVED***source
-***REMOVED***`includeContent`***REMOVED***-***REMOVED***whether***REMOVED***to***REMOVED***include***REMOVED***the***REMOVED***original***REMOVED***content***REMOVED***in***REMOVED***the***REMOVED***map's***REMOVED***`sourcesContent`***REMOVED***array
-***REMOVED***`hires`***REMOVED***-***REMOVED***whether***REMOVED***the***REMOVED***mapping***REMOVED***should***REMOVED***be***REMOVED***high-resolution.***REMOVED***Hi-res***REMOVED***mappings***REMOVED***map***REMOVED***every***REMOVED***single***REMOVED***character,***REMOVED***meaning***REMOVED***(for***REMOVED***example)***REMOVED***your***REMOVED***devtools***REMOVED***will***REMOVED***always***REMOVED***be***REMOVED***able***REMOVED***to***REMOVED***pinpoint***REMOVED***the***REMOVED***exact***REMOVED***location***REMOVED***of***REMOVED***function***REMOVED***calls***REMOVED***and***REMOVED***so***REMOVED***on.***REMOVED***With***REMOVED***lo-res***REMOVED***mappings,***REMOVED***devtools***REMOVED***may***REMOVED***only***REMOVED***be***REMOVED***able***REMOVED***to***REMOVED***identify***REMOVED***the***REMOVED***correct***REMOVED***line***REMOVED***-***REMOVED***but***REMOVED***they're***REMOVED***quicker***REMOVED***to***REMOVED***generate***REMOVED***and***REMOVED***less***REMOVED***bulky.***REMOVED***You***REMOVED***can***REMOVED***also***REMOVED***set***REMOVED***`"boundary"`***REMOVED***to***REMOVED***generate***REMOVED***a***REMOVED***semi-hi-res***REMOVED***mappings***REMOVED***segmented***REMOVED***per***REMOVED***word***REMOVED***boundary***REMOVED***instead***REMOVED***of***REMOVED***per***REMOVED***character,***REMOVED***suitable***REMOVED***for***REMOVED***string***REMOVED***semantics***REMOVED***that***REMOVED***are***REMOVED***separated***REMOVED***by***REMOVED***words.***REMOVED***If***REMOVED***sourcemap***REMOVED***locations***REMOVED***have***REMOVED***been***REMOVED***specified***REMOVED***with***REMOVED***`s.addSourcemapLocation()`,***REMOVED***they***REMOVED***will***REMOVED***be***REMOVED***used***REMOVED***here.

The***REMOVED***returned***REMOVED***sourcemap***REMOVED***has***REMOVED***two***REMOVED***(non-enumerable)***REMOVED***methods***REMOVED***attached***REMOVED***for***REMOVED***convenience:

-***REMOVED***`toString`***REMOVED***-***REMOVED***returns***REMOVED***the***REMOVED***equivalent***REMOVED***of***REMOVED***`JSON.stringify(map)`
-***REMOVED***`toUrl`***REMOVED***-***REMOVED***returns***REMOVED***a***REMOVED***DataURI***REMOVED***containing***REMOVED***the***REMOVED***sourcemap.***REMOVED***Useful***REMOVED***for***REMOVED***doing***REMOVED***this***REMOVED***sort***REMOVED***of***REMOVED***thing:

```js
code***REMOVED***+=***REMOVED***'\n//#***REMOVED***sourceMappingURL='***REMOVED***+***REMOVED***map.toUrl();
```

###***REMOVED***s.hasChanged()

Indicates***REMOVED***if***REMOVED***the***REMOVED***string***REMOVED***has***REMOVED***been***REMOVED***changed.

###***REMOVED***s.indent(***REMOVED***prefix[,***REMOVED***options]***REMOVED***)

Prefixes***REMOVED***each***REMOVED***line***REMOVED***of***REMOVED***the***REMOVED***string***REMOVED***with***REMOVED***`prefix`.***REMOVED***If***REMOVED***`prefix`***REMOVED***is***REMOVED***not***REMOVED***supplied,***REMOVED***the***REMOVED***indentation***REMOVED***will***REMOVED***be***REMOVED***guessed***REMOVED***from***REMOVED***the***REMOVED***original***REMOVED***content,***REMOVED***falling***REMOVED***back***REMOVED***to***REMOVED***a***REMOVED***single***REMOVED***tab***REMOVED***character.***REMOVED***Returns***REMOVED***`this`.

The***REMOVED***`options`***REMOVED***argument***REMOVED***can***REMOVED***have***REMOVED***an***REMOVED***`exclude`***REMOVED***property,***REMOVED***which***REMOVED***is***REMOVED***an***REMOVED***array***REMOVED***of***REMOVED***`[start,***REMOVED***end]`***REMOVED***character***REMOVED***ranges.***REMOVED***These***REMOVED***ranges***REMOVED***will***REMOVED***be***REMOVED***excluded***REMOVED***from***REMOVED***the***REMOVED***indentation***REMOVED***-***REMOVED***useful***REMOVED***for***REMOVED***(e.g.)***REMOVED***multiline***REMOVED***strings.

###***REMOVED***s.insertLeft(***REMOVED***index,***REMOVED***content***REMOVED***)

**DEPRECATED*****REMOVED***since***REMOVED***0.17***REMOVED***–***REMOVED***use***REMOVED***`s.appendLeft(...)`***REMOVED***instead

###***REMOVED***s.insertRight(***REMOVED***index,***REMOVED***content***REMOVED***)

**DEPRECATED*****REMOVED***since***REMOVED***0.17***REMOVED***–***REMOVED***use***REMOVED***`s.prependRight(...)`***REMOVED***instead

###***REMOVED***s.isEmpty()

Returns***REMOVED***true***REMOVED***if***REMOVED***the***REMOVED***resulting***REMOVED***source***REMOVED***is***REMOVED***empty***REMOVED***(disregarding***REMOVED***white***REMOVED***space).

###***REMOVED***s.locate(***REMOVED***index***REMOVED***)

**DEPRECATED*****REMOVED***since***REMOVED***0.10***REMOVED***–***REMOVED***see***REMOVED***[#30](https://github.com/Rich-Harris/magic-string/pull/30)

###***REMOVED***s.locateOrigin(***REMOVED***index***REMOVED***)

**DEPRECATED*****REMOVED***since***REMOVED***0.10***REMOVED***–***REMOVED***see***REMOVED***[#30](https://github.com/Rich-Harris/magic-string/pull/30)

###***REMOVED***s.move(***REMOVED***start,***REMOVED***end,***REMOVED***index***REMOVED***)

Moves***REMOVED***the***REMOVED***characters***REMOVED***from***REMOVED***`start`***REMOVED***and***REMOVED***`end`***REMOVED***to***REMOVED***`index`.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.overwrite(***REMOVED***start,***REMOVED***end,***REMOVED***content[,***REMOVED***options]***REMOVED***)

Replaces***REMOVED***the***REMOVED***characters***REMOVED***from***REMOVED***`start`***REMOVED***to***REMOVED***`end`***REMOVED***with***REMOVED***`content`,***REMOVED***along***REMOVED***with***REMOVED***the***REMOVED***appended/prepended***REMOVED***content***REMOVED***in***REMOVED***that***REMOVED***range.***REMOVED***The***REMOVED***same***REMOVED***restrictions***REMOVED***as***REMOVED***`s.remove()`***REMOVED***apply.***REMOVED***Returns***REMOVED***`this`.

The***REMOVED***fourth***REMOVED***argument***REMOVED***is***REMOVED***optional.***REMOVED***It***REMOVED***can***REMOVED***have***REMOVED***a***REMOVED***`storeName`***REMOVED***property***REMOVED***—***REMOVED***if***REMOVED***`true`,***REMOVED***the***REMOVED***original***REMOVED***name***REMOVED***will***REMOVED***be***REMOVED***stored***REMOVED***for***REMOVED***later***REMOVED***inclusion***REMOVED***in***REMOVED***a***REMOVED***sourcemap's***REMOVED***`names`***REMOVED***array***REMOVED***—***REMOVED***and***REMOVED***a***REMOVED***`contentOnly`***REMOVED***property***REMOVED***which***REMOVED***determines***REMOVED***whether***REMOVED***only***REMOVED***the***REMOVED***content***REMOVED***is***REMOVED***overwritten,***REMOVED***or***REMOVED***anything***REMOVED***that***REMOVED***was***REMOVED***appended/prepended***REMOVED***to***REMOVED***the***REMOVED***range***REMOVED***as***REMOVED***well.

It***REMOVED***may***REMOVED***be***REMOVED***preferred***REMOVED***to***REMOVED***use***REMOVED***`s.update(...)`***REMOVED***instead***REMOVED***if***REMOVED***you***REMOVED***wish***REMOVED***to***REMOVED***avoid***REMOVED***overwriting***REMOVED***the***REMOVED***appended/prepended***REMOVED***content.

###***REMOVED***s.prepend(***REMOVED***content***REMOVED***)

Prepends***REMOVED***the***REMOVED***string***REMOVED***with***REMOVED***the***REMOVED***specified***REMOVED***content.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.prependLeft***REMOVED***(***REMOVED***index,***REMOVED***content***REMOVED***)

Same***REMOVED***as***REMOVED***`s.appendLeft(...)`,***REMOVED***except***REMOVED***that***REMOVED***the***REMOVED***inserted***REMOVED***content***REMOVED***will***REMOVED***go***REMOVED***_before_***REMOVED***any***REMOVED***previous***REMOVED***appends***REMOVED***or***REMOVED***prepends***REMOVED***at***REMOVED***`index`

###***REMOVED***s.prependRight***REMOVED***(***REMOVED***index,***REMOVED***content***REMOVED***)

Same***REMOVED***as***REMOVED***`s.appendRight(...)`,***REMOVED***except***REMOVED***that***REMOVED***the***REMOVED***inserted***REMOVED***content***REMOVED***will***REMOVED***go***REMOVED***_before_***REMOVED***any***REMOVED***previous***REMOVED***appends***REMOVED***or***REMOVED***prepends***REMOVED***at***REMOVED***`index`

###***REMOVED***s.replace(***REMOVED***regexpOrString,***REMOVED***substitution***REMOVED***)

String***REMOVED***replacement***REMOVED***with***REMOVED***RegExp***REMOVED***or***REMOVED***string.***REMOVED***When***REMOVED***using***REMOVED***a***REMOVED***RegExp,***REMOVED***replacer***REMOVED***function***REMOVED***is***REMOVED***also***REMOVED***supported.***REMOVED***Returns***REMOVED***`this`.

```ts
import***REMOVED***MagicString***REMOVED***from***REMOVED***'magic-string';

const***REMOVED***s***REMOVED***=***REMOVED***new***REMOVED***MagicString(source);

s.replace('foo',***REMOVED***'bar');
s.replace(/foo/g,***REMOVED***'bar');
s.replace(/(\w)(\d+)/g,***REMOVED***(_,***REMOVED***$1,***REMOVED***$2)***REMOVED***=>***REMOVED***$1.toUpperCase()***REMOVED***+***REMOVED***$2);
```

The***REMOVED***differences***REMOVED***from***REMOVED***[`String.replace`](<(https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace)>):

-***REMOVED***It***REMOVED***will***REMOVED***always***REMOVED***match***REMOVED***against***REMOVED***the***REMOVED*****original***REMOVED***string**
-***REMOVED***It***REMOVED***mutates***REMOVED***the***REMOVED***magic***REMOVED***string***REMOVED***state***REMOVED***(use***REMOVED***`.clone()`***REMOVED***to***REMOVED***be***REMOVED***immutable)

###***REMOVED***s.replaceAll(***REMOVED***regexpOrString,***REMOVED***substitution***REMOVED***)

Same***REMOVED***as***REMOVED***`s.replace`,***REMOVED***but***REMOVED***replace***REMOVED***all***REMOVED***matched***REMOVED***strings***REMOVED***instead***REMOVED***of***REMOVED***just***REMOVED***one.
If***REMOVED***`regexpOrString`***REMOVED***is***REMOVED***a***REMOVED***regex,***REMOVED***then***REMOVED***it***REMOVED***must***REMOVED***have***REMOVED***the***REMOVED***global***REMOVED***(`g`)***REMOVED***flag***REMOVED***set,***REMOVED***or***REMOVED***a***REMOVED***`TypeError`***REMOVED***is***REMOVED***thrown.***REMOVED***Matches***REMOVED***the***REMOVED***behavior***REMOVED***of***REMOVED***the***REMOVED***builtin***REMOVED***[`String.property.replaceAll`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replaceAll).***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.remove(***REMOVED***start,***REMOVED***end***REMOVED***)

Removes***REMOVED***the***REMOVED***characters***REMOVED***from***REMOVED***`start`***REMOVED***to***REMOVED***`end`***REMOVED***(of***REMOVED***the***REMOVED***original***REMOVED***string,***REMOVED*****not*****REMOVED***the***REMOVED***generated***REMOVED***string).***REMOVED***Removing***REMOVED***the***REMOVED***same***REMOVED***content***REMOVED***twice,***REMOVED***or***REMOVED***making***REMOVED***removals***REMOVED***that***REMOVED***partially***REMOVED***overlap,***REMOVED***will***REMOVED***cause***REMOVED***an***REMOVED***error.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.reset(***REMOVED***start,***REMOVED***end***REMOVED***)

Resets***REMOVED***the***REMOVED***characters***REMOVED***from***REMOVED***`start`***REMOVED***to***REMOVED***`end`***REMOVED***(of***REMOVED***the***REMOVED***original***REMOVED***string,***REMOVED*****not*****REMOVED***the***REMOVED***generated***REMOVED***string).
It***REMOVED***can***REMOVED***be***REMOVED***used***REMOVED***to***REMOVED***restore***REMOVED***previously***REMOVED***removed***REMOVED***characters***REMOVED***and***REMOVED***discard***REMOVED***unwanted***REMOVED***changes.

###***REMOVED***s.slice(***REMOVED***start,***REMOVED***end***REMOVED***)

Returns***REMOVED***the***REMOVED***content***REMOVED***of***REMOVED***the***REMOVED***generated***REMOVED***string***REMOVED***that***REMOVED***corresponds***REMOVED***to***REMOVED***the***REMOVED***slice***REMOVED***between***REMOVED***`start`***REMOVED***and***REMOVED***`end`***REMOVED***of***REMOVED***the***REMOVED***original***REMOVED***string.***REMOVED***Throws***REMOVED***error***REMOVED***if***REMOVED***the***REMOVED***indices***REMOVED***are***REMOVED***for***REMOVED***characters***REMOVED***that***REMOVED***were***REMOVED***already***REMOVED***removed.

###***REMOVED***s.snip(***REMOVED***start,***REMOVED***end***REMOVED***)

Returns***REMOVED***a***REMOVED***clone***REMOVED***of***REMOVED***`s`,***REMOVED***with***REMOVED***all***REMOVED***content***REMOVED***before***REMOVED***the***REMOVED***`start`***REMOVED***and***REMOVED***`end`***REMOVED***characters***REMOVED***of***REMOVED***the***REMOVED***original***REMOVED***string***REMOVED***removed.

###***REMOVED***s.toString()

Returns***REMOVED***the***REMOVED***generated***REMOVED***string.

###***REMOVED***s.trim([***REMOVED***charType***REMOVED***])

Trims***REMOVED***content***REMOVED***matching***REMOVED***`charType`***REMOVED***(defaults***REMOVED***to***REMOVED***`\s`,***REMOVED***i.e.***REMOVED***whitespace)***REMOVED***from***REMOVED***the***REMOVED***start***REMOVED***and***REMOVED***end.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.trimStart([***REMOVED***charType***REMOVED***])

Trims***REMOVED***content***REMOVED***matching***REMOVED***`charType`***REMOVED***(defaults***REMOVED***to***REMOVED***`\s`,***REMOVED***i.e.***REMOVED***whitespace)***REMOVED***from***REMOVED***the***REMOVED***start.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.trimEnd([***REMOVED***charType***REMOVED***])

Trims***REMOVED***content***REMOVED***matching***REMOVED***`charType`***REMOVED***(defaults***REMOVED***to***REMOVED***`\s`,***REMOVED***i.e.***REMOVED***whitespace)***REMOVED***from***REMOVED***the***REMOVED***end.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.trimLines()

Removes***REMOVED***empty***REMOVED***lines***REMOVED***from***REMOVED***the***REMOVED***start***REMOVED***and***REMOVED***end.***REMOVED***Returns***REMOVED***`this`.

###***REMOVED***s.update(***REMOVED***start,***REMOVED***end,***REMOVED***content[,***REMOVED***options]***REMOVED***)

Replaces***REMOVED***the***REMOVED***characters***REMOVED***from***REMOVED***`start`***REMOVED***to***REMOVED***`end`***REMOVED***with***REMOVED***`content`.***REMOVED***The***REMOVED***same***REMOVED***restrictions***REMOVED***as***REMOVED***`s.remove()`***REMOVED***apply.***REMOVED***Returns***REMOVED***`this`.

The***REMOVED***fourth***REMOVED***argument***REMOVED***is***REMOVED***optional.***REMOVED***It***REMOVED***can***REMOVED***have***REMOVED***a***REMOVED***`storeName`***REMOVED***property***REMOVED***—***REMOVED***if***REMOVED***`true`,***REMOVED***the***REMOVED***original***REMOVED***name***REMOVED***will***REMOVED***be***REMOVED***stored***REMOVED***for***REMOVED***later***REMOVED***inclusion***REMOVED***in***REMOVED***a***REMOVED***sourcemap's***REMOVED***`names`***REMOVED***array***REMOVED***—***REMOVED***and***REMOVED***an***REMOVED***`overwrite`***REMOVED***property***REMOVED***which***REMOVED***defaults***REMOVED***to***REMOVED***`false`***REMOVED***and***REMOVED***determines***REMOVED***whether***REMOVED***anything***REMOVED***that***REMOVED***was***REMOVED***appended/prepended***REMOVED***to***REMOVED***the***REMOVED***range***REMOVED***will***REMOVED***be***REMOVED***overwritten***REMOVED***along***REMOVED***with***REMOVED***the***REMOVED***original***REMOVED***content.

`s.update(start,***REMOVED***end,***REMOVED***content)`***REMOVED***is***REMOVED***equivalent***REMOVED***to***REMOVED***`s.overwrite(start,***REMOVED***end,***REMOVED***content,***REMOVED***{***REMOVED***contentOnly:***REMOVED***true***REMOVED***})`.

##***REMOVED***Bundling

To***REMOVED***concatenate***REMOVED***several***REMOVED***sources,***REMOVED***use***REMOVED***`MagicString.Bundle`:

```js
const***REMOVED***bundle***REMOVED***=***REMOVED***new***REMOVED***MagicString.Bundle();

bundle.addSource({
	filename:***REMOVED***'foo.js',
	content:***REMOVED***new***REMOVED***MagicString('var***REMOVED***answer***REMOVED***=***REMOVED***42;'),
});

bundle.addSource({
	filename:***REMOVED***'bar.js',
	content:***REMOVED***new***REMOVED***MagicString('console.log(***REMOVED***answer***REMOVED***)'),
});

//***REMOVED***Sources***REMOVED***can***REMOVED***be***REMOVED***marked***REMOVED***as***REMOVED***ignore-listed,***REMOVED***which***REMOVED***provides***REMOVED***a***REMOVED***hint***REMOVED***to***REMOVED***debuggers
//***REMOVED***to***REMOVED***not***REMOVED***step***REMOVED***into***REMOVED***this***REMOVED***code***REMOVED***and***REMOVED***also***REMOVED***don't***REMOVED***show***REMOVED***the***REMOVED***source***REMOVED***files***REMOVED***depending
//***REMOVED***on***REMOVED***user***REMOVED***preferences.
bundle.addSource({
	filename:***REMOVED***'some-3rdparty-library.js',
	content:***REMOVED***new***REMOVED***MagicString('function***REMOVED***myLib(){}'),
	ignoreList:***REMOVED***false,***REMOVED***//***REMOVED***<--
});

//***REMOVED***Advanced:***REMOVED***a***REMOVED***source***REMOVED***can***REMOVED***include***REMOVED***an***REMOVED***`indentExclusionRanges`***REMOVED***property
//***REMOVED***alongside***REMOVED***`filename`***REMOVED***and***REMOVED***`content`.***REMOVED***This***REMOVED***will***REMOVED***be***REMOVED***passed***REMOVED***to***REMOVED***`s.indent()`
//***REMOVED***-***REMOVED***see***REMOVED***documentation***REMOVED***above

bundle
	.indent()***REMOVED***//***REMOVED***optionally,***REMOVED***pass***REMOVED***an***REMOVED***indent***REMOVED***string,***REMOVED***otherwise***REMOVED***it***REMOVED***will***REMOVED***be***REMOVED***guessed
	.prepend('(function***REMOVED***()***REMOVED***{\n')
	.append('}());');

bundle.toString();
//***REMOVED***(function***REMOVED***()***REMOVED***{
//***REMOVED******REMOVED******REMOVED***var***REMOVED***answer***REMOVED***=***REMOVED***42;
//***REMOVED******REMOVED******REMOVED***console.log(***REMOVED***answer***REMOVED***);
//***REMOVED***}());

//***REMOVED***options***REMOVED***are***REMOVED***as***REMOVED***per***REMOVED***`s.generateMap()`***REMOVED***above
const***REMOVED***map***REMOVED***=***REMOVED***bundle.generateMap({
	file:***REMOVED***'bundle.js',
	includeContent:***REMOVED***true,
	hires:***REMOVED***true,
});
```

As***REMOVED***an***REMOVED***alternative***REMOVED***syntax,***REMOVED***if***REMOVED***you***REMOVED***a)***REMOVED***don't***REMOVED***have***REMOVED***`filename`***REMOVED***or***REMOVED***`indentExclusionRanges`***REMOVED***options,***REMOVED***or***REMOVED***b)***REMOVED***passed***REMOVED***those***REMOVED***in***REMOVED***when***REMOVED***you***REMOVED***used***REMOVED***`new***REMOVED***MagicString(...)`,***REMOVED***you***REMOVED***can***REMOVED***simply***REMOVED***pass***REMOVED***the***REMOVED***`MagicString`***REMOVED***instance***REMOVED***itself:

```js
const***REMOVED***bundle***REMOVED***=***REMOVED***new***REMOVED***MagicString.Bundle();
const***REMOVED***source***REMOVED***=***REMOVED***new***REMOVED***MagicString(someCode,***REMOVED***{
	filename:***REMOVED***'foo.js',
});

bundle.addSource(source);
```

##***REMOVED***License

MIT
