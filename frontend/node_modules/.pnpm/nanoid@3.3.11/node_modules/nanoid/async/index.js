import***REMOVED***crypto***REMOVED***from***REMOVED***'crypto'
import***REMOVED***{***REMOVED***urlAlphabet***REMOVED***}***REMOVED***from***REMOVED***'../url-alphabet/index.js'
let***REMOVED***random***REMOVED***=***REMOVED***bytes***REMOVED***=>
***REMOVED******REMOVED***new***REMOVED***Promise((resolve,***REMOVED***reject)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***crypto.randomFill(Buffer.allocUnsafe(bytes),***REMOVED***(err,***REMOVED***buf)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(err)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***reject(err)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***resolve(buf)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***})
let***REMOVED***customAlphabet***REMOVED***=***REMOVED***(alphabet,***REMOVED***defaultSize***REMOVED***=***REMOVED***21)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***let***REMOVED***mask***REMOVED***=***REMOVED***(2***REMOVED***<<***REMOVED***(31***REMOVED***-***REMOVED***Math.clz32((alphabet.length***REMOVED***-***REMOVED***1)***REMOVED***|***REMOVED***1)))***REMOVED***-***REMOVED***1
***REMOVED******REMOVED***let***REMOVED***step***REMOVED***=***REMOVED***Math.ceil((1.6***REMOVED*******REMOVED***mask***REMOVED*******REMOVED***defaultSize)***REMOVED***/***REMOVED***alphabet.length)
***REMOVED******REMOVED***let***REMOVED***tick***REMOVED***=***REMOVED***(id,***REMOVED***size***REMOVED***=***REMOVED***defaultSize)***REMOVED***=>
***REMOVED******REMOVED******REMOVED******REMOVED***random(step).then(bytes***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***i***REMOVED***=***REMOVED***step
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***while***REMOVED***(i--)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***id***REMOVED***+=***REMOVED***alphabet[bytes[i]***REMOVED***&***REMOVED***mask]***REMOVED***||***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(id.length***REMOVED***>=***REMOVED***size)***REMOVED***return***REMOVED***id
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***tick(id,***REMOVED***size)
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***return***REMOVED***size***REMOVED***=>***REMOVED***tick('',***REMOVED***size)
}
let***REMOVED***nanoid***REMOVED***=***REMOVED***(size***REMOVED***=***REMOVED***21)***REMOVED***=>
***REMOVED******REMOVED***random((size***REMOVED***|=***REMOVED***0)).then(bytes***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***id***REMOVED***=***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED***while***REMOVED***(size--)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***id***REMOVED***+=***REMOVED***urlAlphabet[bytes[size]***REMOVED***&***REMOVED***63]
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***id
***REMOVED******REMOVED***})
export***REMOVED***{***REMOVED***nanoid,***REMOVED***customAlphabet,***REMOVED***random***REMOVED***}
