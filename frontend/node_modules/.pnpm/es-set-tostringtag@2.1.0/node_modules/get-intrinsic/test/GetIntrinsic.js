'use***REMOVED***strict';

var***REMOVED***GetIntrinsic***REMOVED***=***REMOVED***require('../');

var***REMOVED***test***REMOVED***=***REMOVED***require('tape');
var***REMOVED***forEach***REMOVED***=***REMOVED***require('for-each');
var***REMOVED***debug***REMOVED***=***REMOVED***require('object-inspect');
var***REMOVED***generatorFns***REMOVED***=***REMOVED***require('make-generator-function')();
var***REMOVED***asyncFns***REMOVED***=***REMOVED***require('make-async-function').list();
var***REMOVED***asyncGenFns***REMOVED***=***REMOVED***require('make-async-generator-function')();
var***REMOVED***mockProperty***REMOVED***=***REMOVED***require('mock-property');

var***REMOVED***callBound***REMOVED***=***REMOVED***require('call-bound');
var***REMOVED***v***REMOVED***=***REMOVED***require('es-value-fixtures');
var***REMOVED***$gOPD***REMOVED***=***REMOVED***require('gopd');
var***REMOVED***DefinePropertyOrThrow***REMOVED***=***REMOVED***require('es-abstract/2023/DefinePropertyOrThrow');

var***REMOVED***$isProto***REMOVED***=***REMOVED***callBound('%Object.prototype.isPrototypeOf%');

test('export',***REMOVED***function***REMOVED***(t)***REMOVED***{
	t.equal(typeof***REMOVED***GetIntrinsic,***REMOVED***'function',***REMOVED***'it***REMOVED***is***REMOVED***a***REMOVED***function');
	t.equal(GetIntrinsic.length,***REMOVED***2,***REMOVED***'function***REMOVED***has***REMOVED***length***REMOVED***of***REMOVED***2');

	t.end();
});

test('throws',***REMOVED***function***REMOVED***(t)***REMOVED***{
	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('not***REMOVED***an***REMOVED***intrinsic');***REMOVED***},
		SyntaxError,
		'nonexistent***REMOVED***intrinsic***REMOVED***throws***REMOVED***a***REMOVED***syntax***REMOVED***error'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('');***REMOVED***},
		TypeError,
		'empty***REMOVED***string***REMOVED***intrinsic***REMOVED***throws***REMOVED***a***REMOVED***type***REMOVED***error'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('.');***REMOVED***},
		SyntaxError,
		'"just***REMOVED***a***REMOVED***dot"***REMOVED***intrinsic***REMOVED***throws***REMOVED***a***REMOVED***syntax***REMOVED***error'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%String');***REMOVED***},
		SyntaxError,
		'Leading***REMOVED***%***REMOVED***without***REMOVED***trailing***REMOVED***%***REMOVED***throws***REMOVED***a***REMOVED***syntax***REMOVED***error'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('String%');***REMOVED***},
		SyntaxError,
		'Trailing***REMOVED***%***REMOVED***without***REMOVED***leading***REMOVED***%***REMOVED***throws***REMOVED***a***REMOVED***syntax***REMOVED***error'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic("String['prototype]");***REMOVED***},
		SyntaxError,
		'Dynamic***REMOVED***property***REMOVED***access***REMOVED***is***REMOVED***disallowed***REMOVED***for***REMOVED***intrinsics***REMOVED***(unterminated***REMOVED***string)'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%Proxy.prototype.undefined%');***REMOVED***},
		TypeError,
		"Throws***REMOVED***when***REMOVED***middle***REMOVED***part***REMOVED***doesn't***REMOVED***exist***REMOVED***(%Proxy.prototype.undefined%)"
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%Array.prototype%garbage%');***REMOVED***},
		SyntaxError,
		'Throws***REMOVED***with***REMOVED***extra***REMOVED***percent***REMOVED***signs'
	);

	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%Array.prototype%push%');***REMOVED***},
		SyntaxError,
		'Throws***REMOVED***with***REMOVED***extra***REMOVED***percent***REMOVED***signs,***REMOVED***even***REMOVED***on***REMOVED***an***REMOVED***existing***REMOVED***intrinsic'
	);

	forEach(v.nonStrings,***REMOVED***function***REMOVED***(nonString)***REMOVED***{
		t['throws'](
			function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic(nonString);***REMOVED***},
			TypeError,
			debug(nonString)***REMOVED***+***REMOVED***'***REMOVED***is***REMOVED***not***REMOVED***a***REMOVED***String'
		);
	});

	forEach(v.nonBooleans,***REMOVED***function***REMOVED***(nonBoolean)***REMOVED***{
		t['throws'](
			function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%',***REMOVED***nonBoolean);***REMOVED***},
			TypeError,
			debug(nonBoolean)***REMOVED***+***REMOVED***'***REMOVED***is***REMOVED***not***REMOVED***a***REMOVED***Boolean'
		);
	});

	forEach([
		'toString',
		'propertyIsEnumerable',
		'hasOwnProperty'
	],***REMOVED***function***REMOVED***(objectProtoMember)***REMOVED***{
		t['throws'](
			function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic(objectProtoMember);***REMOVED***},
			SyntaxError,
			debug(objectProtoMember)***REMOVED***+***REMOVED***'***REMOVED***is***REMOVED***not***REMOVED***an***REMOVED***intrinsic'
		);
	});

	t.end();
});

test('base***REMOVED***intrinsics',***REMOVED***function***REMOVED***(t)***REMOVED***{
	t.equal(GetIntrinsic('%Object%'),***REMOVED***Object,***REMOVED***'%Object%***REMOVED***yields***REMOVED***Object');
	t.equal(GetIntrinsic('Object'),***REMOVED***Object,***REMOVED***'Object***REMOVED***yields***REMOVED***Object');
	t.equal(GetIntrinsic('%Array%'),***REMOVED***Array,***REMOVED***'%Array%***REMOVED***yields***REMOVED***Array');
	t.equal(GetIntrinsic('Array'),***REMOVED***Array,***REMOVED***'Array***REMOVED***yields***REMOVED***Array');

	t.end();
});

test('dotted***REMOVED***paths',***REMOVED***function***REMOVED***(t)***REMOVED***{
	t.equal(GetIntrinsic('%Object.prototype.toString%'),***REMOVED***Object.prototype.toString,***REMOVED***'%Object.prototype.toString%***REMOVED***yields***REMOVED***Object.prototype.toString');
	t.equal(GetIntrinsic('Object.prototype.toString'),***REMOVED***Object.prototype.toString,***REMOVED***'Object.prototype.toString***REMOVED***yields***REMOVED***Object.prototype.toString');
	t.equal(GetIntrinsic('%Array.prototype.push%'),***REMOVED***Array.prototype.push,***REMOVED***'%Array.prototype.push%***REMOVED***yields***REMOVED***Array.prototype.push');
	t.equal(GetIntrinsic('Array.prototype.push'),***REMOVED***Array.prototype.push,***REMOVED***'Array.prototype.push***REMOVED***yields***REMOVED***Array.prototype.push');

	test('underscore***REMOVED***paths***REMOVED***are***REMOVED***aliases***REMOVED***for***REMOVED***dotted***REMOVED***paths',***REMOVED***{***REMOVED***skip:***REMOVED***!Object.isFrozen***REMOVED***||***REMOVED***Object.isFrozen(Object.prototype)***REMOVED***},***REMOVED***function***REMOVED***(st)***REMOVED***{
		var***REMOVED***original***REMOVED***=***REMOVED***GetIntrinsic('%ObjProto_toString%');

		forEach([
			'%Object.prototype.toString%',
			'Object.prototype.toString',
			'%ObjectPrototype.toString%',
			'ObjectPrototype.toString',
			'%ObjProto_toString%',
			'ObjProto_toString'
		],***REMOVED***function***REMOVED***(name)***REMOVED***{
			DefinePropertyOrThrow(Object.prototype,***REMOVED***'toString',***REMOVED***{
				'[[Value]]':***REMOVED***function***REMOVED***toString()***REMOVED***{
					return***REMOVED***original.apply(this,***REMOVED***arguments);
				}
			});
			st.equal(GetIntrinsic(name),***REMOVED***original,***REMOVED***name***REMOVED***+***REMOVED***'***REMOVED***yields***REMOVED***original***REMOVED***Object.prototype.toString');
		});

		DefinePropertyOrThrow(Object.prototype,***REMOVED***'toString',***REMOVED***{***REMOVED***'[[Value]]':***REMOVED***original***REMOVED***});
		st.end();
	});

	test('dotted***REMOVED***paths***REMOVED***cache',***REMOVED***{***REMOVED***skip:***REMOVED***!Object.isFrozen***REMOVED***||***REMOVED***Object.isFrozen(Object.prototype)***REMOVED***},***REMOVED***function***REMOVED***(st)***REMOVED***{
		var***REMOVED***original***REMOVED***=***REMOVED***GetIntrinsic('%Object.prototype.propertyIsEnumerable%');

		forEach([
			'%Object.prototype.propertyIsEnumerable%',
			'Object.prototype.propertyIsEnumerable',
			'%ObjectPrototype.propertyIsEnumerable%',
			'ObjectPrototype.propertyIsEnumerable'
		],***REMOVED***function***REMOVED***(name)***REMOVED***{
			var***REMOVED***restore***REMOVED***=***REMOVED***mockProperty(Object.prototype,***REMOVED***'propertyIsEnumerable',***REMOVED***{
				value:***REMOVED***function***REMOVED***propertyIsEnumerable()***REMOVED***{
					return***REMOVED***original.apply(this,***REMOVED***arguments);
				}
			});
			st.equal(GetIntrinsic(name),***REMOVED***original,***REMOVED***name***REMOVED***+***REMOVED***'***REMOVED***yields***REMOVED***cached***REMOVED***Object.prototype.propertyIsEnumerable');

			restore();
		});

		st.end();
	});

	test('dotted***REMOVED***path***REMOVED***reports***REMOVED***correct***REMOVED***error',***REMOVED***function***REMOVED***(st)***REMOVED***{
		st['throws'](function***REMOVED***()***REMOVED***{
			GetIntrinsic('%NonExistentIntrinsic.prototype.property%');
		},***REMOVED***/%NonExistentIntrinsic%/,***REMOVED***'The***REMOVED***base***REMOVED***intrinsic***REMOVED***of***REMOVED***%NonExistentIntrinsic.prototype.property%***REMOVED***is***REMOVED***%NonExistentIntrinsic%');

		st['throws'](function***REMOVED***()***REMOVED***{
			GetIntrinsic('%NonExistentIntrinsicPrototype.property%');
		},***REMOVED***/%NonExistentIntrinsicPrototype%/,***REMOVED***'The***REMOVED***base***REMOVED***intrinsic***REMOVED***of***REMOVED***%NonExistentIntrinsicPrototype.property%***REMOVED***is***REMOVED***%NonExistentIntrinsicPrototype%');

		st.end();
	});

	t.end();
});

test('accessors',***REMOVED***{***REMOVED***skip:***REMOVED***!$gOPD***REMOVED***||***REMOVED***typeof***REMOVED***Map***REMOVED***!==***REMOVED***'function'***REMOVED***},***REMOVED***function***REMOVED***(t)***REMOVED***{
	var***REMOVED***actual***REMOVED***=***REMOVED***$gOPD(Map.prototype,***REMOVED***'size');
	t.ok(actual,***REMOVED***'Map.prototype.size***REMOVED***has***REMOVED***a***REMOVED***descriptor');
	t.equal(typeof***REMOVED***actual.get,***REMOVED***'function',***REMOVED***'Map.prototype.size***REMOVED***has***REMOVED***a***REMOVED***getter***REMOVED***function');
	t.equal(GetIntrinsic('%Map.prototype.size%'),***REMOVED***actual.get,***REMOVED***'%Map.prototype.size%***REMOVED***yields***REMOVED***the***REMOVED***getter***REMOVED***for***REMOVED***it');
	t.equal(GetIntrinsic('Map.prototype.size'),***REMOVED***actual.get,***REMOVED***'Map.prototype.size***REMOVED***yields***REMOVED***the***REMOVED***getter***REMOVED***for***REMOVED***it');

	t.end();
});

test('generator***REMOVED***functions',***REMOVED***{***REMOVED***skip:***REMOVED***!generatorFns.length***REMOVED***},***REMOVED***function***REMOVED***(t)***REMOVED***{
	var***REMOVED***$GeneratorFunction***REMOVED***=***REMOVED***GetIntrinsic('%GeneratorFunction%');
	var***REMOVED***$GeneratorFunctionPrototype***REMOVED***=***REMOVED***GetIntrinsic('%Generator%');
	var***REMOVED***$GeneratorPrototype***REMOVED***=***REMOVED***GetIntrinsic('%GeneratorPrototype%');

	forEach(generatorFns,***REMOVED***function***REMOVED***(genFn)***REMOVED***{
		var***REMOVED***fnName***REMOVED***=***REMOVED***genFn.name;
		fnName***REMOVED***=***REMOVED***fnName***REMOVED***?***REMOVED***"'"***REMOVED***+***REMOVED***fnName***REMOVED***+***REMOVED***"'"***REMOVED***:***REMOVED***'genFn';

		t.ok(genFn***REMOVED***instanceof***REMOVED***$GeneratorFunction,***REMOVED***fnName***REMOVED***+***REMOVED***'***REMOVED***instanceof***REMOVED***%GeneratorFunction%');
		t.ok($isProto($GeneratorFunctionPrototype,***REMOVED***genFn),***REMOVED***'%Generator%***REMOVED***is***REMOVED***prototype***REMOVED***of***REMOVED***'***REMOVED***+***REMOVED***fnName);
		t.ok($isProto($GeneratorPrototype,***REMOVED***genFn.prototype),***REMOVED***'%GeneratorPrototype%***REMOVED***is***REMOVED***prototype***REMOVED***of***REMOVED***'***REMOVED***+***REMOVED***fnName***REMOVED***+***REMOVED***'.prototype');
	});

	t.end();
});

test('async***REMOVED***functions',***REMOVED***{***REMOVED***skip:***REMOVED***!asyncFns.length***REMOVED***},***REMOVED***function***REMOVED***(t)***REMOVED***{
	var***REMOVED***$AsyncFunction***REMOVED***=***REMOVED***GetIntrinsic('%AsyncFunction%');
	var***REMOVED***$AsyncFunctionPrototype***REMOVED***=***REMOVED***GetIntrinsic('%AsyncFunctionPrototype%');

	forEach(asyncFns,***REMOVED***function***REMOVED***(asyncFn)***REMOVED***{
		var***REMOVED***fnName***REMOVED***=***REMOVED***asyncFn.name;
		fnName***REMOVED***=***REMOVED***fnName***REMOVED***?***REMOVED***"'"***REMOVED***+***REMOVED***fnName***REMOVED***+***REMOVED***"'"***REMOVED***:***REMOVED***'asyncFn';

		t.ok(asyncFn***REMOVED***instanceof***REMOVED***$AsyncFunction,***REMOVED***fnName***REMOVED***+***REMOVED***'***REMOVED***instanceof***REMOVED***%AsyncFunction%');
		t.ok($isProto($AsyncFunctionPrototype,***REMOVED***asyncFn),***REMOVED***'%AsyncFunctionPrototype%***REMOVED***is***REMOVED***prototype***REMOVED***of***REMOVED***'***REMOVED***+***REMOVED***fnName);
	});

	t.end();
});

test('async***REMOVED***generator***REMOVED***functions',***REMOVED***{***REMOVED***skip:***REMOVED***asyncGenFns.length***REMOVED***===***REMOVED***0***REMOVED***},***REMOVED***function***REMOVED***(t)***REMOVED***{
	var***REMOVED***$AsyncGeneratorFunction***REMOVED***=***REMOVED***GetIntrinsic('%AsyncGeneratorFunction%');
	var***REMOVED***$AsyncGeneratorFunctionPrototype***REMOVED***=***REMOVED***GetIntrinsic('%AsyncGenerator%');
	var***REMOVED***$AsyncGeneratorPrototype***REMOVED***=***REMOVED***GetIntrinsic('%AsyncGeneratorPrototype%');

	forEach(asyncGenFns,***REMOVED***function***REMOVED***(asyncGenFn)***REMOVED***{
		var***REMOVED***fnName***REMOVED***=***REMOVED***asyncGenFn.name;
		fnName***REMOVED***=***REMOVED***fnName***REMOVED***?***REMOVED***"'"***REMOVED***+***REMOVED***fnName***REMOVED***+***REMOVED***"'"***REMOVED***:***REMOVED***'asyncGenFn';

		t.ok(asyncGenFn***REMOVED***instanceof***REMOVED***$AsyncGeneratorFunction,***REMOVED***fnName***REMOVED***+***REMOVED***'***REMOVED***instanceof***REMOVED***%AsyncGeneratorFunction%');
		t.ok($isProto($AsyncGeneratorFunctionPrototype,***REMOVED***asyncGenFn),***REMOVED***'%AsyncGenerator%***REMOVED***is***REMOVED***prototype***REMOVED***of***REMOVED***'***REMOVED***+***REMOVED***fnName);
		t.ok($isProto($AsyncGeneratorPrototype,***REMOVED***asyncGenFn.prototype),***REMOVED***'%AsyncGeneratorPrototype%***REMOVED***is***REMOVED***prototype***REMOVED***of***REMOVED***'***REMOVED***+***REMOVED***fnName***REMOVED***+***REMOVED***'.prototype');
	});

	t.end();
});

test('%ThrowTypeError%',***REMOVED***function***REMOVED***(t)***REMOVED***{
	var***REMOVED***$ThrowTypeError***REMOVED***=***REMOVED***GetIntrinsic('%ThrowTypeError%');

	t.equal(typeof***REMOVED***$ThrowTypeError,***REMOVED***'function',***REMOVED***'is***REMOVED***a***REMOVED***function');
	t['throws'](
		$ThrowTypeError,
		TypeError,
		'%ThrowTypeError%***REMOVED***throws***REMOVED***a***REMOVED***TypeError'
	);

	t.end();
});

test('allowMissing',***REMOVED***{***REMOVED***skip:***REMOVED***asyncGenFns.length***REMOVED***>***REMOVED***0***REMOVED***},***REMOVED***function***REMOVED***(t)***REMOVED***{
	t['throws'](
		function***REMOVED***()***REMOVED***{***REMOVED***GetIntrinsic('%AsyncGeneratorPrototype%');***REMOVED***},
		TypeError,
		'throws***REMOVED***when***REMOVED***missing'
	);

	t.equal(
		GetIntrinsic('%AsyncGeneratorPrototype%',***REMOVED***true),
		undefined,
		'does***REMOVED***not***REMOVED***throw***REMOVED***when***REMOVED***allowMissing'
	);

	t.end();
});
