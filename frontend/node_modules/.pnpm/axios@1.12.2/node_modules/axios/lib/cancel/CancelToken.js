'use***REMOVED***strict';

import***REMOVED***CanceledError***REMOVED***from***REMOVED***'./CanceledError.js';

/**
***REMOVED*******REMOVED***A***REMOVED***`CancelToken`***REMOVED***is***REMOVED***an***REMOVED***object***REMOVED***that***REMOVED***can***REMOVED***be***REMOVED***used***REMOVED***to***REMOVED***request***REMOVED***cancellation***REMOVED***of***REMOVED***an***REMOVED***operation.
***REMOVED****
***REMOVED*******REMOVED***@param***REMOVED***{Function}***REMOVED***executor***REMOVED***The***REMOVED***executor***REMOVED***function.
***REMOVED****
***REMOVED*******REMOVED***@returns***REMOVED***{CancelToken}
***REMOVED****/
class***REMOVED***CancelToken***REMOVED***{
***REMOVED******REMOVED***constructor(executor)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(typeof***REMOVED***executor***REMOVED***!==***REMOVED***'function')***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***TypeError('executor***REMOVED***must***REMOVED***be***REMOVED***a***REMOVED***function.');
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***resolvePromise;

***REMOVED******REMOVED******REMOVED******REMOVED***this.promise***REMOVED***=***REMOVED***new***REMOVED***Promise(function***REMOVED***promiseExecutor(resolve)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***resolvePromise***REMOVED***=***REMOVED***resolve;
***REMOVED******REMOVED******REMOVED******REMOVED***});

***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***token***REMOVED***=***REMOVED***this;

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***eslint-disable-next-line***REMOVED***func-names
***REMOVED******REMOVED******REMOVED******REMOVED***this.promise.then(cancel***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!token._listeners)***REMOVED***return;

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***i***REMOVED***=***REMOVED***token._listeners.length;

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***while***REMOVED***(i--***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token._listeners[i](cancel);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token._listeners***REMOVED***=***REMOVED***null;
***REMOVED******REMOVED******REMOVED******REMOVED***});

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***eslint-disable-next-line***REMOVED***func-names
***REMOVED******REMOVED******REMOVED******REMOVED***this.promise.then***REMOVED***=***REMOVED***onfulfilled***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***_resolve;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***eslint-disable-next-line***REMOVED***func-names
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***promise***REMOVED***=***REMOVED***new***REMOVED***Promise(resolve***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token.subscribe(resolve);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***_resolve***REMOVED***=***REMOVED***resolve;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}).then(onfulfilled);

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***promise.cancel***REMOVED***=***REMOVED***function***REMOVED***reject()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token.unsubscribe(_resolve);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***};

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***promise;
***REMOVED******REMOVED******REMOVED******REMOVED***};

***REMOVED******REMOVED******REMOVED******REMOVED***executor(function***REMOVED***cancel(message,***REMOVED***config,***REMOVED***request)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(token.reason)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***Cancellation***REMOVED***has***REMOVED***already***REMOVED***been***REMOVED***requested
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token.reason***REMOVED***=***REMOVED***new***REMOVED***CanceledError(message,***REMOVED***config,***REMOVED***request);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***resolvePromise(token.reason);
***REMOVED******REMOVED******REMOVED******REMOVED***});
***REMOVED******REMOVED***}

***REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED*******REMOVED***Throws***REMOVED***a***REMOVED***`CanceledError`***REMOVED***if***REMOVED***cancellation***REMOVED***has***REMOVED***been***REMOVED***requested.
***REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED***throwIfRequested()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.reason)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***this.reason;
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED*******REMOVED***Subscribe***REMOVED***to***REMOVED***the***REMOVED***cancel***REMOVED***signal
***REMOVED******REMOVED******REMOVED****/

***REMOVED******REMOVED***subscribe(listener)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this.reason)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***listener(this.reason);
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(this._listeners)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this._listeners.push(listener);
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this._listeners***REMOVED***=***REMOVED***[listener];
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED*******REMOVED***Unsubscribe***REMOVED***from***REMOVED***the***REMOVED***cancel***REMOVED***signal
***REMOVED******REMOVED******REMOVED****/

***REMOVED******REMOVED***unsubscribe(listener)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!this._listeners)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return;
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***index***REMOVED***=***REMOVED***this._listeners.indexOf(listener);
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(index***REMOVED***!==***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***this._listeners.splice(index,***REMOVED***1);
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***toAbortSignal()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***controller***REMOVED***=***REMOVED***new***REMOVED***AbortController();

***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***abort***REMOVED***=***REMOVED***(err)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***controller.abort(err);
***REMOVED******REMOVED******REMOVED******REMOVED***};

***REMOVED******REMOVED******REMOVED******REMOVED***this.subscribe(abort);

***REMOVED******REMOVED******REMOVED******REMOVED***controller.signal.unsubscribe***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***this.unsubscribe(abort);

***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***controller.signal;
***REMOVED******REMOVED***}

***REMOVED******REMOVED***/**
***REMOVED******REMOVED******REMOVED*******REMOVED***Returns***REMOVED***an***REMOVED***object***REMOVED***that***REMOVED***contains***REMOVED***a***REMOVED***new***REMOVED***`CancelToken`***REMOVED***and***REMOVED***a***REMOVED***function***REMOVED***that,***REMOVED***when***REMOVED***called,
***REMOVED******REMOVED******REMOVED*******REMOVED***cancels***REMOVED***the***REMOVED***`CancelToken`.
***REMOVED******REMOVED******REMOVED****/
***REMOVED******REMOVED***static***REMOVED***source()***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***cancel;
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***token***REMOVED***=***REMOVED***new***REMOVED***CancelToken(function***REMOVED***executor(c)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***cancel***REMOVED***=***REMOVED***c;
***REMOVED******REMOVED******REMOVED******REMOVED***});
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***token,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***cancel
***REMOVED******REMOVED******REMOVED******REMOVED***};
***REMOVED******REMOVED***}
}

export***REMOVED***default***REMOVED***CancelToken;
