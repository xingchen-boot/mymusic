import***REMOVED***{***REMOVED***defineStore***REMOVED***}***REMOVED***from***REMOVED***'pinia'
import***REMOVED***{***REMOVED***ref,***REMOVED***computed***REMOVED***}***REMOVED***from***REMOVED***'vue'
import***REMOVED***axios***REMOVED***from***REMOVED***'axios'
import***REMOVED***{***REMOVED***useUserStore***REMOVED***}***REMOVED***from***REMOVED***'./user'

export***REMOVED***interface***REMOVED***Music***REMOVED***{
***REMOVED******REMOVED***id:***REMOVED***number
***REMOVED******REMOVED***mid:***REMOVED***string
***REMOVED******REMOVED***song:***REMOVED***string
***REMOVED******REMOVED***singer:***REMOVED***string
***REMOVED******REMOVED***album:***REMOVED***string
***REMOVED******REMOVED***cover:***REMOVED***string
***REMOVED******REMOVED***time?:***REMOVED***string
***REMOVED******REMOVED***pay?:***REMOVED***string
}

export***REMOVED***interface***REMOVED***Playlist***REMOVED***{
***REMOVED******REMOVED***id:***REMOVED***number
***REMOVED******REMOVED***name:***REMOVED***string
***REMOVED******REMOVED***description:***REMOVED***string
***REMOVED******REMOVED***cover:***REMOVED***string
***REMOVED******REMOVED***userId:***REMOVED***number
***REMOVED******REMOVED***createdAt:***REMOVED***string
***REMOVED******REMOVED***updatedAt:***REMOVED***string
***REMOVED******REMOVED***musicList?:***REMOVED***PlaylistMusic[]
***REMOVED******REMOVED***musicCount:***REMOVED***number
}

export***REMOVED***interface***REMOVED***PlaylistMusic***REMOVED***{
***REMOVED******REMOVED***id:***REMOVED***number
***REMOVED******REMOVED***playlistId:***REMOVED***number
***REMOVED******REMOVED***musicId:***REMOVED***number
***REMOVED******REMOVED***musicMid:***REMOVED***string
***REMOVED******REMOVED***musicSong:***REMOVED***string
***REMOVED******REMOVED***musicSinger:***REMOVED***string
***REMOVED******REMOVED***musicAlbum:***REMOVED***string
***REMOVED******REMOVED***musicCover:***REMOVED***string
***REMOVED******REMOVED***musicUrl:***REMOVED***string
***REMOVED******REMOVED***sortOrder:***REMOVED***number
***REMOVED******REMOVED***addedAt:***REMOVED***string
}

export***REMOVED***const***REMOVED***useMusicStore***REMOVED***=***REMOVED***defineStore('music',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED***//***REMOVED***用户store引用
***REMOVED******REMOVED***const***REMOVED***userStore***REMOVED***=***REMOVED***useUserStore()
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***状态
***REMOVED******REMOVED***const***REMOVED***currentMusic***REMOVED***=***REMOVED***ref<Music***REMOVED***|***REMOVED***null>(null)
***REMOVED******REMOVED***const***REMOVED***musicList***REMOVED***=***REMOVED***ref<Music[]>([])
***REMOVED******REMOVED***const***REMOVED***isPlaying***REMOVED***=***REMOVED***ref(false)
***REMOVED******REMOVED***const***REMOVED***isLoading***REMOVED***=***REMOVED***ref(false)
***REMOVED******REMOVED***const***REMOVED***searchKeyword***REMOVED***=***REMOVED***ref('')
***REMOVED******REMOVED***const***REMOVED***audio***REMOVED***=***REMOVED***ref<HTMLAudioElement***REMOVED***|***REMOVED***null>(null)
***REMOVED******REMOVED***const***REMOVED***currentTime***REMOVED***=***REMOVED***ref(0)
***REMOVED******REMOVED***const***REMOVED***duration***REMOVED***=***REMOVED***ref(0)
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***无限滚动相关状态
***REMOVED******REMOVED***const***REMOVED***currentPage***REMOVED***=***REMOVED***ref(1)
***REMOVED******REMOVED***const***REMOVED***hasMoreData***REMOVED***=***REMOVED***ref(true)
***REMOVED******REMOVED***const***REMOVED***isLoadingMore***REMOVED***=***REMOVED***ref(false)
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***播放队列相关状态
***REMOVED******REMOVED***const***REMOVED***playQueue***REMOVED***=***REMOVED***ref<Music[]>([])
***REMOVED******REMOVED***const***REMOVED***showPlayQueue***REMOVED***=***REMOVED***ref(false)
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***音量控制相关状态
***REMOVED******REMOVED***const***REMOVED***volume***REMOVED***=***REMOVED***ref(70)***REMOVED***//***REMOVED***默认音量70%
***REMOVED******REMOVED***const***REMOVED***isMuted***REMOVED***=***REMOVED***ref(false)***REMOVED***//***REMOVED***是否静音
***REMOVED******REMOVED***const***REMOVED***previousVolume***REMOVED***=***REMOVED***ref(70)***REMOVED***//***REMOVED***静音前的音量
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***播放模式相关状态
***REMOVED******REMOVED***const***REMOVED***playMode***REMOVED***=***REMOVED***ref('list')***REMOVED***//***REMOVED***list:***REMOVED***列表循环,***REMOVED***single:***REMOVED***单曲循环,***REMOVED***random:***REMOVED***随机播放
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***收藏相关状态
***REMOVED******REMOVED***const***REMOVED***isCurrentMusicLiked***REMOVED***=***REMOVED***ref(false)***REMOVED***//***REMOVED***当前播放音乐是否已收藏
***REMOVED******REMOVED***const***REMOVED***isInTempPlayMode***REMOVED***=***REMOVED***ref(false)***REMOVED***//***REMOVED***是否在临时播放模式（播放我喜欢的）
***REMOVED******REMOVED***const***REMOVED***originalPlayQueue***REMOVED***=***REMOVED***ref<Music[]>([])***REMOVED***//***REMOVED***保存原始播放队列
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***收藏状态变化监听器
***REMOVED******REMOVED***const***REMOVED***favoriteStatusListeners***REMOVED***=***REMOVED***ref<Array<(isLiked:***REMOVED***boolean)***REMOVED***=>***REMOVED***void>>([])

***REMOVED******REMOVED***//***REMOVED***最近播放变化监听器（携带负载，方便前端增量更新）
***REMOVED******REMOVED***type***REMOVED***RecentPlayEvent***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***type:***REMOVED***'record'***REMOVED***|***REMOVED***'progress'
***REMOVED******REMOVED******REMOVED******REMOVED***music?:***REMOVED***Music
***REMOVED******REMOVED******REMOVED******REMOVED***playDuration?:***REMOVED***number
***REMOVED******REMOVED******REMOVED******REMOVED***playProgress?:***REMOVED***number
***REMOVED******REMOVED******REMOVED******REMOVED***playTime?:***REMOVED***number***REMOVED***//***REMOVED***ms***REMOVED***时间戳
***REMOVED******REMOVED***}
***REMOVED******REMOVED***const***REMOVED***recentPlayListeners***REMOVED***=***REMOVED***ref<Array<(event:***REMOVED***RecentPlayEvent)***REMOVED***=>***REMOVED***void>>([])
***REMOVED******REMOVED***const***REMOVED***addRecentPlayListener***REMOVED***=***REMOVED***(listener:***REMOVED***(event:***REMOVED***RecentPlayEvent)***REMOVED***=>***REMOVED***void)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***recentPlayListeners.value.push(listener)
***REMOVED******REMOVED***}
***REMOVED******REMOVED***const***REMOVED***removeRecentPlayListener***REMOVED***=***REMOVED***(listener:***REMOVED***(event:***REMOVED***RecentPlayEvent)***REMOVED***=>***REMOVED***void)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***index***REMOVED***=***REMOVED***recentPlayListeners.value.indexOf(listener)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(index***REMOVED***>***REMOVED***-1)***REMOVED***recentPlayListeners.value.splice(index,***REMOVED***1)
***REMOVED******REMOVED***}
***REMOVED******REMOVED***const***REMOVED***notifyRecentPlayListeners***REMOVED***=***REMOVED***(event:***REMOVED***RecentPlayEvent)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***recentPlayListeners.value.forEach(l***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{***REMOVED***l(event)***REMOVED***}***REMOVED***catch***REMOVED***(e)***REMOVED***{***REMOVED***console.error('最近播放监听器执行错误:',***REMOVED***e)***REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***防抖相关状态
***REMOVED******REMOVED***let***REMOVED***progressSyncTimer:***REMOVED***NodeJS.Timeout***REMOVED***|***REMOVED***null***REMOVED***=***REMOVED***null
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***请求频率限制
***REMOVED******REMOVED***let***REMOVED***lastRequestTime***REMOVED***=***REMOVED***0
***REMOVED******REMOVED***const***REMOVED***REQUEST_INTERVAL***REMOVED***=***REMOVED***5000***REMOVED***//***REMOVED***5秒间隔，进一步增加间隔时间
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***请求队列管理
***REMOVED******REMOVED***let***REMOVED***isRequestingUrl***REMOVED***=***REMOVED***false
***REMOVED******REMOVED***const***REMOVED***requestQueue:***REMOVED***Array<{music:***REMOVED***Music,***REMOVED***resolve:***REMOVED***Function,***REMOVED***reject:***REMOVED***Function}>***REMOVED***=***REMOVED***[]

***REMOVED******REMOVED***//***REMOVED***计算属性
***REMOVED******REMOVED***const***REMOVED***hasCurrentMusic***REMOVED***=***REMOVED***computed(()***REMOVED***=>***REMOVED***currentMusic.value***REMOVED***!==***REMOVED***null)
***REMOVED******REMOVED***const***REMOVED***progress***REMOVED***=***REMOVED***computed(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(duration.value***REMOVED***===***REMOVED***0)***REMOVED***return***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***(currentTime.value***REMOVED***/***REMOVED***duration.value)***REMOVED*******REMOVED***100
***REMOVED******REMOVED***})
***REMOVED******REMOVED***const***REMOVED***queueCount***REMOVED***=***REMOVED***computed(()***REMOVED***=>***REMOVED***playQueue.value.length)
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***播放模式图标
***REMOVED******REMOVED***const***REMOVED***playModeIcon***REMOVED***=***REMOVED***computed(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***switch***REMOVED***(playMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'list':***REMOVED***return***REMOVED***'🔁'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'single':***REMOVED***return***REMOVED***'🔂'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'random':***REMOVED***return***REMOVED***'🔀'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***default:***REMOVED***return***REMOVED***'🔁'
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***})
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***播放模式名称
***REMOVED******REMOVED***const***REMOVED***playModeName***REMOVED***=***REMOVED***computed(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***switch***REMOVED***(playMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'list':***REMOVED***return***REMOVED***'列表循环'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'single':***REMOVED***return***REMOVED***'单曲循环'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'random':***REMOVED***return***REMOVED***'随机播放'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***default:***REMOVED***return***REMOVED***'列表循环'
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***})

***REMOVED******REMOVED***//***REMOVED***初始化音频
***REMOVED******REMOVED***const***REMOVED***initAudio***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value***REMOVED***=***REMOVED***new***REMOVED***Audio()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***设置初始音量
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***volume.value***REMOVED***/***REMOVED***100
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.addEventListener('timeupdate',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentTime.value***REMOVED***=***REMOVED***audio.value?.currentTime***REMOVED***||***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***每1秒同步一次播放进度到数据库，提高同步频率
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(Math.floor(currentTime.value)***REMOVED***%***REMOVED***1***REMOVED***===***REMOVED***0***REMOVED***&&***REMOVED***currentTime.value***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***syncPlayProgressToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.addEventListener('loadedmetadata',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***duration.value***REMOVED***=***REMOVED***audio.value?.duration***REMOVED***||***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.addEventListener('ended',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***自动播放下一首
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playNext()
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***页面卸载时立即同步播放进度
***REMOVED******REMOVED******REMOVED******REMOVED***window.addEventListener('beforeunload',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(audio.value***REMOVED***&&***REMOVED***currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***使用立即同步方法
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***syncPlayProgressImmediately()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***页面隐藏时同步播放进度
***REMOVED******REMOVED******REMOVED******REMOVED***document.addEventListener('visibilitychange',***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(document.hidden***REMOVED***&&***REMOVED***audio.value***REMOVED***&&***REMOVED***currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***syncPlayProgressToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***搜索音乐（首次搜索）
***REMOVED******REMOVED***const***REMOVED***searchMusic***REMOVED***=***REMOVED***async***REMOVED***(keyword:***REMOVED***string)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!keyword.trim())***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***isLoading.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***searchKeyword.value***REMOVED***=***REMOVED***keyword
***REMOVED******REMOVED******REMOVED******REMOVED***currentPage.value***REMOVED***=***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***musicList.value***REMOVED***=***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔍***REMOVED***开始搜索音乐，关键词:',***REMOVED***keyword)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***apiUrl***REMOVED***=***REMOVED***'/api/music/search'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***params***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***keyword:***REMOVED***keyword,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***page:***REMOVED***1,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***size:***REMOVED***20
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📡***REMOVED***调用后端API:',***REMOVED***apiUrl,***REMOVED***params)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***res***REMOVED***=***REMOVED***await***REMOVED***axios.get(apiUrl,***REMOVED***{***REMOVED***params***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***后端API响应:',***REMOVED***res.data)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(res.data.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***newMusicList***REMOVED***=***REMOVED***res.data.data***REMOVED***||***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicList.value***REMOVED***=***REMOVED***newMusicList
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***检查是否还有更多数据
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***newMusicList.length***REMOVED***>=***REMOVED***20
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🎵***REMOVED***首次搜索完成，获得',***REMOVED***newMusicList.length,***REMOVED***'首歌曲')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📄***REMOVED***是否还有更多数据:',***REMOVED***hasMoreData.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(res.data.message***REMOVED***||***REMOVED***'搜索失败')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error:***REMOVED***any)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***搜索音乐失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('错误详情:',***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***message:***REMOVED***error.message,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***status:***REMOVED***error.response?.status,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***statusText:***REMOVED***error.response?.statusText,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***data:***REMOVED***error.response?.data
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicList.value***REMOVED***=***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***finally***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isLoading.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***加载更多音乐
***REMOVED******REMOVED***const***REMOVED***loadMoreMusic***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!hasMoreData.value***REMOVED***||***REMOVED***isLoadingMore.value***REMOVED***||***REMOVED***!searchKeyword.value.trim())***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***isLoadingMore.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextPage***REMOVED***=***REMOVED***currentPage.value***REMOVED***+***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('📄***REMOVED***加载更多音乐，页码:',***REMOVED***nextPage)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***apiUrl***REMOVED***=***REMOVED***'/api/music/search'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***params***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***keyword:***REMOVED***searchKeyword.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***page:***REMOVED***nextPage,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***size:***REMOVED***20
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***res***REMOVED***=***REMOVED***await***REMOVED***axios.get(apiUrl,***REMOVED***{***REMOVED***params***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(res.data.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***newMusicList***REMOVED***=***REMOVED***res.data.data***REMOVED***||***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(newMusicList.length***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***将新数据追加到现有列表
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicList.value***REMOVED***=***REMOVED***[...musicList.value,***REMOVED***...newMusicList]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentPage.value***REMOVED***=***REMOVED***nextPage
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***检查是否还有更多数据
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***newMusicList.length***REMOVED***>=***REMOVED***20
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***加载更多成功，新增',***REMOVED***newMusicList.length,***REMOVED***'首歌曲')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📊***REMOVED***总歌曲数:',***REMOVED***musicList.value.length)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📄***REMOVED***是否还有更多数据:',***REMOVED***hasMoreData.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📄***REMOVED***没有更多数据了')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(res.data.message***REMOVED***||***REMOVED***'加载更多失败')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***加载更多音乐失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***finally***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isLoadingMore.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***const***REMOVED***getMusicPlayUrl***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***retryCount***REMOVED***=***REMOVED***0)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果正在请求，加入队列
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isRequestingUrl)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***new***REMOVED***Promise((resolve,***REMOVED***reject)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***requestQueue.push({***REMOVED***music,***REMOVED***resolve,***REMOVED***reject***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***isRequestingUrl***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***_getMusicPlayUrl(music,***REMOVED***retryCount)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***处理队列中的下一个请求
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(requestQueue.length***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextRequest***REMOVED***=***REMOVED***requestQueue.shift()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(nextRequest)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***setTimeout(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isRequestingUrl***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***getMusicPlayUrl(nextRequest.music).then(nextRequest.resolve).catch(nextRequest.reject)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},***REMOVED***REQUEST_INTERVAL)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isRequestingUrl***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***result
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***处理队列中的下一个请求
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(requestQueue.length***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextRequest***REMOVED***=***REMOVED***requestQueue.shift()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(nextRequest)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***setTimeout(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isRequestingUrl***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***getMusicPlayUrl(nextRequest.music).then(nextRequest.resolve).catch(nextRequest.reject)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},***REMOVED***REQUEST_INTERVAL)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isRequestingUrl***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***error
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***const***REMOVED***_getMusicPlayUrl***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***retryCount***REMOVED***=***REMOVED***0)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***请求频率限制
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***now***REMOVED***=***REMOVED***Date.now()
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***timeSinceLastRequest***REMOVED***=***REMOVED***now***REMOVED***-***REMOVED***lastRequestTime
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(timeSinceLastRequest***REMOVED***<***REMOVED***REQUEST_INTERVAL)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***waitTime***REMOVED***=***REMOVED***REQUEST_INTERVAL***REMOVED***-***REMOVED***timeSinceLastRequest
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log(`⏳***REMOVED***请求频率限制，等待***REMOVED***${waitTime}ms`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***new***REMOVED***Promise(resolve***REMOVED***=>***REMOVED***setTimeout(resolve,***REMOVED***waitTime))
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***lastRequestTime***REMOVED***=***REMOVED***Date.now()

***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***apiUrl***REMOVED***=***REMOVED***'/api/music/url'
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***params***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***...(music.mid***REMOVED***?***REMOVED***{***REMOVED***mid***REMOVED***:***REMOVED***music.mid***REMOVED***}***REMOVED***:***REMOVED***{***REMOVED***id***REMOVED***:***REMOVED***music.id***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🎵***REMOVED***获取播放URL:',***REMOVED***apiUrl,***REMOVED***params)

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***res***REMOVED***=***REMOVED***await***REMOVED***axios.get(apiUrl,***REMOVED***{***REMOVED***params***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if(res.data.code***REMOVED***!==***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('API响应错误:',***REMOVED***res.data)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果是"choose超过最大值"错误，等待后重试
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***errorMessage***REMOVED***=***REMOVED***res.data.message***REMOVED***||***REMOVED***res.data.msg***REMOVED***||***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(errorMessage.includes('choose超过最大值')***REMOVED***&&***REMOVED***retryCount***REMOVED***<***REMOVED***3)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***waitTime***REMOVED***=***REMOVED***5000***REMOVED*******REMOVED***(retryCount***REMOVED***+***REMOVED***1)***REMOVED***//***REMOVED***5秒、10秒、15秒
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log(`⚠️***REMOVED***获取播放URL失败，${waitTime/1000}秒后重试***REMOVED***(${retryCount***REMOVED***+***REMOVED***1}/3):`,***REMOVED***errorMessage)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***new***REMOVED***Promise(resolve***REMOVED***=>***REMOVED***setTimeout(resolve,***REMOVED***waitTime))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***_getMusicPlayUrl(music,***REMOVED***retryCount***REMOVED***+***REMOVED***1)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(errorMessage***REMOVED***||***REMOVED***'获取播放URL失败')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if(!res.data.data?.url)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error('获取音乐播放URL失败')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***res.data.data
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error:***REMOVED***any)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('请求异常:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果是网络错误且还有重试次数，等待后重试
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***((error.code***REMOVED***===***REMOVED***'NETWORK_ERROR'***REMOVED***||***REMOVED***error.message?.includes('Network***REMOVED***Error'))***REMOVED***&&***REMOVED***retryCount***REMOVED***<***REMOVED***2)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log(`⚠️***REMOVED***网络错误，${2***REMOVED********REMOVED***retryCount}秒后重试***REMOVED***(${retryCount***REMOVED***+***REMOVED***1}/2):`,***REMOVED***error.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***new***REMOVED***Promise(resolve***REMOVED***=>***REMOVED***setTimeout(resolve,***REMOVED***2000***REMOVED*******REMOVED***(2***REMOVED********REMOVED***retryCount)))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return***REMOVED***_getMusicPlayUrl(music,***REMOVED***retryCount***REMOVED***+***REMOVED***1)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***error
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***下载音乐
***REMOVED******REMOVED***const***REMOVED***downloadMusic***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⬇️***REMOVED***开始下载音乐:',***REMOVED***music.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***获取音乐播放URL（这个URL就是音乐文件的直链）
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***musicData***REMOVED***=***REMOVED***await***REMOVED***getMusicPlayUrl(music)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!musicData.url)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error('获取音乐下载链接失败')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***使用fetch获取文件内容
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(musicData.url,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'GET',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***headers:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'User-Agent':***REMOVED***'Mozilla/5.0***REMOVED***(Windows***REMOVED***NT***REMOVED***10.0;***REMOVED***Win64;***REMOVED***x64)***REMOVED***AppleWebKit/537.36'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!response.ok)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(`下载失败:***REMOVED***${response.status}***REMOVED***${response.statusText}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***获取文件内容
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***blob***REMOVED***=***REMOVED***await***REMOVED***response.blob()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***创建blob***REMOVED***URL
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***blobUrl***REMOVED***=***REMOVED***URL.createObjectURL(blob)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***创建下载链接
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***link***REMOVED***=***REMOVED***document.createElement('a')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***link.href***REMOVED***=***REMOVED***blobUrl
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***link.download***REMOVED***=***REMOVED***`${music.song}***REMOVED***-***REMOVED***${music.singer}.${musicData.format***REMOVED***||***REMOVED***'mp3'}`
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***触发下载
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***document.body.appendChild(link)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***link.click()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***document.body.removeChild(link)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清理blob***REMOVED***URL
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***setTimeout(()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***URL.revokeObjectURL(blobUrl)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},***REMOVED***1000)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***音乐下载已开始:',***REMOVED***music.song)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***下载音乐失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***error
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***记录最近播放
***REMOVED******REMOVED***const***REMOVED***recordRecentPlay***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***playDuration:***REMOVED***number***REMOVED***=***REMOVED***0,***REMOVED***playProgress:***REMOVED***number***REMOVED***=***REMOVED***0)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法记录最近播放')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch('/api/recent-play/record',***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'POST',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***headers:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'Content-Type':***REMOVED***'application/json'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***body:***REMOVED***JSON.stringify({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***userId:***REMOVED***userStore.currentUser.id,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicId:***REMOVED***music.id.toString(),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicMid:***REMOVED***music.mid,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicSong:***REMOVED***music.song,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicSinger:***REMOVED***music.singer,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicAlbum:***REMOVED***music.album***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicCover:***REMOVED***music.cover***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicTime:***REMOVED***music.time***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicPay:***REMOVED***music.pay***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playDuration:***REMOVED***playDuration,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playProgress:***REMOVED***playProgress
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!response.ok)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(`HTTP***REMOVED***error!***REMOVED***status:***REMOVED***${response.status}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***最近播放记录成功:',***REMOVED***music.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***通知最近播放监听器（携带音乐数据用于增量插入）
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***notifyRecentPlayListeners({***REMOVED***type:***REMOVED***'record',***REMOVED***music***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***最近播放记录失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***记录最近播放失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***更新播放进度到最近播放
***REMOVED******REMOVED***const***REMOVED***updateRecentPlayProgress***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***playDuration:***REMOVED***number,***REMOVED***playProgress:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch('/api/recent-play/progress',***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***headers:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'Content-Type':***REMOVED***'application/json'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***body:***REMOVED***JSON.stringify({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***userId:***REMOVED***userStore.currentUser.id,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***musicId:***REMOVED***music.id.toString(),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playDuration:***REMOVED***playDuration,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playProgress:***REMOVED***playProgress
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!response.ok)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***new***REMOVED***Error(`HTTP***REMOVED***error!***REMOVED***status:***REMOVED***${response.status}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(result.code***REMOVED***!==***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***更新最近播放进度失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***通知最近播放监听器（用于实时更新当前项的进度/时间）
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***notifyRecentPlayListeners({***REMOVED***type:***REMOVED***'progress',***REMOVED***music,***REMOVED***playDuration,***REMOVED***playProgress,***REMOVED***playTime:***REMOVED***Date.now()***REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***更新最近播放进度失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***播放音乐
***REMOVED******REMOVED***const***REMOVED***playMusic***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果点击的是当前正在播放的音乐，则切换播放/暂停状态
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentMusic.value***REMOVED***&&***REMOVED***currentMusic.value.id***REMOVED***===***REMOVED***music.id)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***togglePlay()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***先添加到队列（如果不在队列中才会添加）
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***addToPlayQueueWithSync(music)
***REMOVED******REMOVED******REMOVED******REMOVED***currentMusic.value***REMOVED***=***REMOVED***music
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***检查当前音乐是否已收藏
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***checkCurrentMusicFavoriteStatus()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***musicData***REMOVED***=***REMOVED***await***REMOVED***getMusicPlayUrl(music)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if(!audio.value.paused***REMOVED***)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.pause()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.src***REMOVED***=***REMOVED***musicData.url
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***audio.value.play()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步当前播放音乐到数据库
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncCurrentMusicToDatabase(music,***REMOVED***musicData.url)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***记录最近播放
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***recordRecentPlay(music,***REMOVED***0,***REMOVED***0)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🎵***REMOVED***开始播放:',***REMOVED***music.song)
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error:***REMOVED***any)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('播放音乐失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***显示用户友好的错误提示
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***ElMessage***REMOVED***}***REMOVED***=***REMOVED***await***REMOVED***import('element-plus')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(error.message***REMOVED***&&***REMOVED***error.message.includes('choose超过最大值'))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.error('音乐服务繁忙，请稍后再试')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***if***REMOVED***(error.message***REMOVED***&&***REMOVED***error.message.includes('获取播放URL失败'))***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.error('无法获取音乐播放链接，请检查网络连接')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.error('播放失败:***REMOVED***'***REMOVED***+***REMOVED***(error.message***REMOVED***||***REMOVED***'未知错误'))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放失败时，保持当前状态不变，不要清空currentMusic
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.src***REMOVED***=***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***暂停/继续播放
***REMOVED******REMOVED***const***REMOVED***togglePlay***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***!currentMusic.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isPlaying.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.pause()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⏸️***REMOVED***暂停播放')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***audio.value.play()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('▶️***REMOVED***继续播放')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步播放状态到数据库
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayStatusToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('切换播放状态失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***停止播放
***REMOVED******REMOVED***const***REMOVED***stopMusic***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.pause()
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.currentTime***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***设置播放进度
***REMOVED******REMOVED***const***REMOVED***setProgress***REMOVED***=***REMOVED***async***REMOVED***(percent:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***!duration.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***time***REMOVED***=***REMOVED***(percent***REMOVED***/***REMOVED***100)***REMOVED*******REMOVED***duration.value
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.currentTime***REMOVED***=***REMOVED***time
***REMOVED******REMOVED******REMOVED******REMOVED***currentTime.value***REMOVED***=***REMOVED***time
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***立即同步播放进度到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayProgressToDatabase()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***==========***REMOVED***音量控制相关方法***REMOVED***==========
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***设置音量
***REMOVED******REMOVED***const***REMOVED***setVolume***REMOVED***=***REMOVED***async***REMOVED***(newVolume:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***volume.value***REMOVED***=***REMOVED***Math.max(0,***REMOVED***Math.min(100,***REMOVED***newVolume))***REMOVED***//***REMOVED***限制在0-100之间
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(audio.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***volume.value***REMOVED***/***REMOVED***100
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果设置音量大于0，取消静音
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(volume.value***REMOVED***>***REMOVED***0***REMOVED***&&***REMOVED***isMuted.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncVolumeToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔊***REMOVED***音量设置为:',***REMOVED***volume.value***REMOVED***+***REMOVED***'%')
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***切换静音状态
***REMOVED******REMOVED***const***REMOVED***toggleMute***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isMuted.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***取消静音，恢复之前的音量
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***volume.value***REMOVED***=***REMOVED***previousVolume.value
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***volume.value***REMOVED***/***REMOVED***100
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔊***REMOVED***取消静音，音量:',***REMOVED***volume.value***REMOVED***+***REMOVED***'%')
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***静音，保存当前音量
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***previousVolume.value***REMOVED***=***REMOVED***volume.value
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***volume.value***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔇***REMOVED***静音')
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncMuteStatusToDatabase()
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***静音
***REMOVED******REMOVED***const***REMOVED***mute***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***isMuted.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***previousVolume.value***REMOVED***=***REMOVED***volume.value
***REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔇***REMOVED***静音')
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***取消静音
***REMOVED******REMOVED***const***REMOVED***unmute***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***!isMuted.value)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***volume.value***REMOVED***=***REMOVED***previousVolume.value
***REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***volume.value***REMOVED***/***REMOVED***100
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔊***REMOVED***取消静音，音量:',***REMOVED***volume.value***REMOVED***+***REMOVED***'%')
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***==========***REMOVED***播放设置数据库同步方法***REMOVED***==========
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步音量到数据库
***REMOVED******REMOVED***const***REMOVED***syncVolumeToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步音量到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/volume/${userStore.currentUser.id}?volume=${volume.value}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***音量同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***音量同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***音量同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步静音状态到数据库
***REMOVED******REMOVED***const***REMOVED***syncMuteStatusToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步静音状态到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/mute/${userStore.currentUser.id}?isMuted=${isMuted.value}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***静音状态同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***静音状态同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***静音状态同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步播放模式到数据库
***REMOVED******REMOVED***const***REMOVED***syncPlayModeToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步播放模式到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/play-mode/${userStore.currentUser.id}?playMode=${playMode.value}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放模式同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放模式同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放模式同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步播放进度到数据库（带防抖）
***REMOVED******REMOVED***const***REMOVED***syncPlayProgressToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步播放进度到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清除之前的定时器
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(progressSyncTimer)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***clearTimeout(progressSyncTimer)
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***设置新的定时器，200ms后执行同步
***REMOVED******REMOVED******REMOVED******REMOVED***progressSyncTimer***REMOVED***=***REMOVED***setTimeout(async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***url***REMOVED***=***REMOVED***`http://localhost:9092/api/user-play-settings/play-progress/${userStore.currentUser?.id}?playProgress=${progress.value}&playTime=${currentTime.value}`
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***使用fetch***REMOVED***with***REMOVED***keepalive确保请求能完成
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(url,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***keepalive:***REMOVED***true***REMOVED***//***REMOVED***确保请求在页面卸载时也能完成
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放进度同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同时更新最近播放的进度
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***updateRecentPlayProgress(currentMusic.value,***REMOVED***currentTime.value,***REMOVED***progress.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放进度同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放进度同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***},***REMOVED***200)
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***立即同步播放进度到数据库（用于页面卸载时）
***REMOVED******REMOVED***const***REMOVED***syncPlayProgressImmediately***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***url***REMOVED***=***REMOVED***`http://localhost:9092/api/user-play-settings/play-progress/${userStore.currentUser.id}?playProgress=${progress.value}&playTime=${currentTime.value}`
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***使用同步请求确保数据能发送出去
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***xhr***REMOVED***=***REMOVED***new***REMOVED***XMLHttpRequest()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***xhr.open('PUT',***REMOVED***url,***REMOVED***false)***REMOVED***//***REMOVED***同步请求
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***xhr.setRequestHeader('Content-Type',***REMOVED***'application/json')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***xhr.send()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(xhr.status***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放进度立即同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放进度立即同步失败，状态码:',***REMOVED***xhr.status)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放进度立即同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步当前播放音乐到数据库
***REMOVED******REMOVED***const***REMOVED***syncCurrentMusicToDatabase***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***musicUrl:***REMOVED***string)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步当前播放音乐到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/current-music/${userStore.currentUser.id}?musicId=${music.id}&musicName=${encodeURIComponent(music.song)}&musicArtist=${encodeURIComponent(music.singer)}&musicCover=${encodeURIComponent(music.cover)}&musicUrl=${encodeURIComponent(musicUrl)}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***当前播放音乐同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***当前播放音乐同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***当前播放音乐同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步播放状态到数据库
***REMOVED******REMOVED***const***REMOVED***syncPlayStatusToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步播放状态到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/play-status/${userStore.currentUser.id}?isPlaying=${isPlaying.value}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放状态同步到数据库成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放状态同步到数据库失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放状态同步到数据库错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***从数据库加载播放设置
***REMOVED******REMOVED***const***REMOVED***loadPlaySettingsFromDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法加载播放设置')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***开始加载用户播放设置，用户ID:',***REMOVED***userStore.currentUser.id)

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-settings/user/${userStore.currentUser.id}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📡***REMOVED***播放设置API响应:',***REMOVED***result)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(result.code***REMOVED***===***REMOVED***200***REMOVED***&&***REMOVED***result.data)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***settings***REMOVED***=***REMOVED***result.data
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复音量设置
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***volume.value***REMOVED***=***REMOVED***settings.volume***REMOVED***||***REMOVED***70
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(audio.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***volume.value***REMOVED***/***REMOVED***100
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复静音状态
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted.value***REMOVED***=***REMOVED***settings.isMuted***REMOVED***||***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isMuted.value***REMOVED***&&***REMOVED***audio.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.volume***REMOVED***=***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复播放模式
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playMode.value***REMOVED***=***REMOVED***settings.playMode***REMOVED***||***REMOVED***'list'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复当前播放音乐和进度
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(settings.currentMusicId***REMOVED***&&***REMOVED***settings.currentMusicName)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***music:***REMOVED***Music***REMOVED***=***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***id:***REMOVED***parseInt(settings.currentMusicId),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mid:***REMOVED***settings.currentMusicId,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***song:***REMOVED***settings.currentMusicName,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***singer:***REMOVED***settings.currentMusicArtist***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***album:***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***cover:***REMOVED***settings.currentMusicCover***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***time:***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***pay:***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentMusic.value***REMOVED***=***REMOVED***music
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果有播放URL，设置音频源
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(settings.currentMusicUrl***REMOVED***&&***REMOVED***audio.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.src***REMOVED***=***REMOVED***settings.currentMusicUrl
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***audio.value.currentTime***REMOVED***=***REMOVED***settings.playTime***REMOVED***||***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentTime.value***REMOVED***=***REMOVED***settings.playTime***REMOVED***||***REMOVED***0
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复播放状态
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***settings.isPlaying***REMOVED***||***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果之前是播放状态，尝试继续播放
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(settings.isPlaying***REMOVED***&&***REMOVED***audio.value***REMOVED***&&***REMOVED***settings.currentMusicUrl)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***audio.value.play()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('▶️***REMOVED***恢复播放状态成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⚠️***REMOVED***恢复播放状态失败，可能需要用户交互:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放设置加载成功:',***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***volume:***REMOVED***volume.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted:***REMOVED***isMuted.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playMode:***REMOVED***playMode.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***currentMusic:***REMOVED***music.song,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playTime:***REMOVED***settings.playTime,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isPlaying:***REMOVED***isPlaying.value
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放设置加载成功（无当前音乐）:',***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***volume:***REMOVED***volume.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isMuted:***REMOVED***isMuted.value,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playMode:***REMOVED***playMode.value
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('ℹ️***REMOVED***用户没有保存的播放设置，使用默认设置')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***加载播放设置错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***==========***REMOVED***播放队列相关方法***REMOVED***==========
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***添加音乐到播放队列
***REMOVED******REMOVED***const***REMOVED***addToQueue***REMOVED***=***REMOVED***(music:***REMOVED***Music,***REMOVED***insertIndex?:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***检查是否已经在队列中
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***existingIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***music.id)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(existingIndex***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果已存在，不改变位置，直接返回
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🎵***REMOVED***音乐已在播放队列中，保持原位置:',***REMOVED***music.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***找到当前播放歌曲的位置，插入到其下面
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***finalInsertIndex***REMOVED***=***REMOVED***insertIndex***REMOVED***!==***REMOVED***undefined***REMOVED***?***REMOVED***insertIndex***REMOVED***:***REMOVED***playQueue.value.length***REMOVED***//***REMOVED***默认插入到队尾
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(insertIndex***REMOVED***===***REMOVED***undefined***REMOVED***&&***REMOVED***currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***currentMusic.value?.id)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentIndex***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***finalInsertIndex***REMOVED***=***REMOVED***currentIndex***REMOVED***+***REMOVED***1***REMOVED***//***REMOVED***插入到当前播放歌曲的下面
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***插入歌曲
***REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value.splice(finalInsertIndex,***REMOVED***0,***REMOVED***music)
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🎵***REMOVED***添加音乐到播放队列:',***REMOVED***music.song)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***从播放队列移除音乐
***REMOVED******REMOVED***const***REMOVED***removeFromQueue***REMOVED***=***REMOVED***(musicId:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***index***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***musicId)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(index***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value.splice(index,***REMOVED***1)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🗑️***REMOVED***从播放队列移除音乐')
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***清空播放队列
***REMOVED******REMOVED***const***REMOVED***clearQueue***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value***REMOVED***=***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🗑️***REMOVED***清空播放队列')
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***播放下一首
***REMOVED******REMOVED***const***REMOVED***playNext***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***playQueue.value.length***REMOVED***===***REMOVED***0)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***currentMusic.value?.id)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***switch***REMOVED***(playMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'list':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***列表循环：播放下一首，到最后一首时回到第一首
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextIndex***REMOVED***=***REMOVED***currentIndex***REMOVED***+***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(nextIndex***REMOVED***<***REMOVED***playQueue.value.length)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextMusic***REMOVED***=***REMOVED***playQueue.value[nextIndex]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⏭️***REMOVED***列表循环***REMOVED***-***REMOVED***播放下一首:',***REMOVED***nextMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(nextMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放第一首
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***firstMusic***REMOVED***=***REMOVED***playQueue.value[0]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⏭️***REMOVED***列表循环***REMOVED***-***REMOVED***回到第一首:',***REMOVED***firstMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(firstMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'single':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***单曲循环：重复播放当前歌曲
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔂***REMOVED***单曲循环***REMOVED***-***REMOVED***重复播放:',***REMOVED***currentMusic.value.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(currentMusic.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'random':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***随机播放：随机选择一首歌
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***randomIndex***REMOVED***=***REMOVED***Math.floor(Math.random()***REMOVED*******REMOVED***playQueue.value.length)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***randomMusic***REMOVED***=***REMOVED***playQueue.value[randomIndex]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔀***REMOVED***随机播放***REMOVED***-***REMOVED***随机选择:',***REMOVED***randomMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(randomMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***播放上一首
***REMOVED******REMOVED***const***REMOVED***playPrevious***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!audio.value***REMOVED***||***REMOVED***playQueue.value.length***REMOVED***===***REMOVED***0)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***currentMusic.value?.id)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***switch***REMOVED***(playMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'list':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***列表循环：播放上一首，到第一首时回到最后一首
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***prevIndex***REMOVED***=***REMOVED***currentIndex***REMOVED***-***REMOVED***1
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(prevIndex***REMOVED***>=***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***prevMusic***REMOVED***=***REMOVED***playQueue.value[prevIndex]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⏮️***REMOVED***列表循环***REMOVED***-***REMOVED***播放上一首:',***REMOVED***prevMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(prevMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放最后一首
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***lastMusic***REMOVED***=***REMOVED***playQueue.value[playQueue.value.length***REMOVED***-***REMOVED***1]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⏮️***REMOVED***列表循环***REMOVED***-***REMOVED***回到最后一首:',***REMOVED***lastMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(lastMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'single':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***单曲循环：重复播放当前歌曲
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔂***REMOVED***单曲循环***REMOVED***-***REMOVED***重复播放:',***REMOVED***currentMusic.value.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(currentMusic.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***case***REMOVED***'random':
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***随机播放：随机选择一首歌
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***randomIndex***REMOVED***=***REMOVED***Math.floor(Math.random()***REMOVED*******REMOVED***playQueue.value.length)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***randomMusic***REMOVED***=***REMOVED***playQueue.value[randomIndex]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔀***REMOVED***随机播放***REMOVED***-***REMOVED***随机选择:',***REMOVED***randomMusic.song)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(randomMusic)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***break
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***切换播放队列显示状态
***REMOVED******REMOVED***const***REMOVED***togglePlayQueue***REMOVED***=***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***showPlayQueue.value***REMOVED***=***REMOVED***!showPlayQueue.value
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***==========***REMOVED***播放模式相关方法***REMOVED***==========
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***切换播放模式
***REMOVED******REMOVED***const***REMOVED***togglePlayMode***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***modes***REMOVED***=***REMOVED***['list',***REMOVED***'single',***REMOVED***'random']
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentIndex***REMOVED***=***REMOVED***modes.indexOf(playMode.value)
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***nextIndex***REMOVED***=***REMOVED***(currentIndex***REMOVED***+***REMOVED***1)***REMOVED***%***REMOVED***modes.length
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***newMode***REMOVED***=***REMOVED***modes[nextIndex]
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***playMode.value***REMOVED***=***REMOVED***newMode
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayModeToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***显示切换提示
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***ElMessage***REMOVED***}***REMOVED***=***REMOVED***await***REMOVED***import('element-plus')
***REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.success(`已切换到${playModeName.value}模式`)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***播放模式切换为:',***REMOVED***playModeName.value)
***REMOVED******REMOVED***}
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***设置播放模式
***REMOVED******REMOVED***const***REMOVED***setPlayMode***REMOVED***=***REMOVED***async***REMOVED***(mode:***REMOVED***'list'***REMOVED***|***REMOVED***'single'***REMOVED***|***REMOVED***'random')***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(playMode.value***REMOVED***===***REMOVED***mode)***REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***playMode.value***REMOVED***=***REMOVED***mode
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayModeToDatabase()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***显示切换提示
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***ElMessage***REMOVED***}***REMOVED***=***REMOVED***await***REMOVED***import('element-plus')
***REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.success(`已切换到${playModeName.value}模式`)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***播放模式设置为:',***REMOVED***playModeName.value)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***重新排列播放队列
***REMOVED******REMOVED***const***REMOVED***reorderQueue***REMOVED***=***REMOVED***async***REMOVED***(fromIndex:***REMOVED***number,***REMOVED***toIndex:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***music***REMOVED***=***REMOVED***playQueue.value.splice(fromIndex,***REMOVED***1)[0]
***REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value.splice(toIndex,***REMOVED***0,***REMOVED***music)
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayQueueToDatabase()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***播放队列中的音乐
***REMOVED******REMOVED***const***REMOVED***playMusicFromQueue***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***直接播放音乐
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***playMusic(music)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***移动音乐到当前播放歌曲下面（用于搜索页面的🔄按钮）
***REMOVED******REMOVED***const***REMOVED***moveToCurrentPosition***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***检查是否已经在队列中
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***existingIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***music.id)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(existingIndex***REMOVED***===***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果不在队列中，直接添加到当前播放歌曲下面
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***addToPlayQueueWithSync(music)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果已在队列中，先移除
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***removeFromPlayQueueWithSync(music.id)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***找到当前播放歌曲的位置，插入到其下面
***REMOVED******REMOVED******REMOVED******REMOVED***let***REMOVED***insertIndex***REMOVED***=***REMOVED***playQueue.value.length***REMOVED***//***REMOVED***默认插入到队尾
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***currentIndex***REMOVED***=***REMOVED***playQueue.value.findIndex(item***REMOVED***=>***REMOVED***item.id***REMOVED***===***REMOVED***currentMusic.value?.id)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(currentIndex***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***insertIndex***REMOVED***=***REMOVED***currentIndex***REMOVED***+***REMOVED***1***REMOVED***//***REMOVED***插入到当前播放歌曲的下面
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***插入歌曲
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***addToPlayQueueWithSync(music,***REMOVED***insertIndex)
***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***移动音乐到当前播放歌曲下面:',***REMOVED***music.song)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***播放队列数据库同步方法
***REMOVED******REMOVED***
***REMOVED******REMOVED***//***REMOVED***同步播放队列到数据库
***REMOVED******REMOVED***const***REMOVED***syncPlayQueueToDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法同步播放队列到数据库')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***开始同步播放队列到数据库，用户ID:',***REMOVED***userStore.currentUser.id,***REMOVED***'队列长度:',***REMOVED***playQueue.value.length)

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清空数据库中的播放队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('🗑️***REMOVED***清空数据库中的播放队列...')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***clearResponse***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-queue/clear/${userStore.currentUser.id}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'DELETE'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('清空响应状态:',***REMOVED***clearResponse.status)

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***批量添加当前播放队列到数据库
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(playQueue.value.length***REMOVED***>***REMOVED***0)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📤***REMOVED***同步播放队列到数据库...')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-queue/reorder/${userStore.currentUser.id}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'PUT',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***headers:***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***'Content-Type':***REMOVED***'application/json',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***},
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***body:***REMOVED***JSON.stringify(playQueue.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📡***REMOVED***同步播放队列API响应:',***REMOVED***result)

***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放队列同步成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放队列同步失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('ℹ️***REMOVED***播放队列为空，无需同步')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***同步播放队列错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***从数据库加载播放队列
***REMOVED******REMOVED***const***REMOVED***loadPlayQueueFromDatabase***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录，无法加载播放队列')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***console.log('🔄***REMOVED***开始加载用户播放队列，用户ID:',***REMOVED***userStore.currentUser.id)

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-play-queue/user/${userStore.currentUser.id}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('📡***REMOVED***播放队列API响应:',***REMOVED***result)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value***REMOVED***=***REMOVED***result.data
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***播放队列加载成功，共',***REMOVED***result.data.length,***REMOVED***'首音乐')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放队列加载失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***播放队列加载错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***添加音乐到播放队列（带数据库同步）
***REMOVED******REMOVED***const***REMOVED***addToPlayQueueWithSync***REMOVED***=***REMOVED***async***REMOVED***(music:***REMOVED***Music,***REMOVED***insertIndex?:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***先添加到本地队列
***REMOVED******REMOVED******REMOVED******REMOVED***addToQueue(music,***REMOVED***insertIndex)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayQueueToDatabase()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***从播放队列移除音乐（带数据库同步）
***REMOVED******REMOVED***const***REMOVED***removeFromPlayQueueWithSync***REMOVED***=***REMOVED***async***REMOVED***(musicId:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***先从本地队列移除
***REMOVED******REMOVED******REMOVED******REMOVED***removeFromQueue(musicId)
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayQueueToDatabase()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***清空播放队列（带数据库同步）
***REMOVED******REMOVED***const***REMOVED***clearPlayQueueWithSync***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***先清空本地队列
***REMOVED******REMOVED******REMOVED******REMOVED***clearQueue()
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***同步到数据库
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***syncPlayQueueToDatabase()
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***重新排序播放队列（带数据库同步）
***REMOVED******REMOVED***const***REMOVED***reorderPlayQueueWithSync***REMOVED***=***REMOVED***async***REMOVED***(fromIndex:***REMOVED***number,***REMOVED***toIndex:***REMOVED***number)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***先重新排序本地队列
***REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***reorderQueue(fromIndex,***REMOVED***toIndex)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***==========***REMOVED***收藏相关方法***REMOVED***==========

***REMOVED******REMOVED***//***REMOVED***检查当前音乐是否已收藏
***REMOVED******REMOVED***const***REMOVED***checkCurrentMusicFavoriteStatus***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser***REMOVED***||***REMOVED***!currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-favorites/check?userId=${userStore.currentUser.id}&musicId=${currentMusic.value.id}`)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***result.data
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***检查收藏状态成功:',***REMOVED***isCurrentMusicLiked.value)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***检查收藏状态失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***检查收藏状态错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***切换收藏状态
***REMOVED******REMOVED***const***REMOVED***toggleFavorite***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!userStore.isLoggedIn***REMOVED***||***REMOVED***!userStore.currentUser***REMOVED***||***REMOVED***!currentMusic.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('❌***REMOVED***用户未登录或没有当前播放音乐')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED***}

***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isCurrentMusicLiked.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***取消收藏
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-favorites/remove?userId=${userStore.currentUser.id}&musicId=${currentMusic.value.id}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'DELETE'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***取消收藏成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***通知所有监听器
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***notifyFavoriteStatusListeners(false)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***显示提示
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***ElMessage***REMOVED***}***REMOVED***=***REMOVED***await***REMOVED***import('element-plus')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.success('已取消收藏')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***取消收藏失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***添加收藏
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***response***REMOVED***=***REMOVED***await***REMOVED***fetch(`http://localhost:9092/api/user-favorites/add?userId=${userStore.currentUser.id}&musicId=${currentMusic.value.id}&musicMid=${currentMusic.value.mid}&musicSong=${encodeURIComponent(currentMusic.value.song)}&musicSinger=${encodeURIComponent(currentMusic.value.singer)}&musicAlbum=${encodeURIComponent(currentMusic.value.album***REMOVED***||***REMOVED***'')}&musicCover=${encodeURIComponent(currentMusic.value.cover***REMOVED***||***REMOVED***'')}&musicTime=${encodeURIComponent(currentMusic.value.time***REMOVED***||***REMOVED***'')}&musicPay=${encodeURIComponent(currentMusic.value.pay***REMOVED***||***REMOVED***'')}`,***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***method:***REMOVED***'POST'
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***result***REMOVED***=***REMOVED***await***REMOVED***response.json()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(response.ok***REMOVED***&&***REMOVED***result.code***REMOVED***===***REMOVED***200)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***添加收藏成功')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***通知所有监听器
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***notifyFavoriteStatusListeners(true)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***显示提示
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***{***REMOVED***ElMessage***REMOVED***}***REMOVED***=***REMOVED***await***REMOVED***import('element-plus')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***ElMessage.success('已添加到我的喜欢')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***else***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***添加收藏失败:',***REMOVED***result.message)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***切换收藏状态错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***添加收藏状态监听器
***REMOVED******REMOVED***const***REMOVED***addFavoriteStatusListener***REMOVED***=***REMOVED***(listener:***REMOVED***(isLiked:***REMOVED***boolean)***REMOVED***=>***REMOVED***void)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***favoriteStatusListeners.value.push(listener)
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***移除收藏状态监听器
***REMOVED******REMOVED***const***REMOVED***removeFavoriteStatusListener***REMOVED***=***REMOVED***(listener:***REMOVED***(isLiked:***REMOVED***boolean)***REMOVED***=>***REMOVED***void)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***index***REMOVED***=***REMOVED***favoriteStatusListeners.value.indexOf(listener)
***REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(index***REMOVED***>***REMOVED***-1)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***favoriteStatusListeners.value.splice(index,***REMOVED***1)
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***切换到临时播放模式（播放我喜欢的）
***REMOVED******REMOVED***const***REMOVED***switchToTempPlayMode***REMOVED***=***REMOVED***async***REMOVED***(favorites:***REMOVED***any[])***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果已经在临时播放模式，直接返回
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(isInTempPlayMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⚠️***REMOVED***已经在临时播放模式')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***保存当前播放队列到原始队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***originalPlayQueue.value***REMOVED***=***REMOVED***[...playQueue.value]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('💾***REMOVED***保存原始播放队列，共',***REMOVED***originalPlayQueue.value.length,***REMOVED***'首音乐')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清空当前播放队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***clearPlayQueueWithSync()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***将收藏列表转换为Music格式并添加到播放队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***const***REMOVED***favoritesMusic***REMOVED***=***REMOVED***favorites.map(fav***REMOVED***=>***REMOVED***({
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***id:***REMOVED***parseInt(fav.musicId),
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***mid:***REMOVED***fav.musicMid,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***song:***REMOVED***fav.musicSong,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***singer:***REMOVED***fav.musicSinger,
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***album:***REMOVED***fav.musicAlbum***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***cover:***REMOVED***fav.musicCover***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***time:***REMOVED***fav.musicTime***REMOVED***||***REMOVED***'',
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***pay:***REMOVED***fav.musicPay***REMOVED***||***REMOVED***''
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}))
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***批量添加到播放队列（不保存到数据库）
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(const***REMOVED***music***REMOVED***of***REMOVED***favoritesMusic)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***playQueue.value.push(music)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***设置临时播放模式
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isInTempPlayMode.value***REMOVED***=***REMOVED***true
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***已切换到临时播放模式，播放我喜欢的音乐，共',***REMOVED***favoritesMusic.length,***REMOVED***'首')
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***切换到临时播放模式失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***error
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***恢复原始播放队列
***REMOVED******REMOVED***const***REMOVED***restoreOriginalPlayQueue***REMOVED***=***REMOVED***async***REMOVED***()***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***如果不在临时播放模式，直接返回
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***if***REMOVED***(!isInTempPlayMode.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('⚠️***REMOVED***不在临时播放模式，无需恢复')
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***return
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清空当前播放队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***clearPlayQueueWithSync()
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***恢复原始播放队列
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***for***REMOVED***(const***REMOVED***music***REMOVED***of***REMOVED***originalPlayQueue.value)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***await***REMOVED***addToPlayQueueWithSync(music)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***清空临时状态
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***isInTempPlayMode.value***REMOVED***=***REMOVED***false
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***originalPlayQueue.value***REMOVED***=***REMOVED***[]
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.log('✅***REMOVED***已恢复原始播放队列，共',***REMOVED***originalPlayQueue.value.length,***REMOVED***'首音乐')
***REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('❌***REMOVED***恢复原始播放队列失败:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***throw***REMOVED***error
***REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED***}

***REMOVED******REMOVED***//***REMOVED***通知所有收藏状态监听器
***REMOVED******REMOVED***const***REMOVED***notifyFavoriteStatusListeners***REMOVED***=***REMOVED***(isLiked:***REMOVED***boolean)***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***favoriteStatusListeners.value.forEach(listener***REMOVED***=>***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***try***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***listener(isLiked)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}***REMOVED***catch***REMOVED***(error)***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***console.error('收藏状态监听器执行错误:',***REMOVED***error)
***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***}
***REMOVED******REMOVED******REMOVED******REMOVED***})
***REMOVED******REMOVED***}


***REMOVED******REMOVED***return***REMOVED***{
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***状态
***REMOVED******REMOVED******REMOVED******REMOVED***currentMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***musicList,
***REMOVED******REMOVED******REMOVED******REMOVED***isPlaying,
***REMOVED******REMOVED******REMOVED******REMOVED***isLoading,
***REMOVED******REMOVED******REMOVED******REMOVED***searchKeyword,
***REMOVED******REMOVED******REMOVED******REMOVED***audio,
***REMOVED******REMOVED******REMOVED******REMOVED***currentTime,
***REMOVED******REMOVED******REMOVED******REMOVED***duration,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***无限滚动状态
***REMOVED******REMOVED******REMOVED******REMOVED***currentPage,
***REMOVED******REMOVED******REMOVED******REMOVED***hasMoreData,
***REMOVED******REMOVED******REMOVED******REMOVED***isLoadingMore,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放队列状态
***REMOVED******REMOVED******REMOVED******REMOVED***playQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***showPlayQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***音量控制状态
***REMOVED******REMOVED******REMOVED******REMOVED***volume,
***REMOVED******REMOVED******REMOVED******REMOVED***isMuted,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放模式状态
***REMOVED******REMOVED******REMOVED******REMOVED***playMode,
***REMOVED******REMOVED******REMOVED******REMOVED***playModeIcon,
***REMOVED******REMOVED******REMOVED******REMOVED***playModeName,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***收藏状态
***REMOVED******REMOVED******REMOVED******REMOVED***isCurrentMusicLiked,
***REMOVED******REMOVED******REMOVED******REMOVED***isInTempPlayMode,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***计算属性
***REMOVED******REMOVED******REMOVED******REMOVED***hasCurrentMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***progress,
***REMOVED******REMOVED******REMOVED******REMOVED***queueCount,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***方法
***REMOVED******REMOVED******REMOVED******REMOVED***initAudio,
***REMOVED******REMOVED******REMOVED******REMOVED***searchMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***loadMoreMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***getMusicPlayUrl,
***REMOVED******REMOVED******REMOVED******REMOVED***playMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***togglePlay,
***REMOVED******REMOVED******REMOVED******REMOVED***stopMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***setProgress,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***音量控制方法
***REMOVED******REMOVED******REMOVED******REMOVED***setVolume,
***REMOVED******REMOVED******REMOVED******REMOVED***toggleMute,
***REMOVED******REMOVED******REMOVED******REMOVED***mute,
***REMOVED******REMOVED******REMOVED******REMOVED***unmute,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放模式方法
***REMOVED******REMOVED******REMOVED******REMOVED***togglePlayMode,
***REMOVED******REMOVED******REMOVED******REMOVED***setPlayMode,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放设置数据库同步方法
***REMOVED******REMOVED******REMOVED******REMOVED***syncVolumeToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***syncMuteStatusToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***syncPlayModeToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***syncPlayProgressToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***syncPlayProgressImmediately,
***REMOVED******REMOVED******REMOVED******REMOVED***syncCurrentMusicToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***syncPlayStatusToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***loadPlaySettingsFromDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放队列方法
***REMOVED******REMOVED******REMOVED******REMOVED***addToQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***removeFromQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***clearQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***playNext,
***REMOVED******REMOVED******REMOVED******REMOVED***playPrevious,
***REMOVED******REMOVED******REMOVED******REMOVED***togglePlayQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***reorderQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***playMusicFromQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***moveToCurrentPosition,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***播放队列数据库同步方法
***REMOVED******REMOVED******REMOVED******REMOVED***syncPlayQueueToDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***loadPlayQueueFromDatabase,
***REMOVED******REMOVED******REMOVED******REMOVED***addToPlayQueueWithSync,
***REMOVED******REMOVED******REMOVED******REMOVED***removeFromPlayQueueWithSync,
***REMOVED******REMOVED******REMOVED******REMOVED***clearPlayQueueWithSync,
***REMOVED******REMOVED******REMOVED******REMOVED***reorderPlayQueueWithSync,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***收藏方法
***REMOVED******REMOVED******REMOVED******REMOVED***checkCurrentMusicFavoriteStatus,
***REMOVED******REMOVED******REMOVED******REMOVED***toggleFavorite,
***REMOVED******REMOVED******REMOVED******REMOVED***addFavoriteStatusListener,
***REMOVED******REMOVED******REMOVED******REMOVED***removeFavoriteStatusListener,
***REMOVED******REMOVED******REMOVED******REMOVED***switchToTempPlayMode,
***REMOVED******REMOVED******REMOVED******REMOVED***restoreOriginalPlayQueue,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***下载方法
***REMOVED******REMOVED******REMOVED******REMOVED***downloadMusic,
***REMOVED******REMOVED******REMOVED******REMOVED***
***REMOVED******REMOVED******REMOVED******REMOVED***//***REMOVED***最近播放方法
***REMOVED******REMOVED******REMOVED******REMOVED***recordRecentPlay,
***REMOVED******REMOVED******REMOVED******REMOVED***updateRecentPlayProgress,
***REMOVED******REMOVED******REMOVED******REMOVED***addRecentPlayListener,
***REMOVED******REMOVED******REMOVED******REMOVED***removeRecentPlayListener
***REMOVED******REMOVED***}
})
